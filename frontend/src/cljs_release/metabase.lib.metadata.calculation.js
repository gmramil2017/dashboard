var window=global;var $CLJS=require("./cljs_env.js");require("./cljs.core.js");require("./clojure.string.js");require("./metabase.lib.dispatch.js");require("./metabase.lib.hierarchy.js");require("./metabase.lib.metadata.js");require("./metabase.lib.options.js");require("./metabase.lib.schema.js");require("./metabase.lib.schema.common.js");require("./metabase.lib.schema.expression.js");require("./metabase.lib.schema.temporal_bucketing.js");require("./metabase.lib.util.js");require("./metabase.shared.util.i18n.js");require("./metabase.util.js");require("./metabase.util.log.js");require("./metabase.util.malli.js");require("./metabase.util.malli.registry.js");
'use strict';var qpa,o0,rpa,p0,q0,K0,spa,tpa,O0,D0,Q0,upa,F0;qpa=function(a){return $CLJS.A(a)?a.normalize("NFKD").replace(RegExp("[̀-ͯ]","gu"),""):null};o0=function(a,b){return 128>a.charCodeAt(0)?$CLJS.Ie($CLJS.Jfa,a)?a:"_":$CLJS.m(b)?encodeURIComponent(a):a};
rpa=function(a){var b=$CLJS.Uf(new $CLJS.k(null,1,[$CLJS.NF,!0],null)),c=$CLJS.M.h(b,$CLJS.Ifa),d=$CLJS.M.h(b,$CLJS.NF);return $CLJS.A(a)?(b=$CLJS.Uu.g(function(){return function g(f){return new $CLJS.Af(null,function(){for(;;){var l=$CLJS.A(f);if(l){if($CLJS.re(l)){var n=$CLJS.$c(l),q=$CLJS.E(n),u=$CLJS.Df(q);a:for(var v=0;;)if(v<q){var x=$CLJS.be(n,v);x=o0(x,$CLJS.Fb(d));u.add(x);v+=1}else{n=!0;break a}return n?$CLJS.If($CLJS.Kf(u),g($CLJS.ad(l))):$CLJS.If($CLJS.Kf(u),null)}u=$CLJS.C(l);return $CLJS.pf(o0(u,
$CLJS.Fb(d)),g($CLJS.zd(l)))}return null}},null,null)}(qpa($CLJS.tF(a)))}()),$CLJS.m(c)?$CLJS.Uu.g($CLJS.pg(c,b)):b):null};p0=function(a,b){if(null!=a&&null!=a.ah)a=a.ah(a,b);else{var c=p0[$CLJS.Na(null==a?null:a)];if(null!=c)a=c.h?c.h(a,b):c.call(null,a,b);else if(c=p0._,null!=c)a=c.h?c.h(a,b):c.call(null,a,b);else throw $CLJS.Ob("MetadataProvider.table",a);}return a};
q0=function(a,b){if(null!=a&&null!=a.Ug)a=a.Ug(a,b);else{var c=q0[$CLJS.Na(null==a?null:a)];if(null!=c)a=c.h?c.h(a,b):c.call(null,a,b);else if(c=q0._,null!=c)a=c.h?c.h(a,b):c.call(null,a,b);else throw $CLJS.Ob("MetadataProvider.card",a);}return a};$CLJS.r0=function(a,b){a=$CLJS.Uf(a);a=$CLJS.M.h(a,$CLJS.yY);var c=0>b?$CLJS.E(a)+b:b;if(c>=$CLJS.E(a)||0>c)throw $CLJS.Ej($CLJS.aH("Stage {0} does not exist",$CLJS.J([b])),new $CLJS.k(null,1,[$CLJS.fpa,$CLJS.E(a)],null));return c};
$CLJS.s0=function(a,b){a=$CLJS.H_(a);a=$CLJS.Uf(a);var c=$CLJS.M.h(a,$CLJS.yY);return $CLJS.M.h($CLJS.Sg(c),$CLJS.r0(a,b))};$CLJS.t0=function(a,b,c,d){a=$CLJS.H_(a);a=$CLJS.Uf(a);var e=$CLJS.M.h(a,$CLJS.yY);b=$CLJS.r0(a,b);c=$CLJS.Q.S($CLJS.Wm,$CLJS.Sg(e),b,c,d);return $CLJS.U.j(a,$CLJS.yY,c)};$CLJS.u0=function(a){return $CLJS.kP.g($CLJS.C($CLJS.yY.g(a)))};$CLJS.v0=function(a){return $CLJS.S_(a)?a:$CLJS.RY.g(a)};$CLJS.w0=function(a,b){return p0($CLJS.v0(a),b)};
$CLJS.x0=function(a,b){return q0($CLJS.v0(a),b)};
K0=function(a,b,c){var d=$CLJS.y0.j(a,b,c);return $CLJS.mn.l($CLJS.J([$CLJS.ri(d,new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.V,$CLJS.YH,$CLJS.Pl],null)),function(){var e=$CLJS.z0.C(a,b,c,$CLJS.A0);return $CLJS.m(e)?new $CLJS.k(null,1,[$CLJS.B0,e],null):null}(),function(){var e=$CLJS.Tm.h($CLJS.qk,$CLJS.LF)(d);return $CLJS.m(e)?new $CLJS.k(null,1,[$CLJS.qk,e],null):null}(),function(){var e=$CLJS.N_.g(d);return $CLJS.m(e)?new $CLJS.k(null,1,[$CLJS.O_,$CLJS.C0.j(a,b,$CLJS.Ae(e)?$CLJS.w0(a,e):"string"===typeof e?
$CLJS.x0(a,$CLJS.I_(e)):null)],null):null}(),function(){var e=$CLJS.J_.g(d);return $CLJS.m(e)?new $CLJS.k(null,4,[D0,$CLJS.F.h(e,$CLJS.U_),$CLJS.E0,$CLJS.F.h(e,$CLJS.Z_),F0,$CLJS.F.h(e,$CLJS.X_),$CLJS.G0,$CLJS.F.h(e,$CLJS.Y_)],null):null}(),function(){var e=$CLJS.a0.g(d);return null==e?null:new $CLJS.k(null,1,[$CLJS.H0,e],null)}(),$CLJS.ri(d,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.I0,$CLJS.J0],null))]))};$CLJS.L0=new $CLJS.N(null,"direction","direction",-633359395);
$CLJS.G0=new $CLJS.N(null,"is-implicitly-joinable","is-implicitly-joinable",2054926844);$CLJS.I0=new $CLJS.N(null,"breakout-position","breakout-position",-760153191);$CLJS.M0=new $CLJS.N(null,"include-implicitly-joinable?","include-implicitly-joinable?",-772701866);$CLJS.H0=new $CLJS.N(null,"selected","selected",574897764);spa=new $CLJS.N(null,"is-order-by-column","is-order-by-column",1320802549);
tpa=new $CLJS.w("metabase.lib.metadata.calculation","display-name-method","metabase.lib.metadata.calculation/display-name-method",37675198,null);$CLJS.N0=new $CLJS.N(null,"stage-number","stage-number",-1752729638);O0=new $CLJS.N("metabase.lib.metadata.calculation","display-info","metabase.lib.metadata.calculation/display-info",-2072755534);$CLJS.P0=new $CLJS.N(null,"include-joined?","include-joined?",-410632824);D0=new $CLJS.N(null,"is-from-previous-stage","is-from-previous-stage",956780376);
Q0=new $CLJS.N(null,"is-source-table","is-source-table",1559075056);$CLJS.R0=new $CLJS.N(null,"unique-name-fn","unique-name-fn",-755402870);$CLJS.E0=new $CLJS.N(null,"is-from-join","is-from-join",-1107917905);$CLJS.S0=new $CLJS.N(null,"requires-column","requires-column",934105295);$CLJS.J0=new $CLJS.N(null,"order-by-position","order-by-position",-1307229997);upa=new $CLJS.N(null,"is-breakout-column","is-breakout-column",46784229);$CLJS.B0=new $CLJS.N(null,"long-display-name","long-display-name",1550784464);
$CLJS.A0=new $CLJS.N(null,"long","long",-171452093);$CLJS.T0=new $CLJS.N(null,"short-name","short-name",-1767085022);$CLJS.U0=new $CLJS.N(null,"include-expressions?","include-expressions?",-1817639288);F0=new $CLJS.N(null,"is-calculated","is-calculated",-86687269);$CLJS.V0=function(){var a=$CLJS.ij.g($CLJS.P),b=$CLJS.ij.g($CLJS.P),c=$CLJS.ij.g($CLJS.P),d=$CLJS.ij.g($CLJS.P),e=$CLJS.M.j(new $CLJS.k(null,1,[$CLJS.Vk,$CLJS.MG],null),$CLJS.Vk,$CLJS.rj.A?$CLJS.rj.A():$CLJS.rj.call(null));return new $CLJS.Aj($CLJS.$i.h("metabase.lib.metadata.calculation","display-name-method"),function(f,g,l){return $CLJS.LG(l)},$CLJS.Uj,e,a,b,c,d)}();
$CLJS.W0=function(){var a=$CLJS.ij.g($CLJS.P),b=$CLJS.ij.g($CLJS.P),c=$CLJS.ij.g($CLJS.P),d=$CLJS.ij.g($CLJS.P),e=$CLJS.M.j(new $CLJS.k(null,1,[$CLJS.Vk,$CLJS.MG],null),$CLJS.Vk,$CLJS.rj.A?$CLJS.rj.A():$CLJS.rj.call(null));return new $CLJS.Aj($CLJS.$i.h("metabase.lib.metadata.calculation","column-name-method"),function(f,g,l){return $CLJS.LG(l)},$CLJS.Uj,e,a,b,c,d)}();
$CLJS.z0=function z0(a){switch(arguments.length){case 1:return z0.g(arguments[0]);case 2:return z0.h(arguments[0],arguments[1]);case 3:return z0.j(arguments[0],arguments[1],arguments[2]);case 4:return z0.C(arguments[0],arguments[1],arguments[2],arguments[3]);default:throw Error(["Invalid arity: ",$CLJS.p.g(arguments.length)].join(""));}};$CLJS.Ra("metabase.lib.metadata.calculation.display_name",$CLJS.z0);$CLJS.z0.g=function(a){return $CLJS.z0.h(a,a)};
$CLJS.z0.h=function(a,b){return $CLJS.z0.j(a,-1,b)};$CLJS.z0.j=function(a,b,c){return $CLJS.z0.C(a,b,c,$CLJS.Uj)};$CLJS.z0.C=function(a,b,c,d){var e=$CLJS.YH.g($CLJS.HK(c));if($CLJS.m(e))return e;try{return $CLJS.V0.C(a,b,c,d)}catch(f){if(f instanceof Error)throw b=f,$CLJS.Dj($CLJS.aH("Error calculating display name for {0}: {1}",$CLJS.J([$CLJS.gj.l($CLJS.J([c])),$CLJS.rZ(b)])),new $CLJS.k(null,2,[$CLJS.GN,a,$CLJS.UJ,c],null),b);throw f;}};$CLJS.z0.v=4;
$CLJS.X0=function X0(a){switch(arguments.length){case 2:return X0.h(arguments[0],arguments[1]);case 3:return X0.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",$CLJS.p.g(arguments.length)].join(""));}};$CLJS.X0.h=function(a,b){return $CLJS.X0.j(a,-1,b)};
$CLJS.X0.j=function(a,b,c){var d=$CLJS.V.g($CLJS.HK(c));if($CLJS.m(d))return d;try{return $CLJS.W0.j(a,b,c)}catch(e){if(e instanceof Error)throw d=e,$CLJS.Dj($CLJS.aH("Error calculating column name for {0}: {1}",$CLJS.J([$CLJS.gj.l($CLJS.J([c])),$CLJS.rZ(d)])),new $CLJS.k(null,3,[$CLJS.UJ,c,$CLJS.GN,a,$CLJS.N0,b],null),d);throw e;}};$CLJS.X0.v=3;
$CLJS.V0.o(null,$CLJS.Uj,function(a,b,c){a=$CLJS.mF($CLJS.PD);$CLJS.m($CLJS.qF("metabase.lib.metadata.calculation",a))&&$CLJS.rF("metabase.lib.metadata.calculation",a,$CLJS.z_("Don't know how to calculate display name for %s. Add an impl for %s for %s",$CLJS.J([$CLJS.gj.l($CLJS.J([c])),tpa,$CLJS.LG(c)])),null);return $CLJS.qe(c)&&$CLJS.C(c)instanceof $CLJS.N?$CLJS.Ai($CLJS.C(c)):$CLJS.gj.l($CLJS.J([c]))});$CLJS.W0.o(null,$CLJS.Uj,function(a,b,c){return rpa($CLJS.zu($CLJS.z0.j(a,b,c),/[\(\)]/,""))});
$CLJS.Y0=function(){var a=$CLJS.ij.g($CLJS.P),b=$CLJS.ij.g($CLJS.P),c=$CLJS.ij.g($CLJS.P),d=$CLJS.ij.g($CLJS.P),e=$CLJS.M.j(new $CLJS.k(null,1,[$CLJS.Vk,$CLJS.MG],null),$CLJS.Vk,$CLJS.rj.A?$CLJS.rj.A():$CLJS.rj.call(null));return new $CLJS.Aj($CLJS.$i.h("metabase.lib.metadata.calculation","describe-top-level-key-method"),function(f,g,l){return l},$CLJS.Uj,e,a,b,c,d)}();
$CLJS.Z0=function(){var a=$CLJS.ij.g($CLJS.P),b=$CLJS.ij.g($CLJS.P),c=$CLJS.ij.g($CLJS.P),d=$CLJS.ij.g($CLJS.P),e=$CLJS.M.j(new $CLJS.k(null,1,[$CLJS.Vk,$CLJS.MG],null),$CLJS.Vk,$CLJS.rj.A?$CLJS.rj.A():$CLJS.rj.call(null));return new $CLJS.Aj($CLJS.$i.h("metabase.lib.metadata.calculation","type-of-method"),function(f,g,l){return $CLJS.LG(l)},$CLJS.Uj,e,a,b,c,d)}();
$CLJS.$0=function $0(a){switch(arguments.length){case 2:return $0.h(arguments[0],arguments[1]);case 3:return $0.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",$CLJS.p.g(arguments.length)].join(""));}};$CLJS.$0.h=function(a,b){return $CLJS.$0.j(a,-1,b)};
$CLJS.$0.j=function(a,b,c){var d=$CLJS.HK(c);d=$CLJS.Uf(d);var e=$CLJS.M.h(d,$CLJS.bQ),f=$CLJS.qk.g(d);if($CLJS.m(f))return f;e=$CLJS.m($CLJS.m(e)?$CLJS.Ie($CLJS.kV,e):e)?$CLJS.nl:null;if($CLJS.m(e))return e;d=$CLJS.LF.g(d);if($CLJS.m(d))return d;a=$CLJS.Z0.j(a,b,c);return $CLJS.XG(a,$CLJS.sl)?a:$CLJS.sl};$CLJS.$0.v=3;$CLJS.Z0.o(null,$CLJS.Uj,function(a,b,c){return $CLJS.LK(c)});
$CLJS.Z0.o(null,$CLJS.XK,function(a,b,c){$CLJS.K(c,0,null);$CLJS.K(c,1,null);c=$CLJS.K(c,2,null);return $CLJS.$0.j(a,b,c)});$CLJS.Z0.o(null,$CLJS.XW,function(a,b,c){$CLJS.K(c,0,null);$CLJS.K(c,1,null);var d=$CLJS.K(c,2,null);return"string"===typeof d?$CLJS.LK(c):$CLJS.$0.j(a,b,d)});
$CLJS.y0=function(){var a=$CLJS.ij.g($CLJS.P),b=$CLJS.ij.g($CLJS.P),c=$CLJS.ij.g($CLJS.P),d=$CLJS.ij.g($CLJS.P),e=$CLJS.M.j(new $CLJS.k(null,1,[$CLJS.Vk,$CLJS.MG],null),$CLJS.Vk,$CLJS.rj.A?$CLJS.rj.A():$CLJS.rj.call(null));return new $CLJS.Aj($CLJS.$i.h("metabase.lib.metadata.calculation","metadata-method"),function(f,g,l){return $CLJS.LG(l)},$CLJS.Uj,e,a,b,c,d)}();
$CLJS.y0.o(null,$CLJS.Uj,function(a,b,c){try{return new $CLJS.k(null,4,[$CLJS.wl,$CLJS.xV,$CLJS.LF,$CLJS.$0.j(a,b,c),$CLJS.V,$CLJS.X0.j(a,b,c),$CLJS.YH,$CLJS.z0.j(a,b,c)],null)}catch(e){if(e instanceof Error){var d=e;throw $CLJS.Dj($CLJS.aH("Error calculating metadata for {0}: {1}",$CLJS.J([$CLJS.gj.l($CLJS.J([$CLJS.LG(c)])),$CLJS.rZ(d)])),new $CLJS.k(null,3,[$CLJS.GN,a,$CLJS.N0,b,$CLJS.UJ,c],null),d);}throw e;}});
$CLJS.a1=function(){var a=$CLJS.ij.g($CLJS.P),b=$CLJS.ij.g($CLJS.P),c=$CLJS.ij.g($CLJS.P),d=$CLJS.ij.g($CLJS.P),e=$CLJS.M.j(new $CLJS.k(null,1,[$CLJS.Vk,$CLJS.MG],null),$CLJS.Vk,$CLJS.rj.A?$CLJS.rj.A():$CLJS.rj.call(null));return new $CLJS.Aj($CLJS.$i.h("metabase.lib.metadata.calculation","display-info-method"),function(f,g,l){return $CLJS.LG(l)},$CLJS.Uj,e,a,b,c,d)}();
$CLJS.rK(O0,new $CLJS.R(null,19,5,$CLJS.S,[$CLJS.bm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.YH,$CLJS.Tl],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.B0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),$CLJS.Tl],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.O_,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.rt,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,O0],null)],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[D0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.rt,$CLJS.pk],
null)],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.E0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.rt,$CLJS.pk],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[F0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.rt,$CLJS.pk],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.G0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.rt,$CLJS.pk],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[Q0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,
2,5,$CLJS.S,[$CLJS.rt,$CLJS.pk],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[upa,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.rt,$CLJS.pk],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[spa,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.rt,$CLJS.pk],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.V,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),$CLJS.Tl],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.EV,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),$CLJS.Tl],null),
new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.$F,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),$CLJS.Tl],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.T0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),$CLJS.Tl],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.S0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),$CLJS.pk],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.H0,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),$CLJS.pk],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.Uj,new $CLJS.k(null,1,[$CLJS.Wj,!0],null),$CLJS.pk],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.L0,
new $CLJS.k(null,1,[$CLJS.Wj,!0],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.ot,$CLJS.KI,$CLJS.xI],null)],null)],null));$CLJS.C0=function C0(a){switch(arguments.length){case 2:return C0.h(arguments[0],arguments[1]);case 3:return C0.j(arguments[0],arguments[1],arguments[2]);default:throw Error(["Invalid arity: ",$CLJS.p.g(arguments.length)].join(""));}};$CLJS.C0.h=function(a,b){return $CLJS.C0.j(a,-1,b)};
$CLJS.C0.j=function(a,b,c){try{return $CLJS.a1.j(a,b,c)}catch(e){if(e instanceof Error){var d=e;throw $CLJS.Dj($CLJS.aH("Error calculating display info for {0}: {1}",$CLJS.J([$CLJS.LG(c),$CLJS.rZ(d)])),new $CLJS.k(null,3,[$CLJS.GN,a,$CLJS.N0,b,$CLJS.UJ,c],null),d);}throw e;}};$CLJS.C0.v=3;$CLJS.a1.o(null,$CLJS.Uj,function(a,b,c){return K0(a,b,c)});$CLJS.a1.o(null,$CLJS.L_,function(a,b,c){return $CLJS.mn.l($CLJS.J([K0(a,b,c),new $CLJS.k(null,1,[Q0,$CLJS.F.h($CLJS.u0(a),$CLJS.Lk.g(c))],null)]))});
$CLJS.b1=function(){var a=$CLJS.ij.g($CLJS.P),b=$CLJS.ij.g($CLJS.P),c=$CLJS.ij.g($CLJS.P),d=$CLJS.ij.g($CLJS.P),e=$CLJS.M.j(new $CLJS.k(null,1,[$CLJS.Vk,$CLJS.MG],null),$CLJS.Vk,$CLJS.rj.A?$CLJS.rj.A():$CLJS.rj.call(null));return new $CLJS.Aj($CLJS.$i.h("metabase.lib.metadata.calculation","returned-columns-method"),function(f,g,l){return $CLJS.LG(l)},$CLJS.Uj,e,a,b,c,d)}();$CLJS.b1.o(null,$CLJS.OF,function(){return $CLJS.Rg});
$CLJS.c1=function(){var a=$CLJS.ij.g($CLJS.P),b=$CLJS.ij.g($CLJS.P),c=$CLJS.ij.g($CLJS.P),d=$CLJS.ij.g($CLJS.P),e=$CLJS.M.j(new $CLJS.k(null,1,[$CLJS.Vk,$CLJS.MG],null),$CLJS.Vk,$CLJS.rj.A?$CLJS.rj.A():$CLJS.rj.call(null));return new $CLJS.Aj($CLJS.$i.h("metabase.lib.metadata.calculation","visible-columns-method"),function(f,g,l){return $CLJS.LG(l)},$CLJS.Uj,e,a,b,c,d)}();$CLJS.c1.o(null,$CLJS.OF,function(){return $CLJS.Rg});$CLJS.c1.o(null,$CLJS.Uj,function(a,b,c,d){return $CLJS.b1.C(a,b,c,d)});
module.exports={display_name:$CLJS.z0};