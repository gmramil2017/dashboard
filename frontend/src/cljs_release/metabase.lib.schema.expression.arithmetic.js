var window=global;var $CLJS=require("./cljs_env.js");require("./cljs.core.js");require("./malli.core.js");require("./medley.core.js");require("./metabase.lib.hierarchy.js");require("./metabase.lib.schema.common.js");require("./metabase.lib.schema.expression.js");require("./metabase.lib.schema.mbql_clause.js");require("./metabase.lib.schema.temporal_bucketing.js");require("./metabase.types.js");require("./metabase.util.malli.registry.js");
'use strict';var MV,NV,lma,PV,mma,nma,oma,QV,OV;$CLJS.LV=function(a,b){return $CLJS.Tb(function(c,d){return $CLJS.m(a.g?a.g(d):a.call(null,d))?$CLJS.Jd(d):null},null,b)};MV=function(a,b){$CLJS.K(a,0,null);$CLJS.K(a,1,null);$CLJS.K(a,2,null);a=$CLJS.K(a,3,null);b=$CLJS.XG(b,$CLJS.UH)?$CLJS.ZU:$CLJS.XG(b,$CLJS.eK)?$CLJS.UU:$CLJS.XG(b,$CLJS.YI)?$CLJS.WU:null;return $CLJS.m(b)?$CLJS.DU(b,a):!0};
NV=function(a){a=$CLJS.A(a);$CLJS.C(a);a=$CLJS.D(a);$CLJS.C(a);a=$CLJS.D(a);a=$CLJS.lj(function(d){return $CLJS.XG($CLJS.LK(d),$CLJS.pI)},a);var b=$CLJS.Uf(a);a=$CLJS.M.h(b,!1);b=$CLJS.M.h(b,!0);if($CLJS.qi.h($CLJS.E(a),1))return"Temporal arithmetic expression must contain exactly one non-interval value";if(1>$CLJS.E(b))return"Temporal arithmetic expression must contain at least one :interval";var c=$CLJS.LK($CLJS.C(a));return $CLJS.ag(function(d){$CLJS.K(d,0,null);$CLJS.K(d,1,null);$CLJS.K(d,2,null);
var e=$CLJS.K(d,3,null);return $CLJS.m(MV(d,c))?null:["Cannot add a ",$CLJS.p.g(e)," interval to a ",$CLJS.p.g(c)," expression"].join("")},b)};
lma=function(a){return new $CLJS.R(null,4,5,$CLJS.S,[$CLJS.Qj,new $CLJS.k(null,1,[$CLJS.Wu,[$CLJS.p.g(a)," clause with a temporal expression and one or more :interval clauses"].join("")],null),new $CLJS.R(null,6,5,$CLJS.S,[$CLJS.ft,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.lm,a],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.DK],null)],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.et,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,OV],
null)],null)],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.RK],null)],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.et,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,OV],null)],null)],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.pt,new $CLJS.k(null,1,[$CLJS.Yu,function(b){b=$CLJS.Uf(b);b=$CLJS.M.h(b,$CLJS.vl);return["Invalid ",$CLJS.p.g(a)," clause: ",$CLJS.p.g(NV(b))].join("")}],null),$CLJS.dg(NV)],null)],null)};
PV=function(a){var b=$CLJS.S,c=lma(a);a=new $CLJS.R(null,5,5,$CLJS.S,[$CLJS.ft,new $CLJS.k(null,1,[$CLJS.Wu,[$CLJS.p.g(a)," clause with numeric args"].join("")],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.lm,a],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.DK],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.et,new $CLJS.k(null,1,[$CLJS.vk,2],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null)],null)],
null);return new $CLJS.R(null,3,5,b,[$CLJS.Gk,c,a],null)};mma=function(a){return $CLJS.We($CLJS.AU,$CLJS.xg.h(function(b){var c=$CLJS.LK(b),d=$CLJS.XG(c,$CLJS.UK);b=d?$CLJS.DU($CLJS.RU,b):d;return $CLJS.m(b)?$CLJS.Jl:c},a))};nma=function(a){a=$CLJS.LV(function(b){return!$CLJS.XG(b,$CLJS.pI)},$CLJS.xg.h($CLJS.LK,a));return $CLJS.XG(a,$CLJS.UK)?$CLJS.Ql:a};oma=function(a){return $CLJS.m($CLJS.ag(function(b){return $CLJS.XG($CLJS.LK(b),$CLJS.pI)},a))?nma(a):mma(a)};
QV=new $CLJS.N("metabase.lib.schema.expression.arithmetic","args.numbers","metabase.lib.schema.expression.arithmetic/args.numbers",-179216621);$CLJS.RV=new $CLJS.N("lib.type-of","type-is-type-of-arithmetic-args","lib.type-of/type-is-type-of-arithmetic-args",-626871615);OV=new $CLJS.N("mbql.clause","interval","mbql.clause/interval",-990446354);$CLJS.rK(new $CLJS.N("metabase.lib.schema.expression.arithmetic","args.temporal","metabase.lib.schema.expression.arithmetic/args.temporal",1338604923),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.Qj,new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.it,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.PK,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.RK],null)],null)],null),new $CLJS.R(null,2,5,$CLJS.S,[new $CLJS.N(null,"intervals","intervals",2096054013),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.rm,OV],
null)],null)],null),new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.pt,new $CLJS.k(null,1,[$CLJS.Wu,"Temporal arithmetic expression with valid interval units for the expression type"],null),function(a){var b=$CLJS.A(a);a=$CLJS.C(b);b=$CLJS.D(b);var c=$CLJS.LK(a);return $CLJS.$f(function(d){return MV(d,c)},b)}],null)],null));
$CLJS.rK(QV,new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.et,new $CLJS.k(null,1,[$CLJS.vk,2],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null)],null));$CLJS.IU($CLJS.rm,PV($CLJS.rm));$CLJS.IU($CLJS.hu,PV($CLJS.hu));$CLJS.OU($CLJS.sm,$CLJS.J([new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.pl,QV],null)]));$CLJS.OU($CLJS.XJ,$CLJS.J([$CLJS.hu,$CLJS.QJ,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.pl,QV],null)]));
for(var SV=$CLJS.A(new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.rm,$CLJS.hu,$CLJS.sm],null)),TV=null,UV=0,VV=0;;)if(VV<UV){var pma=TV.aa(null,VV);$CLJS.BU(pma,$CLJS.RV);VV+=1}else{var WV=$CLJS.A(SV);if(WV){var XV=WV;if($CLJS.re(XV)){var YV=$CLJS.$c(XV),qma=$CLJS.ad(XV),rma=YV,sma=$CLJS.E(YV);SV=qma;TV=rma;UV=sma}else{var tma=$CLJS.C(XV);$CLJS.BU(tma,$CLJS.RV);SV=$CLJS.D(XV);TV=null;UV=0}VV=0}else break}$CLJS.KK.o(null,$CLJS.RV,function(a){a=$CLJS.A(a);$CLJS.C(a);a=$CLJS.D(a);$CLJS.C(a);a=$CLJS.D(a);return oma(a)});
$CLJS.MU($CLJS.yH,$CLJS.J([new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null)]));$CLJS.BU($CLJS.yH,$CLJS.XK);
for(var ZV=$CLJS.A(new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.ZJ,$CLJS.fH,$CLJS.tI],null)),$V=null,aW=0,bW=0;;)if(bW<aW){var uma=$V.aa(null,bW);$CLJS.MU(uma,$CLJS.J([$CLJS.hu,$CLJS.QJ,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null)]));bW+=1}else{var cW=$CLJS.A(ZV);if(cW){var dW=cW;if($CLJS.re(dW)){var eW=$CLJS.$c(dW),vma=$CLJS.ad(dW),wma=eW,xma=$CLJS.E(eW);ZV=vma;$V=wma;aW=xma}else{var yma=$CLJS.C(dW);$CLJS.MU(yma,$CLJS.J([$CLJS.hu,$CLJS.QJ,new $CLJS.R(null,
2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null)]));ZV=$CLJS.D(dW);$V=null;aW=0}bW=0}else break}
for(var fW=$CLJS.A(new $CLJS.R(null,3,5,$CLJS.S,[$CLJS.pH,$CLJS.LI,$CLJS.aJ],null)),gW=null,hW=0,iW=0;;)if(iW<hW){var zma=gW.aa(null,iW);$CLJS.MU(zma,$CLJS.J([$CLJS.hu,$CLJS.nl,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null)]));iW+=1}else{var jW=$CLJS.A(fW);if(jW){var kW=jW;if($CLJS.re(kW)){var lW=$CLJS.$c(kW),Ama=$CLJS.ad(kW),Bma=lW,Cma=$CLJS.E(lW);fW=Ama;gW=Bma;hW=Cma}else{var Dma=$CLJS.C(kW);$CLJS.MU(Dma,$CLJS.J([$CLJS.hu,$CLJS.nl,new $CLJS.R(null,
2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null)]));fW=$CLJS.D(kW);gW=null;hW=0}iW=0}else break}$CLJS.MU($CLJS.rH,$CLJS.J([new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null),new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.hm,new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.nq,$CLJS.$K],null)],null)]));
$CLJS.KK.o(null,$CLJS.rH,function(a){$CLJS.K(a,0,null);$CLJS.K(a,1,null);var b=$CLJS.K(a,2,null);a=$CLJS.K(a,3,null);return $CLJS.XG($CLJS.LK(b),$CLJS.nl)&&$CLJS.XG($CLJS.LK(a),$CLJS.nl)?$CLJS.nl:$CLJS.QJ});