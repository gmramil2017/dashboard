var window=global;var $CLJS=require("./cljs_env.js");require("./cljs.core.js");require("./medley.core.js");require("./metabase.lib.common.js");require("./metabase.lib.dispatch.js");require("./metabase.lib.equality.js");require("./metabase.lib.hierarchy.js");require("./metabase.lib.metadata.js");require("./metabase.lib.metadata.calculation.js");require("./metabase.lib.options.js");require("./metabase.lib.ref.js");require("./metabase.lib.schema.js");require("./metabase.lib.schema.aggregation.js");require("./metabase.lib.schema.common.js");require("./metabase.lib.temporal_bucket.js");require("./metabase.lib.types.isa.js");require("./metabase.lib.util.js");require("./metabase.shared.util.i18n.js");require("./metabase.util.js");require("./metabase.util.malli.js");
'use strict';var R3,S3,T3,U3;R3=function(a,b,c){var d=$CLJS.s0(a,b);d=$CLJS.Uf(d);d=$CLJS.M.h(d,$CLJS.ZO);d=$CLJS.LV($CLJS.Rm.j($CLJS.vi([c]),$CLJS.EK,$CLJS.Zd),d);if(!$CLJS.m(d))throw $CLJS.Ej($CLJS.aH("No aggregation with uuid {0}",$CLJS.J([c])),new $CLJS.k(null,3,[$CLJS.Dt,c,$CLJS.GN,a,$CLJS.N0,b],null));return d};S3=new $CLJS.N("metabase.lib.aggregation","unary-aggregation","metabase.lib.aggregation/unary-aggregation",1064133592);
T3=new $CLJS.N("metabase.lib.aggregation","count-aggregation","metabase.lib.aggregation/count-aggregation",-21314018);U3=new $CLJS.N("metabase.lib.aggregation","aggregation","metabase.lib.aggregation/aggregation",1701573815);$CLJS.qra=new $CLJS.N(null,"aggregation-operator","aggregation-operator",-1978700834);$CLJS.Y0.o(null,$CLJS.ZO,function(a,b){var c=$CLJS.Vf($CLJS.ZO.g($CLJS.s0(a,b)));return $CLJS.m(c)?$CLJS.K1($CLJS.bH("and"),function(){return function f(e){return new $CLJS.Af(null,function(){for(;;){var g=$CLJS.A(e);if(g){if($CLJS.re(g)){var l=$CLJS.$c(g),n=$CLJS.E(l),q=$CLJS.Df(n);a:for(var u=0;;)if(u<n){var v=$CLJS.be(l,u);v=$CLJS.z0.C(a,b,v,$CLJS.A0);q.add(v);u+=1}else{l=!0;break a}return l?$CLJS.If($CLJS.Kf(q),f($CLJS.ad(g))):$CLJS.If($CLJS.Kf(q),null)}q=$CLJS.C(g);return $CLJS.pf($CLJS.z0.C(a,
b,q,$CLJS.A0),f($CLJS.zd(g)))}return null}},null,null)}(c)}()):null});$CLJS.y0.o(null,$CLJS.ZO,function(a,b,c){$CLJS.K(c,0,null);var d=$CLJS.K(c,1,null),e=$CLJS.Uf(d);d=$CLJS.M.h(e,$CLJS.LF);e=$CLJS.M.h(e,$CLJS.qk);c=$CLJS.K(c,2,null);c=R3(a,b,c);return $CLJS.mn.l($CLJS.J([$CLJS.y0.j(a,b,c),new $CLJS.k(null,2,[$CLJS.J_,$CLJS.f0,$CLJS.L1,$CLJS.EK.g($CLJS.Zd(c))],null),$CLJS.m(d)?new $CLJS.k(null,1,[$CLJS.LF,d],null):null,$CLJS.m(e)?new $CLJS.k(null,1,[$CLJS.qk,e],null):null]))});
$CLJS.V0.o(null,$CLJS.ZO,function(a,b,c,d){$CLJS.K(c,0,null);$CLJS.K(c,1,null);c=$CLJS.K(c,2,null);return $CLJS.z0.C(a,b,R3(a,b,c),d)});$CLJS.BU(T3,U3);
for(var V3=$CLJS.A(new $CLJS.R(null,2,5,$CLJS.S,[$CLJS.cD,$CLJS.SI],null)),W3=null,X3=0,Y3=0;;)if(Y3<X3){var rra=W3.aa(null,Y3);$CLJS.BU(rra,T3);Y3+=1}else{var Z3=$CLJS.A(V3);if(Z3){var $3=Z3;if($CLJS.re($3)){var a4=$CLJS.$c($3),sra=$CLJS.ad($3),tra=a4,ura=$CLJS.E(a4);V3=sra;W3=tra;X3=ura}else{var vra=$CLJS.C($3);$CLJS.BU(vra,T3);V3=$CLJS.D($3);W3=null;X3=0}Y3=0}else break}
$CLJS.V0.o(null,T3,function(a,b,c,d){var e=$CLJS.K(c,0,null);$CLJS.K(c,1,null);c=$CLJS.K(c,2,null);if($CLJS.m(c))switch(a=$CLJS.z0.C(a,b,c,d),e=e instanceof $CLJS.N?e.N:null,e){case "count":return $CLJS.aH("Count of {0}",$CLJS.J([a]));case "cum-count":return $CLJS.aH("Cumulative count of {0}",$CLJS.J([a]));default:throw Error(["No matching clause: ",$CLJS.p.g(e)].join(""));}else switch(e=e instanceof $CLJS.N?e.N:null,e){case "count":return $CLJS.bH("Count");case "cum-count":return $CLJS.bH("Cumulative count");
default:throw Error(["No matching clause: ",$CLJS.p.g(e)].join(""));}});$CLJS.W0.o(null,T3,function(a,b,c){a=$CLJS.K(c,0,null);a=a instanceof $CLJS.N?a.N:null;switch(a){case "count":return"count";case "cum-count":return"cum_count";default:throw Error(["No matching clause: ",$CLJS.p.g(a)].join(""));}});$CLJS.y0.o(null,T3,function(a,b,c){var d=$CLJS.U.j,e=$CLJS.yj($CLJS.y0,U3);a=e.j?e.j(a,b,c):e.call(null,a,b,c);return d.call($CLJS.U,a,$CLJS.Pl,$CLJS.XH)});$CLJS.V0.o(null,$CLJS.dI,function(){return $CLJS.bH("Case")});
$CLJS.W0.o(null,$CLJS.dI,function(){return"case"});$CLJS.BU(S3,U3);for(var b4=$CLJS.A(new $CLJS.R(null,9,5,$CLJS.S,[$CLJS.HI,$CLJS.YJ,$CLJS.SH,$CLJS.cm,$CLJS.BJ,$CLJS.vk,$CLJS.GJ,$CLJS.zJ,$CLJS.VH],null)),c4=null,d4=0,e4=0;;)if(e4<d4){var wra=c4.aa(null,e4);$CLJS.BU(wra,S3);e4+=1}else{var f4=$CLJS.A(b4);if(f4){var g4=f4;if($CLJS.re(g4)){var h4=$CLJS.$c(g4),xra=$CLJS.ad(g4),yra=h4,zra=$CLJS.E(h4);b4=xra;c4=yra;d4=zra}else{var Ara=$CLJS.C(g4);$CLJS.BU(Ara,S3);b4=$CLJS.D(g4);c4=null;d4=0}e4=0}else break}
$CLJS.W0.o(null,S3,function(a,b,c){a=$CLJS.K(c,0,null);$CLJS.K(c,1,null);$CLJS.K(c,2,null);c=a instanceof $CLJS.N?a.N:null;switch(c){case "avg":return"avg";case "cum-sum":return"sum";case "distinct":return"count";case "max":return"max";case "median":return"median";case "min":return"min";case "stddev":return"stddev";case "sum":return"sum";case "var":return"var";default:throw Error(["No matching clause: ",$CLJS.p.g(c)].join(""));}});
$CLJS.V0.o(null,S3,function(a,b,c,d){var e=$CLJS.K(c,0,null);$CLJS.K(c,1,null);c=$CLJS.K(c,2,null);a=$CLJS.z0.C(a,b,c,d);e=e instanceof $CLJS.N?e.N:null;switch(e){case "avg":return $CLJS.aH("Average of {0}",$CLJS.J([a]));case "cum-sum":return $CLJS.aH("Cumulative sum of {0}",$CLJS.J([a]));case "distinct":return $CLJS.aH("Distinct values of {0}",$CLJS.J([a]));case "max":return $CLJS.aH("Max of {0}",$CLJS.J([a]));case "median":return $CLJS.aH("Median of {0}",$CLJS.J([a]));case "min":return $CLJS.aH("Min of {0}",
$CLJS.J([a]));case "stddev":return $CLJS.aH("Standard deviation of {0}",$CLJS.J([a]));case "sum":return $CLJS.aH("Sum of {0}",$CLJS.J([a]));case "var":return $CLJS.aH("Variance of {0}",$CLJS.J([a]));default:throw Error(["No matching clause: ",$CLJS.p.g(e)].join(""));}});$CLJS.V0.o(null,$CLJS.rI,function(a,b,c,d){$CLJS.K(c,0,null);$CLJS.K(c,1,null);var e=$CLJS.K(c,2,null);c=$CLJS.K(c,3,null);return $CLJS.aH("{0}th percentile of {1}",$CLJS.J([c,$CLJS.z0.C(a,b,e,d)]))});$CLJS.W0.o(null,$CLJS.rI,function(){return"percentile"});
$CLJS.BU($CLJS.rI,U3);$CLJS.V0.o(null,$CLJS.VJ,function(a,b,c,d){$CLJS.K(c,0,null);$CLJS.K(c,1,null);var e=$CLJS.K(c,2,null);$CLJS.K(c,3,null);return $CLJS.aH("Sum of {0} matching condition",$CLJS.J([$CLJS.z0.C(a,b,e,d)]))});$CLJS.W0.o(null,$CLJS.VJ,function(a,b,c){$CLJS.K(c,0,null);$CLJS.K(c,1,null);var d=$CLJS.K(c,2,null);$CLJS.K(c,3,null);return["sum_where_",$CLJS.p.g($CLJS.X0.j(a,b,d))].join("")});$CLJS.BU($CLJS.VJ,U3);$CLJS.V0.o(null,$CLJS.dJ,function(){return $CLJS.bH("Share of rows matching condition")});
$CLJS.W0.o(null,$CLJS.dJ,function(){return"share"});$CLJS.BU($CLJS.dJ,U3);$CLJS.V0.o(null,$CLJS.kJ,function(){return $CLJS.bH("Count of rows matching condition")});$CLJS.W0.o(null,$CLJS.kJ,function(){return"count-where"});$CLJS.BU($CLJS.kJ,U3);
$CLJS.y0.o(null,U3,function(a,b,c){$CLJS.K(c,0,null);$CLJS.K(c,1,null);var d=$CLJS.K(c,2,null),e=$CLJS.mn.l;d=$CLJS.m(d)?$CLJS.ri($CLJS.y0.j(a,b,d),new $CLJS.R(null,1,5,$CLJS.S,[$CLJS.AQ],null)):null;var f=$CLJS.yj($CLJS.y0,$CLJS.Uj);a=f.j?f.j(a,b,c):f.call(null,a,b,c);return e.call($CLJS.mn,$CLJS.J([d,a]))});$CLJS.rV.o(null,$CLJS.ZO,function(a){return a});$CLJS.V0.o(null,$CLJS.JV,function(a,b,c){a=$CLJS.Uf(c);a=$CLJS.M.h(a,$CLJS.FV);return $CLJS.YH.g(a.A?a.A():a.call(null))});
$CLJS.a1.o(null,$CLJS.JV,function(a,b,c){var d=$CLJS.Uf(c);a=$CLJS.M.h(d,$CLJS.QU);b=$CLJS.M.h(d,$CLJS.FV);c=$CLJS.M.h(d,$CLJS.DV);d=$CLJS.M.h(d,$CLJS.a0);a=$CLJS.U.l(b.A?b.A():b.call(null),$CLJS.T0,$CLJS.sF(a),$CLJS.J([$CLJS.S0,c]));return null!=d?$CLJS.U.j(a,$CLJS.H0,d):a});