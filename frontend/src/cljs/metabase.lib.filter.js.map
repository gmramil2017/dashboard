{"version":3,"sources":["metabase/lib/filter.cljc"],"mappings":"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","names":["seq__79591","cljs.core/seq","chunk__79592","count__79593","i__79594","temp__5804__auto__","cljs.core/chunked-seq?","c__5568__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","cljs.core/first","cljs.core/next","tag","metabase.lib.hierarchy/derive","seq__79601","chunk__79602","count__79603","i__79604","seq__79617","chunk__79618","count__79619","i__79620","seq__79625","chunk__79626","count__79627","i__79628","metabase.lib.metadata.calculation/describe-top-level-key-method","query","stage-number","_key","filters","cljs.core/not-empty","metabase.lib.util/query-stage","metabase.shared.util.i18n.js_i18n","metabase.lib.util/join-strings-with-conjunction","metabase.shared.util.i18n/js-i18n","iter__5523__auto__","s__79640","cljs.core/LazySeq","c__5521__auto__","size__5522__auto__","b__79642","cljs.core/chunk-buffer","i__79641","cljs.core/-nth","cljs.core/chunk-append","cljs.core/chunk-cons","cljs.core/chunk","iter__79639","cljs.core/cons","cljs.core/rest","filter","metabase.lib.metadata.calculation.display_name","metabase.lib.metadata.calculation/display-name-method","p__79652","vec__79655","seq__79656","first__79657","_opts","subclauses","style","G__79661","cljs.core/Keyword","js/Error","s__79663","b__79665","i__79664","iter__79662","clause","p__79667","vec__79668","seq__79669","first__79670","exprs","display-names","p1__79666#","cljs.core.map","cljs.core._EQ_","vec__79671","cljs.core.nth","x","y","G__79674","expr","values","G__79675","p__79678","vec__79681","G__79685","p__79692","vec__79693","_tag","p__79696","vec__79697","opts","lat-expr","lon-expr","lat-max","lon-min","lat-min","lon-max","p__79700","vec__79701","G__79706","p__79708","vec__79709","n","unit","clojure.string/lower-case","metabase.lib.temporal-bucket/describe-temporal-interval","var_args","args__5775__auto__","len__5769__auto__","i__5770__auto__","argseq__5776__auto__","cljs.core/IndexedSeq","metabase.lib.filter/and","metabase.lib.common/defop-create","cljs.core.list_STAR_","seq79713","G__79714","G__79715","self__5754__auto__","more","metabase.lib.filter/or","seq79717","G__79718","G__79719","metabase.lib.filter/not","metabase.lib.filter/=","seq79735","G__79736","G__79737","metabase.lib.filter/!=","seq79744","G__79745","G__79746","metabase.lib.filter/<","metabase.lib.filter/<=","metabase.lib.filter/>","metabase.lib.filter/>=","metabase.lib.filter/between","lower","upper","metabase.lib.filter/inside","lat","lon","metabase.lib.filter/is-null","metabase.lib.filter/not-null","metabase.lib.filter/is-empty","metabase.lib.filter/not-empty","metabase.lib.filter/starts-with","whole","part","metabase.lib.filter/ends-with","metabase.lib.filter/contains","metabase.lib.filter/does-not-contain","metabase.lib.filter/time-interval","amount","metabase.lib.filter/segment","segment-id","G__79793","metabase.lib.filter/filter","boolean-expression","metabase.lib.filter.filter","or__5045__auto__","new-filter","metabase.lib.common/->op-arg","metabase.lib.util.update_query_stage","cljs.core/update","cljs.core.fnil","cljs.core/conj","G__79799","metabase.lib.filter/filters","metabase.lib.filter.filters","metabase.lib.filter/ColumnWithOperators","metabase.lib.metadata/ColumnMetadata","metabase.lib.filter/filterable-column-operators","filterable-column","G__79803","metabase.lib.filter/filterable-columns","metabase.lib.filter.filterable_columns","stage","columns","metabase.lib.metadata.calculation.visible_columns","with-operators","column","operators","metabase.lib.filter.operator/filter-operators","cljs.core.assoc","cljs.core.into","cljs.core.keep","metabase.lib.filter/filter-clause","seq79806","G__79807","G__79808","filter-operator","args","metabase.lib.options/ensure-uuid","G__79818","metabase.lib.filter/filter-operator","a-filter-clause","metabase.lib.filter.filter_operator","vec__79820","op","_","first-arg","ref->col","cljs.core/zipmap","metabase.lib.ref/ref","col-ref","metabase.lib.equality.find_closest_matching_ref","cljs.core/keys","p1__79815#","medley.core.find_first","metabase.lib.filter.operator.operator_def"],"sourcesContent":["(ns metabase.lib.filter\n  (:refer-clojure\n   :exclude\n   [filter and or not = < <= > >= not-empty case])\n  (:require\n   [clojure.string :as str]\n   [medley.core :as m]\n   [metabase.lib.common :as lib.common]\n   [metabase.lib.equality :as lib.equality]\n   [metabase.lib.filter.operator :as lib.filter.operator]\n   [metabase.lib.hierarchy :as lib.hierarchy]\n   [metabase.lib.metadata :as lib.metadata]\n   [metabase.lib.metadata.calculation :as lib.metadata.calculation]\n   [metabase.lib.options :as lib.options]\n   [metabase.lib.ref :as lib.ref]\n   [metabase.lib.schema :as lib.schema]\n   [metabase.lib.schema.expression :as lib.schema.expression]\n   [metabase.lib.schema.filter :as lib.schema.filter]\n   [metabase.lib.temporal-bucket :as lib.temporal-bucket]\n   [metabase.lib.util :as lib.util]\n   [metabase.shared.util.i18n :as i18n]\n   [metabase.util.malli :as mu])\n  #?(:cljs (:require-macros [metabase.lib.filter])))\n\n(doseq [tag [:and :or]]\n  (lib.hierarchy/derive tag ::compound))\n\n(doseq [tag [:= :!=]]\n  (lib.hierarchy/derive tag ::varargs))\n\n(doseq [tag [:< :<= :> :>= :starts-with :ends-with :contains :does-not-contain]]\n  (lib.hierarchy/derive tag ::binary))\n\n(doseq [tag [:is-null :not-null :is-empty :not-empty :not]]\n  (lib.hierarchy/derive tag ::unary))\n\n(defmethod lib.metadata.calculation/describe-top-level-key-method :filters\n  [query stage-number _key]\n  (when-let [filters (clojure.core/not-empty (:filters (lib.util/query-stage query stage-number)))]\n    (i18n/tru \"Filtered by {0}\"\n              (lib.util/join-strings-with-conjunction\n                (i18n/tru \"and\")\n                (for [filter filters]\n                  (lib.metadata.calculation/display-name query stage-number filter :long))))))\n\n;;; Display names for filter clauses are only really used in generating descriptions for `:case` aggregations or for\n;;; generating the suggested name for a query.\n\n(defmethod lib.metadata.calculation/display-name-method ::compound\n  [query stage-number [tag _opts & subclauses] style]\n  (lib.util/join-strings-with-conjunction\n   (clojure.core/case tag\n     :and (i18n/tru \"and\")\n     :or  (i18n/tru \"or\"))\n   (for [clause subclauses]\n     (lib.metadata.calculation/display-name query stage-number clause style))))\n\n(defmethod lib.metadata.calculation/display-name-method ::varargs\n  [query stage-number [tag _opts & exprs] style]\n  (let [display-names (map #(lib.metadata.calculation/display-name query stage-number % style)\n                           exprs)]\n    (if (clojure.core/= (count exprs) 2)\n      (let [[x y] display-names]\n        (clojure.core/case tag\n          :=  (i18n/tru \"{0} equals {1}\"         x y)\n          :!= (i18n/tru \"{0} does not equal {1}\" x y)))\n      ;; with > 2 args, `:=` works like SQL `IN`.\n      ;;\n      ;; with > 2 args, `:!=` works like SQL `NOT IN`.\n      (let [expr   (first display-names)\n            values (lib.util/join-strings-with-conjunction\n                    (i18n/tru \"or\")\n                    (rest display-names))]\n        (clojure.core/case tag\n          :=  (i18n/tru \"{0} equals any of {1}\"         expr values)\n          :!= (i18n/tru \"{0} does not equal any of {1}\" expr values))))))\n\n(defmethod lib.metadata.calculation/display-name-method ::binary\n  [query stage-number [tag _opts x y] style]\n  (let [x (lib.metadata.calculation/display-name query stage-number x style)\n        y (lib.metadata.calculation/display-name query stage-number y style)]\n    (clojure.core/case tag\n      :<                (i18n/tru \"{0} is less than {1}\"                x y)\n      :<=               (i18n/tru \"{0} is less than or equal to {1}\"    x y)\n      :>                (i18n/tru \"{0} is greater than {1}\"             x y)\n      :>=               (i18n/tru \"{0} is greater than or equal to {1}\" x y)\n      :starts-with      (i18n/tru \"{0} starts with {1}\"                 x y)\n      :ends-with        (i18n/tru \"{0} ends with {1}\"                   x y)\n      :contains         (i18n/tru \"{0} contains {1}\"                    x y)\n      :does-not-contain (i18n/tru \"{0} does not contain {1}\"            x y))))\n\n(defmethod lib.metadata.calculation/display-name-method :between\n  [query stage-number [_tag _opts expr x y] style]\n  (i18n/tru \"{0} is between {1} and {2}\"\n            (lib.metadata.calculation/display-name query stage-number expr style)\n            (lib.metadata.calculation/display-name query stage-number x    style)\n            (lib.metadata.calculation/display-name query stage-number y    style)))\n\n(defmethod lib.metadata.calculation/display-name-method :inside\n  [query stage-number [_tag opts lat-expr lon-expr lat-max lon-min lat-min lon-max] style]\n  (lib.metadata.calculation/display-name query stage-number\n                                         [:and opts\n                                          [:between opts lat-expr lat-min lat-max]\n                                          [:between opts lon-expr lon-min lon-max]]\n                                         style))\n\n(defmethod lib.metadata.calculation/display-name-method ::unary\n  [query stage-number [tag _opts expr] style]\n  (let [expr (lib.metadata.calculation/display-name query stage-number expr style)]\n    ;; for whatever reason the descriptions of for `:is-null` and `:not-null` is \"is empty\" and \"is not empty\".\n    (clojure.core/case tag\n      :is-null   (i18n/tru \"{0} is empty\"     expr)\n      :not-null  (i18n/tru \"{0} is not empty\" expr)\n      :is-empty  (i18n/tru \"{0} is empty\"     expr)\n      :not-empty (i18n/tru \"{0} is not empty\" expr)\n      ;; TODO -- This description is sorta wack, we should use [[metabase.mbql.util/negate-filter-clause]] to negate\n      ;; `expr` and then generate a description. That would require porting that stuff to pMBQL tho.\n      :not       (i18n/tru \"not {0}\" expr))))\n\n(defmethod lib.metadata.calculation/display-name-method :time-interval\n  [query stage-number [_tag _opts expr n unit] style]\n  (i18n/tru \"{0} is within {1}\"\n            (lib.metadata.calculation/display-name query stage-number expr style)\n            ;; this should legitimately be lowercasing in the user locale. I know system locale isn't necessarily the\n            ;; same thing, but it might be. This will have to do until we have some sort of user-locale lower-case\n            ;; functionality\n            #_ {:clj-kondo/ignore [:discouraged-var]}\n            (str/lower-case (lib.temporal-bucket/describe-temporal-interval n unit))))\n\n(lib.common/defop and [x y & more])\n(lib.common/defop or [x y & more])\n(lib.common/defop not [x])\n(lib.common/defop = [x y & more])\n(lib.common/defop != [x y & more])\n(lib.common/defop < [x y])\n(lib.common/defop <= [x y])\n(lib.common/defop > [x y])\n(lib.common/defop >= [x y])\n(lib.common/defop between [x lower upper])\n(lib.common/defop inside [lat lon lat-max lon-min lat-min lon-max])\n(lib.common/defop is-null [x])\n(lib.common/defop not-null [x])\n(lib.common/defop is-empty [x])\n(lib.common/defop not-empty [x])\n(lib.common/defop starts-with [whole part])\n(lib.common/defop ends-with [whole part])\n(lib.common/defop contains [whole part])\n(lib.common/defop does-not-contain [whole part])\n(lib.common/defop time-interval [x amount unit])\n(lib.common/defop segment [segment-id])\n\n(mu/defn filter :- :metabase.lib.schema/query\n  \"Sets `boolean-expression` as a filter on `query`.\"\n  ([query :- :metabase.lib.schema/query\n    boolean-expression]\n   (metabase.lib.filter/filter query nil boolean-expression))\n\n  ([query :- :metabase.lib.schema/query\n    stage-number :- [:maybe :int]\n    boolean-expression]\n   (let [stage-number (clojure.core/or stage-number -1)\n         new-filter (lib.common/->op-arg boolean-expression)]\n     (lib.util/update-query-stage query stage-number update :filters (fnil conj []) new-filter))))\n\n(mu/defn filters :- [:maybe [:ref ::lib.schema/filters]]\n  \"Returns the current filters in stage with `stage-number` of `query`.\n  If `stage-number` is omitted, the last stage is used. Logicaly, the\n  filter attached to the query is the conjunction of the expressions\n  in the returned list. If the returned list is empty, then there is no\n  filter attached to the query.\n  See also [[metabase.lib.util/query-stage]].\"\n  ([query :- :metabase.lib.schema/query] (filters query nil))\n  ([query :- :metabase.lib.schema/query\n    stage-number :- [:maybe :int]]\n   (clojure.core/not-empty (:filters (lib.util/query-stage query (clojure.core/or stage-number -1))))))\n\n(def ^:private ColumnWithOperators\n  [:merge\n   lib.metadata/ColumnMetadata\n   [:map\n    [:operators {:optional true} [:sequential ::lib.schema.filter/operator]]]])\n\n(mu/defn filterable-column-operators :- [:maybe [:sequential ::lib.schema.filter/operator]]\n  \"Returns the operators for which `filterable-column` is applicable.\"\n  [filterable-column :- ColumnWithOperators]\n  (:operators filterable-column))\n\n(mu/defn filterable-columns :- [:sequential ColumnWithOperators]\n  \"Get column metadata for all the columns that can be filtered in\n  the stage number `stage-number` of the query `query`\n  If `stage-number` is omitted, the last stage is used.\n  The rules for determining which columns can be broken out by are as follows:\n\n  1. custom `:expressions` in this stage of the query\n\n  2. Fields 'exported' by the previous stage of the query, if there is one;\n     otherwise Fields from the current `:source-table`\n\n  3. Fields exported by explicit joins\n\n  4. Fields in Tables that are implicitly joinable.\"\n\n  ([query :- ::lib.schema/query]\n   (filterable-columns query -1))\n\n  ([query        :- ::lib.schema/query\n    stage-number :- :int]\n   (let [stage (lib.util/query-stage query stage-number)\n         columns (lib.metadata.calculation/visible-columns query stage-number stage)\n         with-operators (fn [column]\n                          (when-let [operators (clojure.core/not-empty (lib.filter.operator/filter-operators column))]\n                            (assoc column :operators operators)))]\n     (clojure.core/not-empty\n       (into []\n             (keep with-operators)\n             columns)))))\n\n(mu/defn filter-clause :- ::lib.schema.expression/boolean\n  \"Returns a standalone filter clause for a `filter-operator`,\n  a `column`, and arguments.\"\n  [filter-operator :- ::lib.schema.filter/operator\n   column :- lib.metadata/ColumnMetadata\n   & args]\n  (lib.options/ensure-uuid (into [(:short filter-operator) {} (lib.common/->op-arg column)]\n                                 (map lib.common/->op-arg args))))\n\n(mu/defn filter-operator :- ::lib.schema.filter/operator\n  \"Return the filter operator of the boolean expression `filter-clause`\n  at `stage-number` in `query`.\n  If `stage-number` is omitted, the last stage is used.\"\n  ([query a-filter-clause]\n   (filter-operator query -1 a-filter-clause))\n\n  ([query :- ::lib.schema/query\n    stage-number :- :int\n    a-filter-clause :- ::lib.schema.expression/boolean]\n   (let [[op _ first-arg] a-filter-clause\n         stage (lib.util/query-stage query stage-number)\n         columns (lib.metadata.calculation/visible-columns query stage-number stage)\n         ref->col (zipmap (map lib.ref/ref columns) columns)\n         col-ref (lib.equality/find-closest-matching-ref first-arg (keys ref->col))]\n     (clojure.core/or (m/find-first #(clojure.core/= (:short %) op)\n                                    (lib.filter.operator/filter-operators (ref->col col-ref)))\n                      (lib.filter.operator/operator-def op)))))\n"]}