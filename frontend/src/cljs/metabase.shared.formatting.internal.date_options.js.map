{"version":3,"sources":["metabase/shared/formatting/internal/date_options.cljc"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA,mEAAA,2CAAA,qEAAA,KAAA,yHAAA,0HAAA,wEAAA,UAAA,oDAAA,jjBAAeA,yPAEIC,0HACAC;AAInB,mEAAA,iFAAA,0DAAA,iEAAA,wEAAA,vVAAeC;AAGf,kEAAA,iFAAA,UAAA,wDAAA,0DAAA,2DAAA,iEAAA,3YAAeC;AAGf,oEAAA,iFAAA,rJAAeC;AAGf;;;;;;;;;;;mEAAA,nEAAMC,8IAUHC;AAVH,AAWE,IAAMA,6DAA0C,AAACI,4BAAgBJ,3EACjB,oFAAA,pFAACK,wIAAaC;IAD9DL,aAI4C,AAACU,uGAAMlB,iEACA,kBAAM,iBAAAmB,WAAiB,AAAA,kFAAOZ;AAAxB,AAAA,wMAAAY,uFAAAA,vRAAChB,iGAAAA,2GAAAA;MAAP,AAAA,2CAAA,sEAAA,kBAAA,MAEAI;IAPnDC,iBAAA,AAAAC,4BAAAD;kBAAAA,dAIWD;cAJX,AAAAG,4CAAAF,eAAA,rEAEcM;sBAFd,AAAAJ,4CAAAF,eAAA,7EAEsBO;WAFtB,AAAAL,4CAAAF,eAAA,lEAGcQ;WAHd,AAAAN,4CAAAF,eAAA,lEAGmBS;AAHnB,AAQE,IAAAG,WAAQb;IAARa,eAAA,AAC+B,sDAAAA,SAAA,6GAAA,5KAACC;;IADhCD,eAAA,wbAAAA,taAEE,CAACf,kGAAAA,wGAAAA,RAAWY,oFAAAA,QAAiB,8CAAAG,aAAA,qEAAA,hIAACE;IAFhCF,eAAA,gNAAAA,9MAGE,kDAAA,lDAACG,6CAAEP,iBAA0B,8CAAAI,aAAA,wEAAA,nIAACE;IAHhCF,eAAA,kBAIE,iBAAAI,mBAAIV;AAAJ,AAAA,oBAAAU;AAAAA;;AAAYT;;oJAJdK,9IAI+B,8CAAAA,aAAA,wEAAA,nIAACE;AAJhC,AAAA,GAKE,AAACG,cAAI,CAACrB,gGAAAA,sGAAAA,RAAea,kFAAAA;AAAQ,sDAAAG,aAAA,5DAACC;;AALhCD","names":["metabase.shared.formatting.internal.date-options/default-options","metabase.shared.formatting.constants/default-date-style","metabase.shared.formatting.constants/default-time-style","metabase.shared.formatting.internal.date-options/units-with-hour","metabase.shared.formatting.internal.date-options/units-with-day","metabase.shared.formatting.internal.date-options/time-only?","metabase.shared.formatting.internal.date-options/prepare-options","options","map__81634","cljs.core/--destructure-map","cljs.core.get","metabase.util/normalize-map","cljs.core.update","cljs.core/keyword","compact","date-abbreviate","type","unit","cljs.core.merge","G__81635","G__81636","cljs.core.dissoc","cljs.core.assoc","cljs.core._EQ_","or__5045__auto__","cljs.core/not"],"sourcesContent":["(ns metabase.shared.formatting.internal.date-options\n  \"Normalization and helper predicates for date formatting options maps.\"\n  (:require\n   [metabase.shared.formatting.constants :as constants]\n   [metabase.util :as u]))\n\n(def ^:private default-options\n  {:date-enabled   true\n   :date-style     constants/default-date-style\n   :time-style     constants/default-time-style\n   :output-density \"default\"\n   :unit           :default})\n\n(def ^:private units-with-hour\n  #{:default  :minute  :hour  :hour-of-day})\n\n(def ^:private units-with-day\n  #{nil :default :minute :hour :day :week})\n\n(def ^:private time-only?\n  #{:hour-of-day})\n\n(defn prepare-options\n  \"Normalizes the options map. This returns a Clojure map with `:kebab-case-keys`, whatever the input object or\n  key spelling.\n\n  Mixes in the [[default-options]], plus:\n  - defaulting `:time-enabled` to `\\\"minutes\\\"` if the `:unit` is smaller than a day.\n  - transforming `:date-format` and `:time-format` to the corresponding styles.\n  - transforming `:type` of `\\\"cell\\\"` or `\\\"tooltip\\\"` to `condensed` output density\n  - transforming `:compact true` to `:output-density \\\"compact\\\"` (takes precedence over `\\\"condensed\\\"`).\n  - make `:unit` a keyword\"\n  [options]\n  (let [options                               (-> (u/normalize-map options)\n                                                  (update :unit keyword))\n        {:keys [compact date-abbreviate\n                type unit]\n         :as options}                         (merge default-options\n                                                     (when (units-with-hour (:unit options))\n                                                       {:time-enabled \"minutes\"})\n                                                     options)]\n    (cond-> options\n      true                         (dissoc :compact :date-abbreviate)\n      (time-only? unit)            (assoc :date-enabled false)\n      (= type \"tooltip\")           (assoc :output-density \"condensed\")\n      (or compact date-abbreviate) (assoc :output-density \"compact\")\n      (not (units-with-day unit))  (dissoc :weekday-enabled))))\n"]}