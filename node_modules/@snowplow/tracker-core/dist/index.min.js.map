{"version":3,"file":"index.min.js","sources":["../src/payload.ts","../src/base64.ts","../../../common/temp/node_modules/.pnpm/tslib@2.3.0/node_modules/tslib/tslib.es6.js","../src/contexts.ts","../src/core.ts","../src/logger.ts","../../../common/temp/node_modules/.pnpm/uuid@3.4.0/node_modules/uuid/lib/rng-browser.js","../../../common/temp/node_modules/.pnpm/uuid@3.4.0/node_modules/uuid/lib/bytesToUuid.js","../../../common/temp/node_modules/.pnpm/uuid@3.4.0/node_modules/uuid/v1.js","../../../common/temp/node_modules/.pnpm/uuid@3.4.0/node_modules/uuid/v4.js","../../../common/temp/node_modules/.pnpm/uuid@3.4.0/node_modules/uuid/index.js"],"sourcesContent":["/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { base64urlencode } from './base64';\n\n/**\n * Type for a Payload dictionary\n */\nexport type Payload = Record<string, unknown>;\n\n/**\n * A tuple which represents the unprocessed JSON to be added to the Payload\n */\nexport type EventJsonWithKeys = { keyIfEncoded: string; keyIfNotEncoded: string; json: Record<string, unknown> };\n\n/**\n * An array of tuples which represents the unprocessed JSON to be added to the Payload\n */\nexport type EventJson = Array<EventJsonWithKeys>;\n\n/**\n * A function which will processor the Json onto the injected PayloadBuilder\n */\nexport type JsonProcessor = (payloadBuilder: PayloadBuilder, jsonForProcessing: EventJson) => void;\n\n/**\n * Interface for mutable object encapsulating tracker payload\n */\nexport interface PayloadBuilder {\n  /**\n   * Adds an entry to the Payload\n   * @param key - Key for Payload dictionary entry\n   * @param value - Value for Payload dictionaty entry\n   */\n  add: (key: string, value: unknown) => void;\n\n  /**\n   * Merges a payload into the existing payload\n   * @param dict - The payload to merge\n   */\n  addDict: (dict: Payload) => void;\n\n  /**\n   * Caches a JSON object to be added to payload on build\n   * @param keyIfEncoded - key if base64 encoding is enabled\n   * @param keyIfNotEncoded - key if base64 encoding is disabled\n   * @param json - The json to be stringified and added to the payload\n   */\n  addJson: (keyIfEncoded: string, keyIfNotEncoded: string, json: Record<string, unknown>) => void;\n\n  /**\n   * Gets the current payload, before cached JSON is processed\n   */\n  getPayload: () => Payload;\n\n  /**\n   * Gets all JSON objects added to payload\n   */\n  getJson: () => EventJson;\n\n  /**\n   * Adds a function which will be executed when building\n   * the payload to process the JSON which has been added to this payload\n   * @param jsonProcessor - The JsonProcessor function for this builder\n   */\n  withJsonProcessor: (jsonProcessor: JsonProcessor) => void;\n\n  /**\n   * Builds and returns the Payload\n   * @param base64Encode - configures if unprocessed, cached json should be encoded\n   */\n  build: () => Payload;\n}\n\nexport function payloadBuilder(): PayloadBuilder {\n  const dict: Payload = {},\n    allJson: EventJson = [],\n    jsonForProcessing: EventJson = [];\n  let processor: JsonProcessor | undefined;\n\n  const add = (key: string, value: unknown): void => {\n    if (value != null && value !== '') {\n      // null also checks undefined\n      dict[key] = value;\n    }\n  };\n\n  const addDict = (dict: Payload): void => {\n    for (const key in dict) {\n      if (Object.prototype.hasOwnProperty.call(dict, key)) {\n        add(key, dict[key]);\n      }\n    }\n  };\n\n  const addJson = (keyIfEncoded: string, keyIfNotEncoded: string, json?: Record<string, unknown>): void => {\n    if (json && isNonEmptyJson(json)) {\n      const jsonWithKeys = { keyIfEncoded, keyIfNotEncoded, json };\n      jsonForProcessing.push(jsonWithKeys);\n      allJson.push(jsonWithKeys);\n    }\n  };\n\n  return {\n    add,\n    addDict,\n    addJson,\n    getPayload: () => dict,\n    getJson: () => allJson,\n    withJsonProcessor: (jsonProcessor) => {\n      processor = jsonProcessor;\n    },\n    build: function () {\n      processor?.(this, jsonForProcessing);\n      return dict;\n    },\n  };\n}\n\n/**\n * A helper to build a Snowplow request from a set of name-value pairs, provided using the add methods.\n * Will base64 encode JSON, if desired, on build\n *\n * @returns The request builder, with add and build methods\n */\nexport function payloadJsonProcessor(encodeBase64: boolean): JsonProcessor {\n  return (payloadBuilder: PayloadBuilder, jsonForProcessing: EventJson) => {\n    for (const json of jsonForProcessing) {\n      const str = JSON.stringify(json.json);\n      if (encodeBase64) {\n        payloadBuilder.add(json.keyIfEncoded, base64urlencode(str));\n      } else {\n        payloadBuilder.add(json.keyIfNotEncoded, str);\n      }\n    }\n    jsonForProcessing.length = 0;\n  };\n}\n\n/**\n * Is property a non-empty JSON?\n * @param property - Checks if object is non-empty json\n */\nexport function isNonEmptyJson(property?: Record<string, unknown>): boolean {\n  if (!isJson(property)) {\n    return false;\n  }\n  for (const key in property) {\n    if (Object.prototype.hasOwnProperty.call(property, key)) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Is property a JSON?\n * @param property - Checks if object is json\n */\nexport function isJson(property?: Record<string, unknown>): boolean {\n  return (\n    typeof property !== 'undefined' &&\n    property !== null &&\n    (property.constructor === {}.constructor || property.constructor === [].constructor)\n  );\n}\n","/*\n * Copyright (c) 2013 Kevin van Zonneveld (http://kvz.io)\n * and Contributors (http://phpjs.org/authors)\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy of\n * this software and associated documentation files (the \"Software\"), to deal in\n * the Software without restriction, including without limitation the rights to\n * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies\n * of the Software, and to permit persons to whom the Software is furnished to do\n * so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n// Deprecated and removed in TypeScript\ndeclare function unescape(s: string): string;\n\n/**\n * Decodes a url safe Base 64 encoded string\n * @remarks See: {@link http://tools.ietf.org/html/rfc4648#page-7}\n * @param data - String to decode\n * @returns The decoded string\n */\nexport function base64urldecode(data: string): string {\n  if (!data) {\n    return data;\n  }\n  const padding = 4 - (data.length % 4);\n  switch (padding) {\n    case 2:\n      data += '==';\n      break;\n    case 3:\n      data += '=';\n      break;\n  }\n  const b64Data = data.replace(/-/g, '+').replace(/_/g, '/');\n  return base64decode(b64Data);\n}\n\n/**\n * Encodes a string into a url safe Base 64 encoded string\n * @remarks See: {@link http://tools.ietf.org/html/rfc4648#page-7}\n * @param data - String to encode\n * @returns The url safe Base 64 string\n */\nexport function base64urlencode(data: string): string {\n  if (!data) {\n    return data;\n  }\n\n  const enc = base64encode(data);\n  return enc.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n\nconst b64 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n/**\n * Encode string as base64.\n * Any type can be passed, but will be stringified\n *\n * @param data - string to encode\n * @returns base64-encoded string\n */\nexport function base64encode(data: string): string {\n  // discuss at: http://phpjs.org/functions/base64_encode/\n  // original by: Tyler Akins (http://rumkin.com)\n  // improved by: Bayron Guevara\n  // improved by: Thunder.m\n  // improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n  // improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)\n  // improved by: Rafał Kukawski (http://kukawski.pl)\n  // bugfixed by: Pellentesque Malesuada\n  // example 1: base64_encode('Kevin van Zonneveld');\n  // returns 1: 'S2V2aW4gdmFuIFpvbm5ldmVsZA=='\n  // example 2: base64_encode('a');\n  // returns 2: 'YQ=='\n  // example 3: base64_encode('✓ à la mode');\n  // returns 3: '4pyTIMOgIGxhIG1vZGU='\n\n  let o1,\n    o2,\n    o3,\n    h1,\n    h2,\n    h3,\n    h4,\n    bits,\n    i = 0,\n    ac = 0;\n  const tmp_arr: Array<string> = [];\n\n  if (!data) {\n    return data;\n  }\n\n  data = unescape(encodeURIComponent(data));\n\n  do {\n    // pack three octets into four hexets\n    o1 = data.charCodeAt(i++);\n    o2 = data.charCodeAt(i++);\n    o3 = data.charCodeAt(i++);\n\n    bits = (o1 << 16) | (o2 << 8) | o3;\n\n    h1 = (bits >> 18) & 0x3f;\n    h2 = (bits >> 12) & 0x3f;\n    h3 = (bits >> 6) & 0x3f;\n    h4 = bits & 0x3f;\n\n    // use hexets to index into b64, and append result to encoded string\n    tmp_arr[ac++] = b64.charAt(h1) + b64.charAt(h2) + b64.charAt(h3) + b64.charAt(h4);\n  } while (i < data.length);\n\n  const enc = tmp_arr.join('');\n\n  const r = data.length % 3;\n\n  return (r ? enc.slice(0, r - 3) : enc) + '==='.slice(r || 3);\n}\n\n/**\n * Decode base64 to string\n *\n * @param data - base64 to string\n * @returns decoded string\n */\nexport function base64decode(encodedData: string): string {\n  //  discuss at: http://locutus.io/php/base64_decode/\n  // original by: Tyler Akins (http://rumkin.com)\n  // improved by: Thunder.m\n  // improved by: Kevin van Zonneveld (http://kvz.io)\n  // improved by: Kevin van Zonneveld (http://kvz.io)\n  //    input by: Aman Gupta\n  //    input by: Brett Zamir (http://brett-zamir.me)\n  // bugfixed by: Onno Marsman (https://twitter.com/onnomarsman)\n  // bugfixed by: Pellentesque Malesuada\n  // bugfixed by: Kevin van Zonneveld (http://kvz.io)\n  // improved by: Indigo744\n  //   example 1: base64_decode('S2V2aW4gdmFuIFpvbm5ldmVsZA==')\n  //   returns 1: 'Kevin van Zonneveld'\n  //   example 2: base64_decode('YQ==')\n  //   returns 2: 'a'\n  //   example 3: base64_decode('4pyTIMOgIGxhIG1vZGU=')\n  //   returns 3: '✓ à la mode'\n\n  // decodeUTF8string()\n  // Internal function to decode properly UTF8 string\n  // Adapted from Solution #1 at https://developer.mozilla.org/en-US/docs/Web/API/WindowBase64/Base64_encoding_and_decoding\n  const decodeUTF8string = function (str: string) {\n    // Going backwards: from bytestream, to percent-encoding, to original string.\n    return decodeURIComponent(\n      str\n        .split('')\n        .map(function (c) {\n          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n        .join('')\n    );\n  };\n\n  let o1,\n    o2,\n    o3,\n    h1,\n    h2,\n    h3,\n    h4,\n    bits,\n    i = 0,\n    ac = 0,\n    dec = '';\n  const tmpArr: Array<string> = [];\n\n  if (!encodedData) {\n    return encodedData;\n  }\n\n  encodedData += '';\n\n  do {\n    // unpack four hexets into three octets using index points in b64\n    h1 = b64.indexOf(encodedData.charAt(i++));\n    h2 = b64.indexOf(encodedData.charAt(i++));\n    h3 = b64.indexOf(encodedData.charAt(i++));\n    h4 = b64.indexOf(encodedData.charAt(i++));\n\n    bits = (h1 << 18) | (h2 << 12) | (h3 << 6) | h4;\n\n    o1 = (bits >> 16) & 0xff;\n    o2 = (bits >> 8) & 0xff;\n    o3 = bits & 0xff;\n\n    if (h3 === 64) {\n      tmpArr[ac++] = String.fromCharCode(o1);\n    } else if (h4 === 64) {\n      tmpArr[ac++] = String.fromCharCode(o1, o2);\n    } else {\n      tmpArr[ac++] = String.fromCharCode(o1, o2, o3);\n    }\n  } while (i < encodedData.length);\n\n  dec = tmpArr.join('');\n\n  return decodeUTF8string(dec.replace(/\\0+$/, ''));\n}\n","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || from);\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { PayloadBuilder, Payload, isNonEmptyJson } from './payload';\nimport { SelfDescribingJson } from './core';\nimport { CorePlugin } from './plugins';\nimport { LOG } from './logger';\n\n/**\n * Argument for {@link ContextGenerator} and {@link ContextFilter} callback\n */\nexport interface ContextEvent {\n  /** The event payload */\n  event: Payload;\n  /** The event type\n   * @example 'page_view'\n   */\n  eventType: string;\n  /** The event schema where one is available, or empty string\n   * @example 'iglu:com.snowplowanalytics.snowplow/ad_impression/jsonschema/1-0-0'\n   */\n  eventSchema: string;\n}\n\n/**\n * A context generator is a user-supplied callback that is evaluated for each event\n * to allow an additional context to be dynamically attached to the event\n * @param args - - Object which contains the event information to help decide what should be included in the returned Context\n */\nexport type ContextGenerator = (args?: ContextEvent) => SelfDescribingJson;\n\n/**\n * A context filter is a user-supplied callback that is evaluated for each event\n * to determine if the context associated with the filter should be attached to the event\n * @param args - - Object that contains: event, eventType, eventSchema\n */\nexport type ContextFilter = (args?: ContextEvent) => boolean;\n\n/**\n * A context primitive is either a self-describing JSON or a context generator\n */\nexport type ContextPrimitive = SelfDescribingJson | ContextGenerator;\n\n/**\n * A filter provider is a tuple that has two parts: a context filter and the context primitive(s)\n * If the context filter evaluates to true, the tracker will attach the context primitive(s)\n */\nexport type FilterProvider = [ContextFilter, Array<ContextPrimitive> | ContextPrimitive];\n\n/**\n * A ruleset has accept or reject properties that contain rules for matching Iglu schema URIs\n */\nexport interface RuleSet {\n  accept?: Array<string> | string;\n  reject?: Array<string> | string;\n}\n\n/**\n * A ruleset provider is aa tuple that has two parts: a ruleset and the context primitive(s)\n * If the ruleset allows the current event schema URI, the tracker will attach the context primitive(s)\n */\nexport type RuleSetProvider = [RuleSet, Array<ContextPrimitive> | ContextPrimitive];\n\n/**\n * Conditional context providers are two element arrays used to decide when to attach contexts, where:\n * - the first element is some conditional criterion\n * - the second element is any number of context primitives\n */\nexport type ConditionalContextProvider = FilterProvider | RuleSetProvider;\n\n/**\n * A Dynamic context is an array of Self Describing JSON contexts, or an array of callbacks which return Self Describing JSON contexts\n * The array can be a mix of both contexts and callbacks which generate contexts\n */\nexport type DynamicContext = Array<SelfDescribingJson | ((...params: any[]) => SelfDescribingJson | null)>;\n\nexport interface GlobalContexts {\n  /**\n   * Returns all Context Primitives\n   */\n  getGlobalPrimitives(): Array<ContextPrimitive>;\n\n  /**\n   * Returns all Conditional Contexts\n   */\n  getConditionalProviders(): Array<ConditionalContextProvider>;\n\n  /**\n   * Adds conditional or primitive global contexts\n   * @param contexts - An Array of either Conditional Contexts or Primitive Contexts\n   */\n  addGlobalContexts(contexts: Array<ConditionalContextProvider | ContextPrimitive>): void;\n\n  /**\n   * Removes all global contexts\n   */\n  clearGlobalContexts(): void;\n\n  /**\n   * Removes previously added global context, performs a deep comparison of the contexts or conditional contexts\n   * @param contexts - An Array of either Condition Contexts or Primitive Contexts\n   */\n  removeGlobalContexts(contexts: Array<ConditionalContextProvider | ContextPrimitive>): void;\n\n  /**\n   * Returns all applicable global contexts for a specified event\n   * @param event - The event to check for applicable global contexts for\n   */\n  getApplicableContexts(event: PayloadBuilder): Array<SelfDescribingJson>;\n}\n\n/**\n * Contains helper functions to aid in the addition and removal of Global Contexts\n */\nexport function globalContexts(): GlobalContexts {\n  let globalPrimitives: Array<ContextPrimitive> = [];\n  let conditionalProviders: Array<ConditionalContextProvider> = [];\n\n  /**\n   * Returns all applicable global contexts for a specified event\n   * @param event - The event to check for applicable global contexts for\n   * @returns An array of contexts\n   */\n  const assembleAllContexts = (event: PayloadBuilder): Array<SelfDescribingJson> => {\n    const eventSchema = getUsefulSchema(event);\n    const eventType = getEventType(event);\n    const contexts: Array<SelfDescribingJson> = [];\n    const generatedPrimitives = generatePrimitives(globalPrimitives, event, eventType, eventSchema);\n    contexts.push(...generatedPrimitives);\n\n    const generatedConditionals = generateConditionals(conditionalProviders, event, eventType, eventSchema);\n    contexts.push(...generatedConditionals);\n\n    return contexts;\n  };\n\n  return {\n    getGlobalPrimitives(): Array<ContextPrimitive> {\n      return globalPrimitives;\n    },\n\n    getConditionalProviders(): Array<ConditionalContextProvider> {\n      return conditionalProviders;\n    },\n\n    addGlobalContexts(contexts: Array<ConditionalContextProvider | ContextPrimitive>): void {\n      const acceptedConditionalContexts: ConditionalContextProvider[] = [];\n      const acceptedContextPrimitives: ContextPrimitive[] = [];\n      for (const context of contexts) {\n        if (isConditionalContextProvider(context)) {\n          acceptedConditionalContexts.push(context);\n        } else if (isContextPrimitive(context)) {\n          acceptedContextPrimitives.push(context);\n        }\n      }\n      globalPrimitives = globalPrimitives.concat(acceptedContextPrimitives);\n      conditionalProviders = conditionalProviders.concat(acceptedConditionalContexts);\n    },\n\n    clearGlobalContexts(): void {\n      conditionalProviders = [];\n      globalPrimitives = [];\n    },\n\n    removeGlobalContexts(contexts: Array<ConditionalContextProvider | ContextPrimitive>): void {\n      for (const context of contexts) {\n        if (isConditionalContextProvider(context)) {\n          conditionalProviders = conditionalProviders.filter(\n            (item) => JSON.stringify(item) !== JSON.stringify(context)\n          );\n        } else if (isContextPrimitive(context)) {\n          globalPrimitives = globalPrimitives.filter((item) => JSON.stringify(item) !== JSON.stringify(context));\n        }\n      }\n    },\n\n    getApplicableContexts(event: PayloadBuilder): Array<SelfDescribingJson> {\n      return assembleAllContexts(event);\n    },\n  };\n}\n\nexport interface PluginContexts {\n  /**\n   * Returns list of contexts from all active plugins\n   */\n  addPluginContexts: (additionalContexts?: SelfDescribingJson[] | null) => SelfDescribingJson[];\n}\n\nexport function pluginContexts(plugins: Array<CorePlugin>): PluginContexts {\n  /**\n   * Add common contexts to every event\n   *\n   * @param array - additionalContexts List of user-defined contexts\n   * @returns userContexts combined with commonContexts\n   */\n  return {\n    addPluginContexts: (additionalContexts?: SelfDescribingJson[] | null): SelfDescribingJson[] => {\n      const combinedContexts: SelfDescribingJson[] = additionalContexts ?? [];\n\n      plugins.forEach((plugin) => {\n        try {\n          if (plugin.contexts) {\n            combinedContexts.push(...plugin.contexts());\n          }\n        } catch (ex) {\n          LOG.error('Error adding plugin contexts', ex);\n        }\n      });\n\n      return combinedContexts;\n    },\n  };\n}\n\n/**\n * Find dynamic context generating functions and return their results to be merged into the static contexts\n * Combine an array of unchanging contexts with the result of a context-creating function\n *\n * @param dynamicOrStaticContexts - Array of custom context Objects or custom context generating functions\n * @param Parameters - to pass to dynamic context callbacks\n * @returns An array of Self Describing JSON context\n */\nexport function resolveDynamicContext(\n  dynamicOrStaticContexts?: DynamicContext | null,\n  ...extraParams: any[]\n): Array<SelfDescribingJson> {\n  return (\n    (dynamicOrStaticContexts\n      ?.map(function (context) {\n        if (typeof context === 'function') {\n          try {\n            return context(...extraParams);\n          } catch (e) {\n            //TODO: provide warning\n            return undefined;\n          }\n        } else {\n          return context;\n        }\n      })\n      .filter(Boolean) as Array<SelfDescribingJson>) ?? []\n  );\n}\n\n/**\n * Slices a schema into its composite parts. Useful for ruleset filtering.\n * @param input - A schema string\n * @returns The vendor, schema name, major, minor and patch information of a schema string\n */\nexport function getSchemaParts(input: string): Array<string> | undefined {\n  const re = new RegExp(\n    '^iglu:([a-zA-Z0-9-_.]+)/([a-zA-Z0-9-_]+)/jsonschema/([1-9][0-9]*)-(0|[1-9][0-9]*)-(0|[1-9][0-9]*)$'\n  );\n  const matches = re.exec(input);\n  if (matches !== null) return matches.slice(1, 6);\n  return undefined;\n}\n\n/**\n * Validates the vendor section of a schema string contains allowed wildcard values\n * @param parts - Array of parts from a schema string\n * @returns Whether the vendor validation parts are a valid combination\n */\nexport function validateVendorParts(parts: Array<string>): boolean {\n  if (parts[0] === '*' || parts[1] === '*') {\n    return false; // no wildcard in first or second part\n  }\n  if (parts.slice(2).length > 0) {\n    let asterisk = false;\n    for (const part of parts.slice(2)) {\n      if (part === '*')\n        // mark when we've found a wildcard\n        asterisk = true;\n      else if (asterisk)\n        // invalid if alpha parts come after wildcard\n        return false;\n    }\n    return true;\n  } else if (parts.length == 2) return true;\n\n  return false;\n}\n\n/**\n * Validates the vendor part of a schema string is valid for a rule set\n * @param input - Vendor part of a schema string\n * @returns Whether the vendor validation string is valid\n */\nexport function validateVendor(input: string): boolean {\n  const parts = input.split('.');\n  if (parts && parts.length > 1) return validateVendorParts(parts);\n  return false;\n}\n\n/**\n * Checks for validity of input and returns all the sections of a schema string that are used to match rules in a ruleset\n * @param input - A Schema string\n * @returns The sections of a schema string that are used to match rules in a ruleset\n */\nexport function getRuleParts(input: string): Array<string> | undefined {\n  const re = new RegExp(\n    '^iglu:((?:(?:[a-zA-Z0-9-_]+|\\\\*).)+(?:[a-zA-Z0-9-_]+|\\\\*))/([a-zA-Z0-9-_.]+|\\\\*)/jsonschema/([1-9][0-9]*|\\\\*)-(0|[1-9][0-9]*|\\\\*)-(0|[1-9][0-9]*|\\\\*)$'\n  );\n  const matches = re.exec(input);\n  if (matches !== null && validateVendor(matches[1])) return matches.slice(1, 6);\n  return undefined;\n}\n\n/**\n * Ensures the rules specified in a schema string of a ruleset are valid\n * @param input - A Schema string\n * @returns if there rule is valid\n */\nexport function isValidRule(input: string): boolean {\n  const ruleParts = getRuleParts(input);\n  if (ruleParts) {\n    const vendor = ruleParts[0];\n    return ruleParts.length === 5 && validateVendor(vendor);\n  }\n  return false;\n}\n\n/**\n * Check if a variable is an Array containing only strings\n * @param input - The variable to validate\n * @returns True if the input is an array containing only strings\n */\nexport function isStringArray(input: unknown): input is Array<string> {\n  return (\n    Array.isArray(input) &&\n    input.every((x) => {\n      return typeof x === 'string';\n    })\n  );\n}\n\n/**\n * Validates whether a rule set is an array of valid ruleset strings\n * @param input - The Array of rule set arguments\n * @returns True is the input is an array of valid rules\n */\nexport function isValidRuleSetArg(input: unknown): boolean {\n  if (isStringArray(input))\n    return input.every((x: string) => {\n      return isValidRule(x);\n    });\n  else if (typeof input === 'string') return isValidRule(input);\n  return false;\n}\n\n/**\n * Check if a variable is a valid, non-empty Self Describing JSON\n * @param input - The variable to validate\n * @returns True if a valid Self Describing JSON\n */\nexport function isSelfDescribingJson(input: unknown): input is SelfDescribingJson {\n  const sdj = input as SelfDescribingJson;\n  if (isNonEmptyJson(sdj))\n    if ('schema' in sdj && 'data' in sdj) return typeof sdj.schema === 'string' && typeof sdj.data === 'object';\n  return false;\n}\n\n/**\n * Validates if the input object contains the expected properties of a ruleset\n * @param input - The object containing a rule set\n * @returns True if a valid rule set\n */\nexport function isRuleSet(input: unknown): input is Record<string, unknown> {\n  const ruleSet = input as Record<string, unknown>;\n  let ruleCount = 0;\n  if (input != null && typeof input === 'object' && !Array.isArray(input)) {\n    if (Object.prototype.hasOwnProperty.call(ruleSet, 'accept')) {\n      if (isValidRuleSetArg(ruleSet['accept'])) {\n        ruleCount += 1;\n      } else {\n        return false;\n      }\n    }\n    if (Object.prototype.hasOwnProperty.call(ruleSet, 'reject')) {\n      if (isValidRuleSetArg(ruleSet['reject'])) {\n        ruleCount += 1;\n      } else {\n        return false;\n      }\n    }\n    // if either 'reject' or 'accept' or both exists,\n    // we have a valid ruleset\n    return ruleCount > 0 && ruleCount <= 2;\n  }\n  return false;\n}\n\n/**\n * Validates if the function can be a valid context generator function\n * @param input - The function to be validated\n */\nexport function isContextCallbackFunction(input: unknown): boolean {\n  return typeof input === 'function' && input.length <= 1;\n}\n\n/**\n * Validates if the function can be a valid context primitive function or self describing json\n * @param input - The function or orbject to be validated\n * @returns True if either a Context Generator or Self Describing JSON\n */\nexport function isContextPrimitive(input: unknown): input is ContextPrimitive {\n  return isContextCallbackFunction(input) || isSelfDescribingJson(input);\n}\n\n/**\n * Validates if an array is a valid shape to be a Filter Provider\n * @param input - The Array of Context filter callbacks\n */\nexport function isFilterProvider(input: unknown): boolean {\n  if (Array.isArray(input)) {\n    if (input.length === 2) {\n      if (Array.isArray(input[1])) {\n        return isContextCallbackFunction(input[0]) && input[1].every(isContextPrimitive);\n      }\n      return isContextCallbackFunction(input[0]) && isContextPrimitive(input[1]);\n    }\n  }\n  return false;\n}\n\n/**\n * Validates if an array is a valid shape to be an array of rule sets\n * @param input - The Array of Rule Sets\n */\nexport function isRuleSetProvider(input: unknown): boolean {\n  if (Array.isArray(input) && input.length === 2) {\n    if (!isRuleSet(input[0])) return false;\n    if (Array.isArray(input[1])) return input[1].every(isContextPrimitive);\n    return isContextPrimitive(input[1]);\n  }\n  return false;\n}\n\n/**\n * Checks if an input array is either a filter provider or a rule set provider\n * @param input - An array of filter providers or rule set providers\n * @returns Whether the array is a valid {@link ConditionalContextProvider}\n */\nexport function isConditionalContextProvider(input: unknown): input is ConditionalContextProvider {\n  return isFilterProvider(input) || isRuleSetProvider(input);\n}\n\n/**\n * Checks if a given schema matches any rules within the provided rule set\n * @param ruleSet - The rule set containing rules to match schema against\n * @param schema - The schema to be matched against the rule set\n */\nexport function matchSchemaAgainstRuleSet(ruleSet: RuleSet, schema: string): boolean {\n  let rejectCount = 0;\n  let acceptCount = 0;\n  const acceptRules = ruleSet['accept'];\n  if (Array.isArray(acceptRules)) {\n    if ((ruleSet.accept as Array<string>).some((rule) => matchSchemaAgainstRule(rule, schema))) {\n      acceptCount++;\n    }\n  } else if (typeof acceptRules === 'string') {\n    if (matchSchemaAgainstRule(acceptRules, schema)) {\n      acceptCount++;\n    }\n  }\n\n  const rejectRules = ruleSet['reject'];\n  if (Array.isArray(rejectRules)) {\n    if ((ruleSet.reject as Array<string>).some((rule) => matchSchemaAgainstRule(rule, schema))) {\n      rejectCount++;\n    }\n  } else if (typeof rejectRules === 'string') {\n    if (matchSchemaAgainstRule(rejectRules, schema)) {\n      rejectCount++;\n    }\n  }\n\n  if (acceptCount > 0 && rejectCount === 0) {\n    return true;\n  } else if (acceptCount === 0 && rejectCount > 0) {\n    return false;\n  }\n\n  return false;\n}\n\n/**\n * Checks if a given schema matches a specific rule from a rule set\n * @param rule - The rule to match schema against\n * @param schema - The schema to be matched against the rule\n */\nexport function matchSchemaAgainstRule(rule: string, schema: string): boolean {\n  if (!isValidRule(rule)) return false;\n  const ruleParts = getRuleParts(rule);\n  const schemaParts = getSchemaParts(schema);\n  if (ruleParts && schemaParts) {\n    if (!matchVendor(ruleParts[0], schemaParts[0])) return false;\n    for (let i = 1; i < 5; i++) {\n      if (!matchPart(ruleParts[i], schemaParts[i])) return false;\n    }\n    return true; // if it hasn't failed, it passes\n  }\n  return false;\n}\n\nfunction matchVendor(rule: string, vendor: string): boolean {\n  // rule and vendor must have same number of elements\n  const vendorParts = vendor.split('.');\n  const ruleParts = rule.split('.');\n  if (vendorParts && ruleParts) {\n    if (vendorParts.length !== ruleParts.length) return false;\n    for (let i = 0; i < ruleParts.length; i++) {\n      if (!matchPart(vendorParts[i], ruleParts[i])) return false;\n    }\n    return true;\n  }\n  return false;\n}\n\nfunction matchPart(rule: string, schema: string): boolean {\n  // parts should be the string nested between slashes in the URI: /example/\n  return (rule && schema && rule === '*') || rule === schema;\n}\n\n// Returns the \"useful\" schema, i.e. what would someone want to use to identify events.\n// For some events this is the 'e' property but for unstructured events, this is the\n// 'schema' from the 'ue_px' field.\nfunction getUsefulSchema(sb: PayloadBuilder): string {\n  let eventJson = sb.getJson();\n  for (const json of eventJson) {\n    if (json.keyIfEncoded === 'ue_px' && typeof json.json['data'] === 'object') {\n      const schema = (json.json['data'] as Record<string, unknown>)['schema'];\n      if (typeof schema == 'string') {\n        return schema;\n      }\n    }\n  }\n  return '';\n}\n\nfunction getEventType(payloadBuilder: PayloadBuilder): string {\n  const eventType = payloadBuilder.getPayload()['e'];\n  return typeof eventType === 'string' ? eventType : '';\n}\n\nfunction buildGenerator(\n  generator: ContextGenerator,\n  event: PayloadBuilder,\n  eventType: string,\n  eventSchema: string\n): SelfDescribingJson | Array<SelfDescribingJson> | undefined {\n  let contextGeneratorResult: SelfDescribingJson | Array<SelfDescribingJson> | undefined = undefined;\n  try {\n    // try to evaluate context generator\n    const args = {\n      event: event.getPayload(),\n      eventType: eventType,\n      eventSchema: eventSchema,\n    };\n    contextGeneratorResult = generator(args);\n    // determine if the produced result is a valid SDJ\n    if (Array.isArray(contextGeneratorResult) && contextGeneratorResult.every(isSelfDescribingJson)) {\n      return contextGeneratorResult;\n    } else if (isSelfDescribingJson(contextGeneratorResult)) {\n      return contextGeneratorResult;\n    } else {\n      return undefined;\n    }\n  } catch (error) {\n    contextGeneratorResult = undefined;\n  }\n  return contextGeneratorResult;\n}\n\nfunction normalizeToArray<T>(input: Array<T> | T): Array<T> {\n  if (Array.isArray(input)) {\n    return input;\n  }\n  return Array.of(input);\n}\n\nfunction generatePrimitives(\n  contextPrimitives: Array<ContextPrimitive> | ContextPrimitive,\n  event: PayloadBuilder,\n  eventType: string,\n  eventSchema: string\n): Array<SelfDescribingJson> {\n  const normalizedInputs: Array<ContextPrimitive> = normalizeToArray(contextPrimitives);\n  const partialEvaluate = (primitive: ContextPrimitive) => {\n    const result = evaluatePrimitive(primitive, event, eventType, eventSchema);\n    if (result && result.length !== 0) {\n      return result;\n    }\n    return undefined;\n  };\n  const generatedContexts = normalizedInputs.map(partialEvaluate);\n  return ([] as Array<SelfDescribingJson>).concat(\n    ...(generatedContexts.filter((c) => c != null && c.filter(Boolean)) as Array<Array<SelfDescribingJson>>)\n  );\n}\n\nfunction evaluatePrimitive(\n  contextPrimitive: ContextPrimitive,\n  event: PayloadBuilder,\n  eventType: string,\n  eventSchema: string\n): Array<SelfDescribingJson> | undefined {\n  if (isSelfDescribingJson(contextPrimitive)) {\n    return [contextPrimitive as SelfDescribingJson];\n  } else if (isContextCallbackFunction(contextPrimitive)) {\n    const generatorOutput = buildGenerator(contextPrimitive as ContextGenerator, event, eventType, eventSchema);\n    if (isSelfDescribingJson(generatorOutput)) {\n      return [generatorOutput as SelfDescribingJson];\n    } else if (Array.isArray(generatorOutput)) {\n      return generatorOutput;\n    }\n  }\n  return undefined;\n}\n\nfunction evaluateProvider(\n  provider: ConditionalContextProvider,\n  event: PayloadBuilder,\n  eventType: string,\n  eventSchema: string\n): Array<SelfDescribingJson> {\n  if (isFilterProvider(provider)) {\n    const filter: ContextFilter = (provider as FilterProvider)[0];\n    let filterResult = false;\n    try {\n      const args = {\n        event: event.getPayload(),\n        eventType: eventType,\n        eventSchema: eventSchema,\n      };\n      filterResult = filter(args);\n    } catch (error) {\n      filterResult = false;\n    }\n    if (filterResult === true) {\n      return generatePrimitives((provider as FilterProvider)[1], event, eventType, eventSchema);\n    }\n  } else if (isRuleSetProvider(provider)) {\n    if (matchSchemaAgainstRuleSet((provider as RuleSetProvider)[0], eventSchema)) {\n      return generatePrimitives((provider as RuleSetProvider)[1], event, eventType, eventSchema);\n    }\n  }\n  return [];\n}\n\nfunction generateConditionals(\n  providers: Array<ConditionalContextProvider> | ConditionalContextProvider,\n  event: PayloadBuilder,\n  eventType: string,\n  eventSchema: string\n): Array<SelfDescribingJson> {\n  const normalizedInput: Array<ConditionalContextProvider> = normalizeToArray(providers);\n  const partialEvaluate = (provider: ConditionalContextProvider) => {\n    const result = evaluateProvider(provider, event, eventType, eventSchema);\n    if (result && result.length !== 0) {\n      return result;\n    }\n    return undefined;\n  };\n  const generatedContexts = normalizedInput.map(partialEvaluate);\n  return ([] as Array<SelfDescribingJson>).concat(\n    ...(generatedContexts.filter((c) => c != null && c.filter(Boolean)) as Array<Array<SelfDescribingJson>>)\n  );\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { v4 as uuid } from 'uuid';\nimport { payloadBuilder, PayloadBuilder, Payload, isJson, payloadJsonProcessor } from './payload';\nimport {\n  globalContexts,\n  ConditionalContextProvider,\n  ContextPrimitive,\n  GlobalContexts,\n  PluginContexts,\n  pluginContexts,\n} from './contexts';\nimport { CorePlugin } from './plugins';\nimport { LOG } from './logger';\n\n/**\n * export interface for any Self-Describing JSON such as context or Self Describing events\n * @typeParam T - The type of the data object within a SelfDescribingJson\n */\nexport type SelfDescribingJson<T extends Record<keyof T, unknown> = Record<string, unknown>> = {\n  /**\n   * The schema string\n   * @example 'iglu:com.snowplowanalytics.snowplow/web_page/jsonschema/1-0-0'\n   */\n  schema: string;\n  /**\n   * The data object which should conform to the supplied schema\n   */\n  data: T;\n};\n\n/**\n * export interface for any Self-Describing JSON which has the data attribute as an array\n * @typeParam T - The type of the data object within the SelfDescribingJson data array\n */\nexport type SelfDescribingJsonArray<T extends Record<keyof T, unknown> = Record<string, unknown>> = {\n  /**\n   * The schema string\n   * @example 'iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-1'\n   */\n  schema: string;\n  /**\n   * The data array which should conform to the supplied schema\n   */\n  data: Array<T>;\n};\n\n/**\n * Algebraic datatype representing possible timestamp type choice\n */\nexport type Timestamp = TrueTimestamp | DeviceTimestamp | number;\n\n/**\n * A representation of a True Timestamp (ttm)\n */\nexport interface TrueTimestamp {\n  readonly type: 'ttm';\n  readonly value: number;\n}\n\n/**\n * A representation of a Device Timestamp (dtm)\n */\nexport interface DeviceTimestamp {\n  readonly type: 'dtm';\n  readonly value: number;\n}\n\n/**\n * Pair of timestamp type ready to be included to payload\n */\ntype TimestampPayload = TrueTimestamp | DeviceTimestamp;\n\n/**\n * Transform optional/old-behavior number timestamp into`Timestamp` ADT\n *\n * @param timestamp - optional number or timestamp object\n * @returns correct timestamp object\n */\nfunction getTimestamp(timestamp?: Timestamp | null): TimestampPayload {\n  if (timestamp == null) {\n    return { type: 'dtm', value: new Date().getTime() };\n  } else if (typeof timestamp === 'number') {\n    return { type: 'dtm', value: timestamp };\n  } else if (timestamp.type === 'ttm') {\n    // We can return timestamp here, but this is safer fallback\n    return { type: 'ttm', value: timestamp.value };\n  } else {\n    return { type: 'dtm', value: timestamp.value || new Date().getTime() };\n  }\n}\n\n/** Additional data points to set when tracking an event */\nexport interface CommonEventProperties {\n  /** Add context to an event by setting an Array of Self Describing JSON */\n  context?: Array<SelfDescribingJson> | null;\n  /** Set the true timestamp or overwrite the device sent timestamp on an event */\n  timestamp?: Timestamp | null;\n}\n\n/**\n * export interface containing all Core functions\n */\nexport interface TrackerCore {\n  /**\n   * Call with a payload from a buildX function\n   * Adds context and payloadPairs name-value pairs to the payload\n   * Applies the callback to the built payload\n   *\n   * @param pb - Payload\n   * @param context - Custom contexts relating to the event\n   * @param timestamp - Timestamp of the event\n   * @returns Payload after the callback is applied\n   */\n  track: (\n    /** A PayloadBuilder created by one of the `buildX` functions */\n    pb: PayloadBuilder,\n    /** The additional contextual information related to the event */\n    context?: Array<SelfDescribingJson> | null,\n    /** Timestamp override */\n    timestamp?: Timestamp | null\n  ) => Payload;\n\n  /**\n   * Set a persistent key-value pair to be added to every payload\n   *\n   * @param key - Field name\n   * @param value - Field value\n   */\n  addPayloadPair: (key: string, value: string | number) => void;\n\n  /**\n   * Get current base64 encoding state\n   */\n  getBase64Encoding(): boolean;\n\n  /**\n   * Turn base 64 encoding on or off\n   *\n   * @param encode - Whether to encode payload\n   */\n  setBase64Encoding(encode: boolean): void;\n\n  /**\n   * Merges a dictionary into payloadPairs\n   *\n   * @param dict - Adds a new payload dictionary to the existing one\n   */\n  addPayloadDict(dict: Payload): void;\n\n  /**\n   * Replace payloadPairs with a new dictionary\n   *\n   * @param dict - Resets all current payload pairs with a new dictionary of pairs\n   */\n  resetPayloadPairs(dict: Payload): void;\n\n  /**\n   * Set the tracker version\n   *\n   * @param version - The version of the current tracker\n   */\n  setTrackerVersion(version: string): void;\n\n  /**\n   * Set the tracker namespace\n   *\n   * @param name - The trackers namespace\n   */\n  setTrackerNamespace(name: string): void;\n\n  /**\n   * Set the application ID\n   *\n   * @param appId - An application ID which identifies the current application\n   */\n  setAppId(appId: string): void;\n\n  /**\n   * Set the platform\n   *\n   * @param value - A valid Snowplow platform value\n   */\n  setPlatform(value: string): void;\n\n  /**\n   * Set the user ID\n   *\n   * @param userId - The custom user id\n   */\n  setUserId(userId: string): void;\n\n  /**\n   * Set the screen resolution\n   *\n   * @param width - screen resolution width\n   * @param height - screen resolution height\n   */\n  setScreenResolution(width: string, height: string): void;\n\n  /**\n   * Set the viewport dimensions\n   *\n   * @param width - viewport width\n   * @param height - viewport height\n   */\n  setViewport(width: string, height: string): void;\n\n  /**\n   * Set the color depth\n   *\n   * @param depth - A color depth value as string\n   */\n  setColorDepth(depth: string): void;\n\n  /**\n   * Set the timezone\n   *\n   * @param timezone - A timezone string\n   */\n  setTimezone(timezone: string): void;\n\n  /**\n   * Set the language\n   *\n   * @param lang - A language string e.g. 'en-UK'\n   */\n  setLang(lang: string): void;\n\n  /**\n   * Set the IP address\n   *\n   * @param ip - An IP Address string\n   */\n  setIpAddress(ip: string): void;\n\n  /**\n   * Set the Useragent\n   *\n   * @param useragent - A useragent string\n   */\n  setUseragent(useragent: string): void;\n\n  /**\n   * Adds contexts globally, contexts added here will be attached to all applicable events\n   * @param contexts - An array containing either contexts or a conditional contexts\n   */\n  addGlobalContexts(contexts: Array<ConditionalContextProvider | ContextPrimitive>): void;\n\n  /**\n   * Removes all global contexts\n   */\n  clearGlobalContexts(): void;\n\n  /**\n   * Removes previously added global context, performs a deep comparison of the contexts or conditional contexts\n   * @param contexts - An array containing either contexts or a conditional contexts\n   */\n  removeGlobalContexts(contexts: Array<ConditionalContextProvider | ContextPrimitive>): void;\n\n  /**\n   * Add a plugin into the plugin collection after Core has already been initialised\n   * @param configuration - The plugin to add\n   */\n  addPlugin(configuration: CorePluginConfiguration): void;\n}\n\n/**\n * The configuration object for the tracker core library\n */\nexport interface CoreConfiguration {\n  /* Should payloads be base64 encoded when built */\n  base64?: boolean;\n  /* A list of all the plugins to include at load */\n  corePlugins?: Array<CorePlugin>;\n  /* The callback which will fire each time `track()` is called */\n  callback?: (PayloadData: PayloadBuilder) => void;\n}\n\n/**\n * The configuration of the plugin to add\n */\nexport interface CorePluginConfiguration {\n  /* The plugin to add */\n  plugin: CorePlugin;\n}\n\n/**\n * Create a tracker core object\n *\n * @param base64 - Whether to base 64 encode contexts and self describing event JSONs\n * @param corePlugins - The core plugins to be processed with each event\n * @param callback - Function applied to every payload dictionary object\n * @returns Tracker core\n */\nexport function trackerCore(configuration: CoreConfiguration = {}): TrackerCore {\n  function newCore(base64: boolean, corePlugins: Array<CorePlugin>, callback?: (PayloadData: PayloadBuilder) => void) {\n    const pluginContextsHelper: PluginContexts = pluginContexts(corePlugins),\n      globalContextsHelper: GlobalContexts = globalContexts();\n\n    let encodeBase64 = base64,\n      payloadPairs: Payload = {}; // Dictionary of key-value pairs which get added to every payload, e.g. tracker version\n\n    /**\n     * Wraps an array of custom contexts in a self-describing JSON\n     *\n     * @param contexts - Array of custom context self-describing JSONs\n     * @returns Outer JSON\n     */\n    function completeContexts(\n      contexts?: Array<SelfDescribingJson>\n    ): SelfDescribingJsonArray<SelfDescribingJson> | undefined {\n      if (contexts && contexts.length) {\n        return {\n          schema: 'iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0',\n          data: contexts,\n        };\n      }\n      return undefined;\n    }\n\n    /**\n     * Adds all global contexts to a contexts array\n     *\n     * @param pb - PayloadData\n     * @param contexts - Custom contexts relating to the event\n     */\n    function attachGlobalContexts(\n      pb: PayloadBuilder,\n      contexts?: Array<SelfDescribingJson> | null\n    ): Array<SelfDescribingJson> {\n      const applicableContexts: Array<SelfDescribingJson> = globalContextsHelper.getApplicableContexts(pb);\n      const returnedContexts: Array<SelfDescribingJson> = [];\n      if (contexts && contexts.length) {\n        returnedContexts.push(...contexts);\n      }\n      if (applicableContexts && applicableContexts.length) {\n        returnedContexts.push(...applicableContexts);\n      }\n      return returnedContexts;\n    }\n\n    /**\n     * Gets called by every trackXXX method\n     * Adds context and payloadPairs name-value pairs to the payload\n     * Applies the callback to the built payload\n     *\n     * @param pb - Payload\n     * @param context - Custom contexts relating to the event\n     * @param timestamp - Timestamp of the event\n     * @returns Payload after the callback is applied\n     */\n    function track(\n      pb: PayloadBuilder,\n      context?: Array<SelfDescribingJson> | null,\n      timestamp?: Timestamp | null\n    ): Payload {\n      pb.withJsonProcessor(payloadJsonProcessor(encodeBase64));\n      pb.add('eid', uuid());\n      pb.addDict(payloadPairs);\n      const tstamp = getTimestamp(timestamp);\n      pb.add(tstamp.type, tstamp.value.toString());\n      const allContexts = attachGlobalContexts(pb, pluginContextsHelper.addPluginContexts(context));\n      const wrappedContexts = completeContexts(allContexts);\n      if (wrappedContexts !== undefined) {\n        pb.addJson('cx', 'co', wrappedContexts);\n      }\n\n      corePlugins.forEach((plugin) => {\n        try {\n          if (plugin.beforeTrack) {\n            plugin.beforeTrack(pb);\n          }\n        } catch (ex) {\n          LOG.error('Plugin beforeTrack', ex);\n        }\n      });\n\n      if (typeof callback === 'function') {\n        callback(pb);\n      }\n\n      const finalPayload = pb.build();\n\n      corePlugins.forEach((plugin) => {\n        try {\n          if (plugin.afterTrack) {\n            plugin.afterTrack(finalPayload);\n          }\n        } catch (ex) {\n          LOG.error('Plugin afterTrack', ex);\n        }\n      });\n\n      return finalPayload;\n    }\n\n    /**\n     * Set a persistent key-value pair to be added to every payload\n     *\n     * @param key - Field name\n     * @param value - Field value\n     */\n    function addPayloadPair(key: string, value: string | number): void {\n      payloadPairs[key] = value;\n    }\n\n    const core = {\n      track,\n\n      addPayloadPair,\n\n      getBase64Encoding() {\n        return encodeBase64;\n      },\n\n      setBase64Encoding(encode: boolean) {\n        encodeBase64 = encode;\n      },\n\n      addPayloadDict(dict: Payload) {\n        for (const key in dict) {\n          if (Object.prototype.hasOwnProperty.call(dict, key)) {\n            payloadPairs[key] = dict[key];\n          }\n        }\n      },\n\n      resetPayloadPairs(dict: Payload) {\n        payloadPairs = isJson(dict) ? dict : {};\n      },\n\n      setTrackerVersion(version: string) {\n        addPayloadPair('tv', version);\n      },\n\n      setTrackerNamespace(name: string) {\n        addPayloadPair('tna', name);\n      },\n\n      setAppId(appId: string) {\n        addPayloadPair('aid', appId);\n      },\n\n      setPlatform(value: string) {\n        addPayloadPair('p', value);\n      },\n\n      setUserId(userId: string) {\n        addPayloadPair('uid', userId);\n      },\n\n      setScreenResolution(width: string, height: string) {\n        addPayloadPair('res', width + 'x' + height);\n      },\n\n      setViewport(width: string, height: string) {\n        addPayloadPair('vp', width + 'x' + height);\n      },\n\n      setColorDepth(depth: string) {\n        addPayloadPair('cd', depth);\n      },\n\n      setTimezone(timezone: string) {\n        addPayloadPair('tz', timezone);\n      },\n\n      setLang(lang: string) {\n        addPayloadPair('lang', lang);\n      },\n\n      setIpAddress(ip: string) {\n        addPayloadPair('ip', ip);\n      },\n\n      setUseragent(useragent: string) {\n        addPayloadPair('ua', useragent);\n      },\n\n      addGlobalContexts(contexts: Array<ConditionalContextProvider | ContextPrimitive>) {\n        globalContextsHelper.addGlobalContexts(contexts);\n      },\n\n      clearGlobalContexts(): void {\n        globalContextsHelper.clearGlobalContexts();\n      },\n\n      removeGlobalContexts(contexts: Array<ConditionalContextProvider | ContextPrimitive>) {\n        globalContextsHelper.removeGlobalContexts(contexts);\n      },\n    };\n\n    return core;\n  }\n\n  const { base64, corePlugins, callback } = configuration,\n    plugins = corePlugins ?? [],\n    partialCore = newCore(base64 ?? true, plugins, callback),\n    core = {\n      ...partialCore,\n      addPlugin: (configuration: CorePluginConfiguration) => {\n        const { plugin } = configuration;\n        plugins.push(plugin);\n        plugin.logger?.(LOG);\n        plugin.activateCorePlugin?.(core);\n      },\n    };\n\n  plugins?.forEach((plugin) => {\n    plugin.logger?.(LOG);\n    plugin.activateCorePlugin?.(core);\n  });\n\n  return core;\n}\n\n/**\n * A Self Describing Event\n * A custom event type, allowing for an event to be tracked using your own custom schema\n * and a data object which conforms to the supplied schema\n */\nexport interface SelfDescribingEvent {\n  /** The Self Describing JSON which describes the event */\n  event: SelfDescribingJson;\n}\n\n/**\n * Build a self-describing event\n * A custom event type, allowing for an event to be tracked using your own custom schema\n * and a data object which conforms to the supplied schema\n *\n * @param event - Contains the properties and schema location for the event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildSelfDescribingEvent(event: SelfDescribingEvent): PayloadBuilder {\n  const {\n      event: { schema, data },\n    } = event,\n    pb = payloadBuilder();\n  const ueJson = {\n    schema: 'iglu:com.snowplowanalytics.snowplow/unstruct_event/jsonschema/1-0-0',\n    data: { schema, data },\n  };\n\n  pb.add('e', 'ue');\n  pb.addJson('ue_px', 'ue_pr', ueJson);\n\n  return pb;\n}\n\n/**\n * A Page View Event\n * Represents a Page View, which is typically fired as soon as possible when a web page\n * is loaded within the users browser. Often also fired on \"virtual page views\" within\n * Single Page Applications (SPA).\n */\nexport interface PageViewEvent {\n  /** The current URL visible in the users browser */\n  pageUrl?: string | null;\n  /** The current page title in the users browser */\n  pageTitle?: string | null;\n  /** The URL of the referring page */\n  referrer?: string | null;\n}\n\n/**\n * Build a Page View Event\n * Represents a Page View, which is typically fired as soon as possible when a web page\n * is loaded within the users browser. Often also fired on \"virtual page views\" within\n * Single Page Applications (SPA).\n *\n * @param event - Contains the properties for the Page View event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildPageView(event: PageViewEvent): PayloadBuilder {\n  const { pageUrl, pageTitle, referrer } = event,\n    pb = payloadBuilder();\n  pb.add('e', 'pv'); // 'pv' for Page View\n  pb.add('url', pageUrl);\n  pb.add('page', pageTitle);\n  pb.add('refr', referrer);\n\n  return pb;\n}\n\n/**\n * A Page Ping Event\n * Fires when activity tracking is enabled in the browser.\n * Tracks same information as the last tracked Page View and includes scroll\n * information from the current page view\n */\nexport interface PagePingEvent extends PageViewEvent {\n  /** The minimum X scroll position for the current page view */\n  minXOffset?: number;\n  /** The maximum X scroll position for the current page view */\n  maxXOffset?: number;\n  /** The minimum Y scroll position for the current page view */\n  minYOffset?: number;\n  /** The maximum Y scroll position for the current page view */\n  maxYOffset?: number;\n}\n\n/**\n * Build a Page Ping Event\n * Fires when activity tracking is enabled in the browser.\n * Tracks same information as the last tracked Page View and includes scroll\n * information from the current page view\n *\n * @param event - Contains the properties for the Page Ping event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildPagePing(event: PagePingEvent): PayloadBuilder {\n  const { pageUrl, pageTitle, referrer, minXOffset, maxXOffset, minYOffset, maxYOffset } = event,\n    pb = payloadBuilder();\n  pb.add('e', 'pp'); // 'pp' for Page Ping\n  pb.add('url', pageUrl);\n  pb.add('page', pageTitle);\n  pb.add('refr', referrer);\n  if (minXOffset && !isNaN(Number(minXOffset))) pb.add('pp_mix', minXOffset.toString());\n  if (maxXOffset && !isNaN(Number(maxXOffset))) pb.add('pp_max', maxXOffset.toString());\n  if (minYOffset && !isNaN(Number(minYOffset))) pb.add('pp_miy', minYOffset.toString());\n  if (maxYOffset && !isNaN(Number(maxYOffset))) pb.add('pp_may', maxYOffset.toString());\n\n  return pb;\n}\n\n/**\n * A Structured Event\n * A classic style of event tracking, allows for easier movement between analytics\n * systems. A loosely typed event, creating a Self Describing event is preferred, but\n * useful for interoperability.\n */\nexport interface StructuredEvent {\n  category: string;\n  action: string;\n  label?: string;\n  property?: string;\n  value?: number;\n}\n\n/**\n * Build a Structured Event\n * A classic style of event tracking, allows for easier movement between analytics\n * systems. A loosely typed event, creating a Self Describing event is preferred, but\n * useful for interoperability.\n *\n * @param event - Contains the properties for the Structured event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildStructEvent(event: StructuredEvent): PayloadBuilder {\n  const { category, action, label, property, value } = event,\n    pb = payloadBuilder();\n  pb.add('e', 'se'); // 'se' for Structured Event\n  pb.add('se_ca', category);\n  pb.add('se_ac', action);\n  pb.add('se_la', label);\n  pb.add('se_pr', property);\n  pb.add('se_va', value == null ? undefined : value.toString());\n\n  return pb;\n}\n\n/**\n * An Ecommerce Transaction Event\n * Allows for tracking common ecommerce events, this event is usually used when\n * a customer completes a transaction.\n */\nexport interface EcommerceTransactionEvent {\n  /** An identifier for the order */\n  orderId: string;\n  /** The total value of the order  */\n  total: number;\n  /** Transaction affiliation (e.g. store where sale took place) */\n  affiliation?: string;\n  /** The amount of tax on the transaction */\n  tax?: number;\n  /** The amount of shipping costs for this transaction */\n  shipping?: number;\n  /** Delivery address, city */\n  city?: string;\n  /** Delivery address, state */\n  state?: string;\n  /** Delivery address, country */\n  country?: string;\n  /** Currency of the transaction */\n  currency?: string;\n}\n\n/**\n * Build an Ecommerce Transaction Event\n * Allows for tracking common ecommerce events, this event is usually used when\n * a consumer completes a transaction.\n *\n * @param event - Contains the properties for the Ecommerce Transactoion event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildEcommerceTransaction(event: EcommerceTransactionEvent): PayloadBuilder {\n  const { orderId, total, affiliation, tax, shipping, city, state, country, currency } = event,\n    pb = payloadBuilder();\n  pb.add('e', 'tr'); // 'tr' for Transaction\n  pb.add('tr_id', orderId);\n  pb.add('tr_af', affiliation);\n  pb.add('tr_tt', total);\n  pb.add('tr_tx', tax);\n  pb.add('tr_sh', shipping);\n  pb.add('tr_ci', city);\n  pb.add('tr_st', state);\n  pb.add('tr_co', country);\n  pb.add('tr_cu', currency);\n\n  return pb;\n}\n\n/**\n * An Ecommerce Transaction Item\n * Related to the {@link EcommerceTransactionEvent}\n * Each Ecommerce Transaction may contain one or more EcommerceTransactionItem events\n */\nexport interface EcommerceTransactionItemEvent {\n  /** An identifier for the order */\n  orderId: string;\n  /** A Product Stock Keeping Unit (SKU) */\n  sku: string;\n  /** The price of the product */\n  price: number;\n  /** The name of the product */\n  name?: string;\n  /** The category the product belongs to */\n  category?: string;\n  /** The quanity of this product within the transaction */\n  quantity?: number;\n  /** The currency of the product for the transaction */\n  currency?: string;\n}\n\n/**\n * Build an Ecommerce Transaction Item Event\n * Related to the {@link buildEcommerceTransaction}\n * Each Ecommerce Transaction may contain one or more EcommerceTransactionItem events\n *\n * @param event - Contains the properties for the Ecommerce Transaction Item event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildEcommerceTransactionItem(event: EcommerceTransactionItemEvent): PayloadBuilder {\n  const { orderId, sku, price, name, category, quantity, currency } = event,\n    pb = payloadBuilder();\n  pb.add('e', 'ti'); // 'tr' for Transaction Item\n  pb.add('ti_id', orderId);\n  pb.add('ti_sk', sku);\n  pb.add('ti_nm', name);\n  pb.add('ti_ca', category);\n  pb.add('ti_pr', price);\n  pb.add('ti_qu', quantity);\n  pb.add('ti_cu', currency);\n\n  return pb;\n}\n\n/**\n * A Screen View Event\n * Similar to a Page View but less focused on typical web properties\n * Often used for mobile applications as the user is presented with\n * new views as they performance navigation events\n */\nexport interface ScreenViewEvent {\n  /** The name of the screen */\n  name?: string;\n  /** The identifier of the screen */\n  id?: string;\n}\n\n/**\n * Build a Scren View Event\n * Similar to a Page View but less focused on typical web properties\n * Often used for mobile applications as the user is presented with\n * new views as they performance navigation events\n *\n * @param event - Contains the properties for the Screen View event. One or more properties must be included.\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildScreenView(event: ScreenViewEvent): PayloadBuilder {\n  const { name, id } = event;\n  return buildSelfDescribingEvent({\n    event: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/screen_view/jsonschema/1-0-0',\n      data: removeEmptyProperties({ name, id }),\n    },\n  });\n}\n\n/**\n * A Link Click Event\n * Used when a user clicks on a link on a webpage, typically an anchor tag <a>\n */\nexport interface LinkClickEvent {\n  /** The target URL of the link */\n  targetUrl: string;\n  /** The ID of the element clicked if present */\n  elementId?: string;\n  /** An array of class names from the element clicked */\n  elementClasses?: Array<string>;\n  /** The target value of the element if present */\n  elementTarget?: string;\n  /** The content of the element if present and enabled */\n  elementContent?: string;\n}\n\n/**\n * Build a Link Click Event\n * Used when a user clicks on a link on a webpage, typically an anchor tag <a>\n *\n * @param event - Contains the properties for the Link Click event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildLinkClick(event: LinkClickEvent): PayloadBuilder {\n  const { targetUrl, elementId, elementClasses, elementTarget, elementContent } = event;\n  const eventJson = {\n    schema: 'iglu:com.snowplowanalytics.snowplow/link_click/jsonschema/1-0-1',\n    data: removeEmptyProperties({ targetUrl, elementId, elementClasses, elementTarget, elementContent }),\n  };\n\n  return buildSelfDescribingEvent({ event: eventJson });\n}\n\n/**\n * An Ad Impression Event\n * Used to track an advertisement impression\n *\n * @remarks\n * If you provide the cost field, you must also provide one of 'cpa', 'cpc', and 'cpm' for the costModel field.\n */\nexport interface AdImpressionEvent {\n  /** Identifier for the particular impression instance */\n  impressionId?: string;\n  /** The cost model for the campaign */\n  costModel?: 'cpa' | 'cpc' | 'cpm';\n  /** Advertisement cost */\n  cost?: number;\n  /** The destination URL of the advertisement */\n  targetUrl?: string;\n  /** Identifier for the ad banner being displayed */\n  bannerId?: string;\n  /** Identifier for the zone where the ad banner is located */\n  zoneId?: string;\n  /** Identifier for the advertiser which the campaign belongs to */\n  advertiserId?: string;\n  /** Identifier for the advertiser which the campaign belongs to */\n  campaignId?: string;\n}\n\n/**\n * Build a Ad Impression Event\n * Used to track an advertisement impression\n *\n * @remarks\n * If you provide the cost field, you must also provide one of 'cpa', 'cpc', and 'cpm' for the costModel field.\n *\n * @param event - Contains the properties for the Ad Impression event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildAdImpression(event: AdImpressionEvent): PayloadBuilder {\n  const { impressionId, costModel, cost, targetUrl, bannerId, zoneId, advertiserId, campaignId } = event;\n  const eventJson = {\n    schema: 'iglu:com.snowplowanalytics.snowplow/ad_impression/jsonschema/1-0-0',\n    data: removeEmptyProperties({\n      impressionId,\n      costModel,\n      cost,\n      targetUrl,\n      bannerId,\n      zoneId,\n      advertiserId,\n      campaignId,\n    }),\n  };\n\n  return buildSelfDescribingEvent({ event: eventJson });\n}\n\n/**\n * An Ad Click Event\n * Used to track an advertisement click\n *\n * @remarks\n * If you provide the cost field, you must also provide one of 'cpa', 'cpc', and 'cpm' for the costModel field.\n */\nexport interface AdClickEvent {\n  /** The destination URL of the advertisement */\n  targetUrl: string;\n  /**\tIdentifier for the particular click instance */\n  clickId?: string;\n  /** The cost model for the campaign */\n  costModel?: 'cpa' | 'cpc' | 'cpm';\n  /** Advertisement cost */\n  cost?: number;\n  /** Identifier for the ad banner being displayed */\n  bannerId?: string;\n  /** Identifier for the zone where the ad banner is located */\n  zoneId?: string;\n  /** Identifier for the particular impression instance */\n  impressionId?: string;\n  /** Identifier for the advertiser which the campaign belongs to */\n  advertiserId?: string;\n  /** Identifier for the advertiser which the campaign belongs to */\n  campaignId?: string;\n}\n\n/**\n * Build a Ad Click Event\n * Used to track an advertisement click\n *\n * @remarks\n * If you provide the cost field, you must also provide one of 'cpa', 'cpc', and 'cpm' for the costModel field.\n *\n * @param event - Contains the properties for the Ad Click event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildAdClick(event: AdClickEvent): PayloadBuilder {\n  const { targetUrl, clickId, costModel, cost, bannerId, zoneId, impressionId, advertiserId, campaignId } = event;\n  const eventJson = {\n    schema: 'iglu:com.snowplowanalytics.snowplow/ad_click/jsonschema/1-0-0',\n    data: removeEmptyProperties({\n      targetUrl,\n      clickId,\n      costModel,\n      cost,\n      bannerId,\n      zoneId,\n      impressionId,\n      advertiserId,\n      campaignId,\n    }),\n  };\n\n  return buildSelfDescribingEvent({ event: eventJson });\n}\n\n/**\n * An Ad Conversion Event\n * Used to track an advertisement click\n *\n * @remarks\n * If you provide the cost field, you must also provide one of 'cpa', 'cpc', and 'cpm' for the costModel field.\n */\nexport interface AdConversionEvent {\n  /** Identifier for the particular conversion instance */\n  conversionId?: string;\n  /** The cost model for the campaign */\n  costModel?: 'cpa' | 'cpc' | 'cpm';\n  /** Advertisement cost */\n  cost?: number;\n  /**\tConversion category */\n  category?: string;\n  /** The type of user interaction e.g. 'purchase' */\n  action?: string;\n  /** Describes the object of the conversion */\n  property?: string;\n  /** How much the conversion is initially worth */\n  initialValue?: number;\n  /** Identifier for the advertiser which the campaign belongs to */\n  advertiserId?: string;\n  /** Identifier for the advertiser which the campaign belongs to */\n  campaignId?: string;\n}\n\n/**\n * Build a Ad Conversion Event\n * Used to track an advertisement click\n *\n * @remarks\n * If you provide the cost field, you must also provide one of 'cpa', 'cpc', and 'cpm' for the costModel field.\n *\n * @param event - Contains the properties for the Ad Conversion event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildAdConversion(event: AdConversionEvent): PayloadBuilder {\n  const { conversionId, costModel, cost, category, action, property, initialValue, advertiserId, campaignId } = event;\n  const eventJson = {\n    schema: 'iglu:com.snowplowanalytics.snowplow/ad_conversion/jsonschema/1-0-0',\n    data: removeEmptyProperties({\n      conversionId,\n      costModel,\n      cost,\n      category,\n      action,\n      property,\n      initialValue,\n      advertiserId,\n      campaignId,\n    }),\n  };\n\n  return buildSelfDescribingEvent({ event: eventJson });\n}\n\n/**\n * A Social Interaction Event\n * Social tracking will be used to track the way users interact\n * with Facebook, Twitter and Google + widgets\n * e.g. to capture “like this” or “tweet this” events.\n */\nexport interface SocialInteractionEvent {\n  /** Social action performed */\n  action: string;\n  /** Social network */\n  network: string;\n  /** Object social action is performed on */\n  target?: string;\n}\n\n/**\n * Build a Social Interaction Event\n * Social tracking will be used to track the way users interact\n * with Facebook, Twitter and Google + widgets\n * e.g. to capture “like this” or “tweet this” events.\n *\n * @param event - Contains the properties for the Social Interaction event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildSocialInteraction(event: SocialInteractionEvent): PayloadBuilder {\n  const { action, network, target } = event;\n  const eventJson = {\n    schema: 'iglu:com.snowplowanalytics.snowplow/social_interaction/jsonschema/1-0-0',\n    data: removeEmptyProperties({ action, network, target }),\n  };\n\n  return buildSelfDescribingEvent({ event: eventJson });\n}\n\n/**\n * An Add To Cart Event\n * For tracking users adding items from a cart\n * on an ecommerce site.\n */\nexport interface AddToCartEvent {\n  /** A Product Stock Keeping Unit (SKU) */\n  sku: string;\n  /** The number added to the cart */\n  quantity: number;\n  /** The name of the product */\n  name?: string;\n  /** The category of the product */\n  category?: string;\n  /** The price of the product */\n  unitPrice?: number;\n  /** The currency of the product */\n  currency?: string;\n}\n\n/**\n * Build a Add To Cart Event\n * For tracking users adding items from a cart\n * on an ecommerce site.\n *\n * @param event - Contains the properties for the Add To Cart event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildAddToCart(event: AddToCartEvent): PayloadBuilder {\n  const { sku, quantity, name, category, unitPrice, currency } = event;\n  return buildSelfDescribingEvent({\n    event: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/add_to_cart/jsonschema/1-0-0',\n      data: removeEmptyProperties({\n        sku,\n        quantity,\n        name,\n        category,\n        unitPrice,\n        currency,\n      }),\n    },\n  });\n}\n\n/**\n * An Remove To Cart Event\n * For tracking users removing items from a cart\n * on an ecommerce site.\n */\nexport interface RemoveFromCartEvent {\n  /** A Product Stock Keeping Unit (SKU) */\n  sku: string;\n  /** The number removed from the cart */\n  quantity: number;\n  /** The name of the product */\n  name?: string;\n  /** The category of the product */\n  category?: string;\n  /** The price of the product */\n  unitPrice?: number;\n  /** The currency of the product */\n  currency?: string;\n}\n\n/**\n * Build a Remove From Cart Event\n * For tracking users removing items from a cart\n * on an ecommerce site.\n *\n * @param event - Contains the properties for the Remove From Cart event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildRemoveFromCart(event: RemoveFromCartEvent): PayloadBuilder {\n  const { sku, quantity, name, category, unitPrice, currency } = event;\n  return buildSelfDescribingEvent({\n    event: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/remove_from_cart/jsonschema/1-0-0',\n      data: removeEmptyProperties({\n        sku,\n        quantity,\n        name,\n        category,\n        unitPrice,\n        currency,\n      }),\n    },\n  });\n}\n\n/**\n * Represents either a Form Focus or Form Change event\n * When a user focuses on a form element or when a user makes a\n * change to a form element.\n */\nexport interface FormFocusOrChangeEvent {\n  /** The schema which will be used for the event */\n  schema: 'change_form' | 'focus_form';\n  /** The ID of the form which the element belongs to */\n  formId: string;\n  /** The element ID which the user is interacting with */\n  elementId: string;\n  /** The name of the node (\"INPUT\", \"TEXTAREA\", \"SELECT\") */\n  nodeName: string;\n  /** The value of the element at the time of the event firing */\n  value: string | null;\n  /** The type of element (e.g. \"datetime\", \"text\", \"radio\", etc.) */\n  type?: string | null;\n  /** The class names on the element */\n  elementClasses?: Array<string> | null;\n}\n\n/**\n * Build a Form Focus or Change Form Event based on schema property\n * When a user focuses on a form element or when a user makes a\n * change to a form element.\n *\n * @param event - Contains the properties for the Form Focus or Change Form event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildFormFocusOrChange(event: FormFocusOrChangeEvent): PayloadBuilder {\n  let event_schema = '';\n  const { schema, formId, elementId, nodeName, elementClasses, value, type } = event;\n  const event_data: Record<string, unknown> = { formId, elementId, nodeName, elementClasses, value };\n  if (schema === 'change_form') {\n    event_schema = 'iglu:com.snowplowanalytics.snowplow/change_form/jsonschema/1-0-0';\n    event_data.type = type;\n  } else if (schema === 'focus_form') {\n    event_schema = 'iglu:com.snowplowanalytics.snowplow/focus_form/jsonschema/1-0-0';\n    event_data.elementType = type;\n  }\n  return buildSelfDescribingEvent({\n    event: {\n      schema: event_schema,\n      data: removeEmptyProperties(event_data, { value: true }),\n    },\n  });\n}\n\n/**\n * A representation of an element within a form\n */\nexport type FormElement = {\n  /** The name of the element */\n  name: string;\n  /** The current value of the element */\n  value: string | null;\n  /** The name of the node (\"INPUT\", \"TEXTAREA\", \"SELECT\") */\n  nodeName: string;\n  /** The type of element (e.g. \"datetime\", \"text\", \"radio\", etc.) */\n  type?: string | null;\n};\n\n/**\n * A Form Submission Event\n * Used to track when a user submits a form\n */\nexport interface FormSubmissionEvent {\n  /** The ID of the form */\n  formId: string;\n  /** The class names on the form */\n  formClasses?: Array<string>;\n  /** The elements contained within the form */\n  elements?: Array<FormElement>;\n}\n\n/**\n * Build a Form Submission Event\n * Used to track when a user submits a form\n *\n * @param event - Contains the properties for the Form Submission event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildFormSubmission(event: FormSubmissionEvent): PayloadBuilder {\n  const { formId, formClasses, elements } = event;\n  return buildSelfDescribingEvent({\n    event: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/submit_form/jsonschema/1-0-0',\n      data: removeEmptyProperties({ formId, formClasses, elements }),\n    },\n  });\n}\n\n/**\n * A Site Search Event\n * Used when a user performs a search action on a page\n */\nexport interface SiteSearchEvent {\n  /** The terms of the search */\n  terms: Array<string>;\n  /** Any filters which have been applied to the search */\n  filters?: Record<string, string | boolean>;\n  /** The total number of results for this search */\n  totalResults?: number;\n  /** The number of visible results on the page */\n  pageResults?: number;\n}\n\n/**\n * Build a Site Search Event\n * Used when a user performs a search action on a page\n *\n * @param event - Contains the properties for the Site Search event\n * @returns PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track}\n */\nexport function buildSiteSearch(event: SiteSearchEvent): PayloadBuilder {\n  const { terms, filters, totalResults, pageResults } = event;\n  return buildSelfDescribingEvent({\n    event: {\n      schema: 'iglu:com.snowplowanalytics.snowplow/site_search/jsonschema/1-0-0',\n      data: removeEmptyProperties({ terms, filters, totalResults, pageResults }),\n    },\n  });\n}\n\n/**\n * A Consent Withdrawn Event\n * Used for tracking when a user withdraws their consent\n */\nexport interface ConsentWithdrawnEvent {\n  /** Specifies whether all consent should be withdrawn */\n  all: boolean;\n  /** Identifier for the document withdrawing consent */\n  id?: string;\n  /** Version of the document withdrawing consent */\n  version?: string;\n  /** Name of the document withdrawing consent */\n  name?: string;\n  /** Description of the document withdrawing consent */\n  description?: string;\n}\n\n/**\n * Build a Consent Withdrawn Event\n * Used for tracking when a user withdraws their consent\n *\n * @param event - Contains the properties for the Consent Withdrawn event\n * @returns An object containing the PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track} and a 'consent_document' context\n */\nexport function buildConsentWithdrawn(event: ConsentWithdrawnEvent) {\n  const { all, id, version, name, description } = event;\n  const documentJson = {\n    schema: 'iglu:com.snowplowanalytics.snowplow/consent_document/jsonschema/1-0-0',\n    data: removeEmptyProperties({ id, version, name, description }),\n  };\n\n  return {\n    event: buildSelfDescribingEvent({\n      event: {\n        schema: 'iglu:com.snowplowanalytics.snowplow/consent_withdrawn/jsonschema/1-0-0',\n        data: removeEmptyProperties({\n          all: all,\n        }),\n      },\n    }),\n    context: [documentJson],\n  };\n}\n\n/**\n * A Consent Granted Event\n * Used for tracking when a user grants their consent\n */\nexport interface ConsentGrantedEvent {\n  /** Identifier for the document granting consent */\n  id: string;\n  /** Version of the document granting consent */\n  version: string;\n  /** Name of the document granting consent */\n  name?: string;\n  /** Description of the document granting consent */\n  description?: string;\n  /** When the consent expires */\n  expiry?: string;\n}\n\n/**\n * Build a Consent Granted Event\n * Used for tracking when a user grants their consent\n *\n * @param event - Contains the properties for the Consent Granted event\n * @returns An object containing the PayloadBuilder to be sent to {@link @snowplow/tracker-core#TrackerCore.track} and a 'consent_document' context\n */\nexport function buildConsentGranted(event: ConsentGrantedEvent) {\n  const { expiry, id, version, name, description } = event;\n  const documentJson = {\n    schema: 'iglu:com.snowplowanalytics.snowplow/consent_document/jsonschema/1-0-0',\n    data: removeEmptyProperties({ id, version, name, description }),\n  };\n\n  return {\n    event: buildSelfDescribingEvent({\n      event: {\n        schema: 'iglu:com.snowplowanalytics.snowplow/consent_granted/jsonschema/1-0-0',\n        data: removeEmptyProperties({\n          expiry: expiry,\n        }),\n      },\n    }),\n    context: [documentJson],\n  };\n}\n\n/**\n * Returns a copy of a JSON with undefined and null properties removed\n *\n * @param event - JSON object to clean\n * @param exemptFields - Set of fields which should not be removed even if empty\n * @returns A cleaned copy of eventJson\n */\nfunction removeEmptyProperties(\n  event: Record<string, unknown>,\n  exemptFields: Record<string, boolean> = {}\n): Record<string, unknown> {\n  const ret: Record<string, unknown> = {};\n  for (const k in event) {\n    if (exemptFields[k] || (event[k] !== null && typeof event[k] !== 'undefined')) {\n      ret[k] = event[k];\n    }\n  }\n  return ret;\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nconst label = 'Snowplow: ';\n\nexport enum LOG_LEVEL {\n  none = 0,\n  error = 1,\n  warn = 2,\n  debug = 3,\n  info = 4,\n}\n\nexport interface Logger {\n  setLogLevel: (level: LOG_LEVEL) => void;\n  info: (message: string, ...extraParams: unknown[]) => void;\n  debug: (message: string, ...extraParams: unknown[]) => void;\n  warn: (message: string, error?: Error, ...extraParams: unknown[]) => void;\n  error: (message: string, error?: Error, ...extraParams: unknown[]) => void;\n}\n\nexport const LOG = logger();\n\nfunction logger(logLevel: LOG_LEVEL = LOG_LEVEL.warn): Logger {\n  function setLogLevel(level: LOG_LEVEL) {\n    if (LOG_LEVEL[level]) {\n      logLevel = level;\n    } else {\n      logLevel = LOG_LEVEL.warn;\n    }\n  }\n\n  /**\n   * Log errors, with or without error object\n   */\n  function error(message: string, error?: Error, ...extraParams: unknown[]) {\n    if (logLevel >= LOG_LEVEL.error && typeof console !== 'undefined') {\n      const logMsg = label + message + '\\n';\n      if (error) {\n        console.error(logMsg + '\\n', error, ...extraParams);\n      } else {\n        console.error(logMsg, ...extraParams);\n      }\n    }\n  }\n\n  /**\n   * Log warnings, with or without error object\n   */\n  function warn(message: string, error?: Error, ...extraParams: unknown[]) {\n    if (logLevel >= LOG_LEVEL.warn && typeof console !== 'undefined') {\n      const logMsg = label + message;\n      if (error) {\n        console.warn(logMsg + '\\n', error, ...extraParams);\n      } else {\n        console.warn(logMsg, ...extraParams);\n      }\n    }\n  }\n\n  /**\n   * Log debug messages\n   */\n  function debug(message: string, ...extraParams: unknown[]) {\n    if (logLevel >= LOG_LEVEL.debug && typeof console !== 'undefined') {\n      console.debug(label + message, ...extraParams);\n    }\n  }\n\n  /**\n   * Log info messages\n   */\n  function info(message: string, ...extraParams: unknown[]) {\n    if (logLevel >= LOG_LEVEL.info && typeof console !== 'undefined') {\n      console.info(label + message, ...extraParams);\n    }\n  }\n\n  return { setLogLevel, warn, error, debug, info };\n}\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]], '-',\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]],\n    bth[buf[i++]], bth[buf[i++]]\n  ]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/uuidjs/uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n"],"names":["processor","dict","allJson","jsonForProcessing","add","key","value","addDict","Object","prototype","hasOwnProperty","call","addJson","keyIfEncoded","keyIfNotEncoded","json","isNonEmptyJson","jsonWithKeys","push","getPayload","getJson","withJsonProcessor","jsonProcessor","build","this","encodeBase64","payloadBuilder","_i","str","JSON","stringify","i","ac","tmp_arr","data","unescape","encodeURIComponent","o1","charCodeAt","o2","o3","bits","b64","charAt","h1","h2","h3","h4","length","join","enc","slice","r","c","replace","property","isJson","constructor","__spreadArray","to","from","pack","arguments","ar","l","Array","concat","globalPrimitives","conditionalProviders","getGlobalPrimitives","getConditionalProviders","addGlobalContexts","contexts","acceptedConditionalContexts","acceptedContextPrimitives","context","isContextPrimitive","clearGlobalContexts","removeGlobalContexts","isConditionalContextProvider","filter","item","getApplicableContexts","event","eventJson_1","schema","d","a","eventType","e","generatedPrimitives","generatePrimitives","eventSchema","generateConditionals","providers","normalizeToArray","map","partialEvaluate","provider","isFilterProvider","filterResult","error","isRuleSetProvider","matchSchemaAgainstRuleSet","result","_a","generatedContexts","Boolean","generatedConditionals","plugins","addPluginContexts","additionalContexts","combinedContexts","forEach","plugin","ex","LOG","input","matches","re","exec","parts","asterisk","split","validateVendorParts","validateVendor","ruleParts","getRuleParts","vendor","isArray","every","x","isValidRule","ruleCount","isValidRuleSetArg","accept","reject","isSelfDescribingJson","isContextCallbackFunction","isRuleSet","ruleSet","rejectCount","acceptCount","acceptRules","some","rule","matchSchemaAgainstRule","rejectRules","getSchemaParts","schemaParts","matchVendor","vendorParts","matchPart","contextPrimitives","primitive","contextGeneratorResult","undefined","n","b","generatorOutput","ueJson","removeEmptyProperties","exemptFields","k","ret","LOG_LEVEL","__assign","assign","t","s","p","apply","logger","logLevel","warn","setLogLevel","level","message","extraParams","logMsg","label","console","debug","info","getRandomValues","crypto","bind","msCrypto","rnds8","Uint8Array","module.exports","rnds","Math","random","byteToHex","toString","substr","_nodeId","_clockseq","bytesToUuid","buf","offset","_lastMSecs","_lastNSecs","v4","options","rng","ii","v1","node","clockseq","seedBytes","msecs","getTime","Date","nsecs","dt","tl","tmh","eventJson","targetUrl","clickId","costModel","cost","bannerId","zoneId","impressionId","advertiserId","campaignId","conversionId","category","action","initialValue","sku","quantity","name","unitPrice","currency","expiry","id","version","description","buildSelfDescribingEvent","documentJson","all","orderId","total","affiliation","tax","shipping","city","state","country","pb","price","event_schema","type","formId","elementId","nodeName","elementClasses","event_data","elementType","formClasses","elements","elementTarget","elementContent","pageUrl","pageTitle","referrer","minXOffset","maxXOffset","minYOffset","isNaN","Number","maxYOffset","terms","filters","totalResults","pageResults","network","target","dynamicOrStaticContexts","configuration","base64","corePlugins","callback","pluginContextsHelper","globalContextsHelper","payloadPairs","pluginContexts","globalContexts","core","track","timestamp","payloadJsonProcessor","getTimestamp","tstamp","attachGlobalContexts","applicableContexts","returnedContexts","allContexts","wrappedContexts","beforeTrack","finalPayload","afterTrack","addPayloadPair","getBase64Encoding","setBase64Encoding","encode","addPayloadDict","resetPayloadPairs","setTrackerVersion","tv","setTrackerNamespace","tna","setAppId","appId","aid","setPlatform","setUserId","userId","uid","setScreenResolution","width","height","res","setViewport","vp","setColorDepth","depth","cd","setTimezone","timezone","tz","setLang","lang","setIpAddress","ip","setUseragent","useragent","ua","addPlugin","activateCorePlugin"],"mappings":"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"}