{"version":3,"file":"index.module.js","sources":["../src/detectors.ts","../src/helpers.ts","../src/tracker/out_queue.ts","../src/proxies.ts","../src/tracker/index.ts","../src/snowplow.ts","../src/state.ts"],"sourcesContent":["/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n/*\n * Checks whether sessionStorage is available, in a way that\n * does not throw a SecurityError in Firefox if \"always ask\"\n * is enabled for cookies (https://github.com/snowplow/snowplow/issues/163).\n */\nexport function hasSessionStorage() {\n  try {\n    return !!window.sessionStorage;\n  } catch (e) {\n    return true; // SecurityError when referencing it means it exists\n  }\n}\n\n/*\n * Checks whether localStorage is available, in a way that\n * does not throw a SecurityError in Firefox if \"always ask\"\n * is enabled for cookies (https://github.com/snowplow/snowplow/issues/163).\n */\nexport function hasLocalStorage() {\n  try {\n    return !!window.localStorage;\n  } catch (e) {\n    return true; // SecurityError when referencing it means it exists\n  }\n}\n\n/*\n * Checks whether localStorage is accessible\n * sets and removes an item to handle private IOS5 browsing\n * (http://git.io/jFB2Xw)\n */\nexport function localStorageAccessible() {\n  var mod = 'modernizr';\n  if (!hasLocalStorage()) {\n    return false;\n  }\n  try {\n    const ls = window.localStorage;\n    ls.setItem(mod, mod);\n    ls.removeItem(mod);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Gets the current viewport.\n *\n * Code based on:\n * - http://andylangton.co.uk/articles/javascript/get-viewport-size-javascript/\n * - http://responsejs.com/labs/dimensions/\n */\nexport function detectViewport() {\n  var width, height;\n\n  if ('innerWidth' in window) {\n    width = window['innerWidth'];\n    height = window['innerHeight'];\n  } else {\n    const e = document.documentElement || document.body;\n    width = e['clientWidth'];\n    height = e['clientHeight'];\n  }\n\n  if (width >= 0 && height >= 0) {\n    return width + 'x' + height;\n  } else {\n    return null;\n  }\n}\n\n/**\n * Gets the dimensions of the current\n * document.\n *\n * Code based on:\n * - http://andylangton.co.uk/articles/javascript/get-viewport-size-javascript/\n */\nexport function detectDocumentSize() {\n  var de = document.documentElement, // Alias\n    be = document.body,\n    // document.body may not have rendered, so check whether be.offsetHeight is null\n    bodyHeight = be ? Math.max(be.offsetHeight, be.scrollHeight) : 0;\n  var w = Math.max(de.clientWidth, de.offsetWidth, de.scrollWidth);\n  var h = Math.max(de.clientHeight, de.offsetHeight, de.scrollHeight, bodyHeight);\n  return isNaN(w) || isNaN(h) ? '' : w + 'x' + h;\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\ndeclare global {\n  interface EventTarget {\n    attachEvent?: (type: string, fn: EventListenerOrEventListenerObject) => void;\n  }\n}\n\n/**\n * The criteria which will be used to filter results to specific classes or elements\n */\nexport interface FilterCriterion<T> {\n  /** A collection of class names to include */\n  allowlist?: string[];\n  /** A collector of class names to exclude */\n  denylist?: string[];\n  /** A callback which returns a boolean as to whether the element should be included */\n  filter?: (elt: T) => boolean;\n}\n\n/**\n * Checks if an object is a string\n * @param str - The object to check\n */\nexport function isString(str: Object): str is string {\n  if (str && typeof str.valueOf() === 'string') {\n    return true;\n  }\n  return false;\n}\n\n/**\n * Checks if an object is an integer\n * @param int - The object to check\n */\nexport function isInteger(int: Object): int is number {\n  return (\n    (Number.isInteger && Number.isInteger(int)) || (typeof int === 'number' && isFinite(int) && Math.floor(int) === int)\n  );\n}\n\n/**\n * Checks if the input parameter is a function\n * @param func - The object to check\n */\nexport function isFunction(func: unknown) {\n  if (func && typeof func === 'function') {\n    return true;\n  }\n  return false;\n}\n\n/**\n * Cleans up the page title\n */\nexport function fixupTitle(title: string | { text: string }) {\n  if (!isString(title)) {\n    title = title.text || '';\n\n    var tmp = document.getElementsByTagName('title');\n    if (tmp && tmp[0] != null) {\n      title = tmp[0].text;\n    }\n  }\n  return title;\n}\n\n/**\n * Extract hostname from URL\n */\nexport function getHostName(url: string) {\n  // scheme : // [username [: password] @] hostname [: port] [/ [path] [? query] [# fragment]]\n  var e = new RegExp('^(?:(?:https?|ftp):)/*(?:[^@]+@)?([^:/#]+)'),\n    matches = e.exec(url);\n\n  return matches ? matches[1] : url;\n}\n\n/**\n * Fix-up domain\n */\nexport function fixupDomain(domain: string) {\n  var dl = domain.length;\n\n  // remove trailing '.'\n  if (domain.charAt(--dl) === '.') {\n    domain = domain.slice(0, dl);\n  }\n  // remove leading '*'\n  if (domain.slice(0, 2) === '*.') {\n    domain = domain.slice(1);\n  }\n  return domain;\n}\n\n/**\n * Get page referrer. In the case of a single-page app,\n * if the URL changes without the page reloading, pass\n * in the old URL. It will be returned unless overriden\n * by a \"refer(r)er\" parameter in the querystring.\n *\n * @param string - oldLocation Optional.\n * @returns string The referrer\n */\nexport function getReferrer(oldLocation?: string) {\n  let windowAlias = window,\n    referrer = '',\n    fromQs =\n      fromQuerystring('referrer', windowAlias.location.href) || fromQuerystring('referer', windowAlias.location.href);\n\n  // Short-circuit\n  if (fromQs) {\n    return fromQs;\n  }\n\n  // In the case of a single-page app, return the old URL\n  if (oldLocation) {\n    return oldLocation;\n  }\n\n  try {\n    referrer = windowAlias.top.document.referrer;\n  } catch (e) {\n    if (windowAlias.parent) {\n      try {\n        referrer = windowAlias.parent.document.referrer;\n      } catch (e2) {\n        referrer = '';\n      }\n    }\n  }\n  if (referrer === '') {\n    referrer = document.referrer;\n  }\n  return referrer;\n}\n\n/**\n * Cross-browser helper function to add event handler\n */\nexport function addEventListener(\n  element: HTMLElement | EventTarget,\n  eventType: string,\n  eventHandler: EventListenerOrEventListenerObject,\n  options?: boolean | AddEventListenerOptions\n) {\n  if (element.addEventListener) {\n    element.addEventListener(eventType, eventHandler, options);\n    return true;\n  }\n\n  // IE Support\n  if (element.attachEvent) {\n    return element.attachEvent('on' + eventType, eventHandler);\n  }\n  (element as any)['on' + eventType] = eventHandler;\n}\n\n/**\n * Return value from name-value pair in querystring\n */\nexport function fromQuerystring(field: string, url: string) {\n  var match = new RegExp('^[^#]*[?&]' + field + '=([^&#]*)').exec(url);\n  if (!match) {\n    return null;\n  }\n  return decodeURIComponent(match[1].replace(/\\+/g, ' '));\n}\n\n/**\n * Add a name-value pair to the querystring of a URL\n *\n * @param string - url URL to decorate\n * @param string - name Name of the querystring pair\n * @param string - value Value of the querystring pair\n */\nexport function decorateQuerystring(url: string, name: string, value: string) {\n  var initialQsParams = name + '=' + value;\n  var hashSplit = url.split('#');\n  var qsSplit = hashSplit[0].split('?');\n  var beforeQuerystring = qsSplit.shift();\n  // Necessary because a querystring may contain multiple question marks\n  var querystring = qsSplit.join('?');\n  if (!querystring) {\n    querystring = initialQsParams;\n  } else {\n    // Whether this is the first time the link has been decorated\n    var initialDecoration = true;\n    var qsFields = querystring.split('&');\n    for (var i = 0; i < qsFields.length; i++) {\n      if (qsFields[i].substr(0, name.length + 1) === name + '=') {\n        initialDecoration = false;\n        qsFields[i] = initialQsParams;\n        querystring = qsFields.join('&');\n        break;\n      }\n    }\n    if (initialDecoration) {\n      querystring = initialQsParams + '&' + querystring;\n    }\n  }\n  hashSplit[0] = beforeQuerystring + '?' + querystring;\n  return hashSplit.join('#');\n}\n\n/**\n * Attempt to get a value from localStorage\n *\n * @param string - key\n * @returns string The value obtained from localStorage, or\n *                undefined if localStorage is inaccessible\n */\nexport function attemptGetLocalStorage(key: string) {\n  try {\n    const localStorageAlias = window.localStorage,\n      exp = localStorageAlias.getItem(key + '.expires');\n    if (exp === null || +exp > Date.now()) {\n      return localStorageAlias.getItem(key);\n    } else {\n      localStorageAlias.removeItem(key);\n      localStorageAlias.removeItem(key + '.expires');\n    }\n    return undefined;\n  } catch (e) {\n    return undefined;\n  }\n}\n\n/**\n * Attempt to write a value to localStorage\n *\n * @param string - key\n * @param string - value\n * @param number - ttl Time to live in seconds, defaults to 2 years from Date.now()\n * @returns boolean Whether the operation succeeded\n */\nexport function attemptWriteLocalStorage(key: string, value: string, ttl = 63072000) {\n  try {\n    const localStorageAlias = window.localStorage,\n      t = Date.now() + ttl * 1000;\n    localStorageAlias.setItem(`${key}.expires`, t.toString());\n    localStorageAlias.setItem(key, value);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Attempt to delete a value from localStorage\n *\n * @param string - key\n * @returns boolean Whether the operation succeeded\n */\nexport function attemptDeleteLocalStorage(key: string) {\n  try {\n    const localStorageAlias = window.localStorage;\n    localStorageAlias.removeItem(key);\n    localStorageAlias.removeItem(key + '.expires');\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Attempt to get a value from sessionStorage\n *\n * @param string - key\n * @returns string The value obtained from sessionStorage, or\n *                undefined if sessionStorage is inaccessible\n */\nexport function attemptGetSessionStorage(key: string) {\n  try {\n    return window.sessionStorage.getItem(key);\n  } catch (e) {\n    return undefined;\n  }\n}\n\n/**\n * Attempt to write a value to sessionStorage\n *\n * @param string - key\n * @param string - value\n * @returns boolean Whether the operation succeeded\n */\nexport function attemptWriteSessionStorage(key: string, value: string) {\n  try {\n    window.sessionStorage.setItem(key, value);\n    return true;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Finds the root domain\n */\nexport function findRootDomain(sameSite: string, secure: boolean) {\n  const windowLocationHostnameAlias = window.location.hostname,\n    cookiePrefix = '_sp_root_domain_test_',\n    cookieName = cookiePrefix + new Date().getTime(),\n    cookieValue = '_test_value_' + new Date().getTime();\n\n  var split = windowLocationHostnameAlias.split('.');\n  var position = split.length - 1;\n  while (position >= 0) {\n    var currentDomain = split.slice(position, split.length).join('.');\n    cookie(cookieName, cookieValue, 0, '/', currentDomain, sameSite, secure);\n    if (cookie(cookieName) === cookieValue) {\n      // Clean up created cookie(s)\n      deleteCookie(cookieName, currentDomain, sameSite, secure);\n      var cookieNames = getCookiesWithPrefix(cookiePrefix);\n      for (var i = 0; i < cookieNames.length; i++) {\n        deleteCookie(cookieNames[i], currentDomain, sameSite, secure);\n      }\n\n      return currentDomain;\n    }\n    position -= 1;\n  }\n\n  // Cookies cannot be read\n  return windowLocationHostnameAlias;\n}\n\n/**\n * Checks whether a value is present within an array\n *\n * @param val - The value to check for\n * @param array - The array to check within\n * @returns boolean Whether it exists\n */\nexport function isValueInArray<T>(val: T, array: T[]) {\n  for (var i = 0; i < array.length; i++) {\n    if (array[i] === val) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * Deletes an arbitrary cookie by setting the expiration date to the past\n *\n * @param cookieName - The name of the cookie to delete\n * @param domainName - The domain the cookie is in\n */\nexport function deleteCookie(cookieName: string, domainName?: string, sameSite?: string, secure?: boolean) {\n  cookie(cookieName, '', -1, '/', domainName, sameSite, secure);\n}\n\n/**\n * Fetches the name of all cookies beginning with a certain prefix\n *\n * @param cookiePrefix - The prefix to check for\n * @returns array The cookies that begin with the prefix\n */\nexport function getCookiesWithPrefix(cookiePrefix: string) {\n  var cookies = document.cookie.split('; ');\n  var cookieNames = [];\n  for (var i = 0; i < cookies.length; i++) {\n    if (cookies[i].substring(0, cookiePrefix.length) === cookiePrefix) {\n      cookieNames.push(cookies[i]);\n    }\n  }\n  return cookieNames;\n}\n\n/**\n * Get and set the cookies associated with the current document in browser\n * This implementation always returns a string, returns the cookie value if only name is specified\n *\n * @param name - The cookie name (required)\n * @param value - The cookie value\n * @param ttl - The cookie Time To Live (seconds)\n * @param path - The cookies path\n * @param domain - The cookies domain\n * @param samesite - The cookies samesite attribute\n * @param secure - Boolean to specify if cookie should be secure\n * @returns string The cookies value\n */\nexport function cookie(\n  name: string,\n  value?: string,\n  ttl?: number,\n  path?: string,\n  domain?: string,\n  samesite?: string,\n  secure?: boolean\n) {\n  if (arguments.length > 1) {\n    return (document.cookie =\n      name +\n      '=' +\n      encodeURIComponent(value ?? '') +\n      (ttl ? '; Expires=' + new Date(+new Date() + ttl * 1000).toUTCString() : '') +\n      (path ? '; Path=' + path : '') +\n      (domain ? '; Domain=' + domain : '') +\n      (samesite ? '; SameSite=' + samesite : '') +\n      (secure ? '; Secure' : ''));\n  }\n\n  return decodeURIComponent((('; ' + document.cookie).split('; ' + name + '=')[1] || '').split(';')[0]);\n}\n\n/**\n * Parses an object and returns either the\n * integer or undefined.\n *\n * @param obj - The object to parse\n * @returns the result of the parse operation\n */\nexport function parseAndValidateInt(obj: unknown) {\n  var result = parseInt(obj as string);\n  return isNaN(result) ? undefined : result;\n}\n\n/**\n * Parses an object and returns either the\n * number or undefined.\n *\n * @param obj - The object to parse\n * @returns the result of the parse operation\n */\nexport function parseAndValidateFloat(obj: unknown) {\n  var result = parseFloat(obj as string);\n  return isNaN(result) ? undefined : result;\n}\n\n/**\n * Convert a criterion object to a filter function\n *\n * @param object - criterion Either {allowlist: [array of allowable strings]}\n *                             or {denylist: [array of allowable strings]}\n *                             or {filter: function (elt) {return whether to track the element}\n * @param boolean - byClass Whether to allowlist/denylist based on an element's classes (for forms)\n *                        or name attribute (for fields)\n */\nexport function getFilterByClass(criterion?: FilterCriterion<HTMLElement> | null): (elt: HTMLElement) => boolean {\n  // If the criterion argument is not an object, add listeners to all elements\n  if (criterion == null || typeof criterion !== 'object' || Array.isArray(criterion)) {\n    return function () {\n      return true;\n    };\n  }\n\n  const inclusive = Object.prototype.hasOwnProperty.call(criterion, 'allowlist');\n  const specifiedClassesSet = getSpecifiedClassesSet(criterion);\n\n  return getFilter(criterion, function (elt: HTMLElement) {\n    return checkClass(elt, specifiedClassesSet) === inclusive;\n  });\n}\n\n/**\n * Convert a criterion object to a filter function\n *\n * @param object - criterion Either {allowlist: [array of allowable strings]}\n *                             or {denylist: [array of allowable strings]}\n *                             or {filter: function (elt) {return whether to track the element}\n */\nexport function getFilterByName<T extends { name: string }>(criterion?: FilterCriterion<T>): (elt: T) => boolean {\n  // If the criterion argument is not an object, add listeners to all elements\n  if (criterion == null || typeof criterion !== 'object' || Array.isArray(criterion)) {\n    return function () {\n      return true;\n    };\n  }\n\n  const inclusive = criterion.hasOwnProperty('allowlist');\n  const specifiedClassesSet = getSpecifiedClassesSet(criterion);\n\n  return getFilter(criterion, function (elt: T) {\n    return elt.name in specifiedClassesSet === inclusive;\n  });\n}\n\n/**\n * List the classes of a DOM element without using elt.classList (for compatibility with IE 9)\n */\nexport function getCssClasses(elt: Element) {\n  return elt.className.match(/\\S+/g) || [];\n}\n\n/**\n * Check whether an element has at least one class from a given list\n */\nfunction checkClass(elt: Element, classList: Record<string, boolean>) {\n  var classes = getCssClasses(elt);\n\n  for (const className of classes) {\n    if (classList[className]) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\nfunction getFilter<T>(criterion: FilterCriterion<T>, fallbackFilter: (elt: T) => boolean) {\n  if (criterion.hasOwnProperty('filter') && criterion.filter) {\n    return criterion.filter;\n  }\n\n  return fallbackFilter;\n}\n\nfunction getSpecifiedClassesSet<T>(criterion: FilterCriterion<T>) {\n  // Convert the array of classes to an object of the form {class1: true, class2: true, ...}\n  var specifiedClassesSet: Record<string, boolean> = {};\n  var specifiedClasses = criterion.allowlist || criterion.denylist;\n\n  if (specifiedClasses) {\n    if (!Array.isArray(specifiedClasses)) {\n      specifiedClasses = [specifiedClasses];\n    }\n\n    for (var i = 0; i < specifiedClasses.length; i++) {\n      specifiedClassesSet[specifiedClasses[i]] = true;\n    }\n  }\n\n  return specifiedClassesSet;\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { attemptWriteLocalStorage, isString } from '../helpers';\nimport { SharedState } from '../state';\nimport { localStorageAccessible } from '../detectors';\nimport { LOG, Payload } from '@snowplow/tracker-core';\n\nexport interface OutQueue {\n  enqueueRequest: (request: Payload, url: string) => void;\n  executeQueue: () => void;\n  setUseLocalStorage: (localStorage: boolean) => void;\n  setAnonymousTracking: (anonymous: boolean) => void;\n  setCollectorUrl: (url: string) => void;\n  setBufferSize: (bufferSize: number) => void;\n}\n\n/**\n * Object handling sending events to a collector.\n * Instantiated once per tracker instance.\n *\n * @param id - The Snowplow function name (used to generate the localStorage key)\n * @param sharedSate - Stores reference to the outbound queue so it can unload the page when all queues are empty\n * @param useLocalStorage - Whether to use localStorage at all\n * @param eventMethod - if null will use 'beacon' otherwise can be set to 'post', 'get', or 'beacon' to force.\n * @param postPath - The path where events are to be posted\n * @param bufferSize - How many events to batch in localStorage before sending them all\n * @param maxPostBytes - Maximum combined size in bytes of the event JSONs in a POST request\n * @param useStm - Whether to add timestamp to events\n * @param maxLocalStorageQueueSize - Maximum number of queued events we will attempt to store in local storage\n * @param connectionTimeout - Defines how long to wait before aborting the request\n * @param anonymousTracking - Defines whether to set the SP-Anonymous header for anonymous tracking on GET and POST\n * @returns object OutQueueManager instance\n */\nexport function OutQueueManager(\n  id: string,\n  sharedSate: SharedState,\n  useLocalStorage: boolean,\n  eventMethod: string | boolean | null,\n  postPath: string,\n  bufferSize: number,\n  maxPostBytes: number,\n  useStm: boolean,\n  maxLocalStorageQueueSize: number,\n  connectionTimeout: number,\n  anonymousTracking: boolean\n): OutQueue {\n  type PostEvent = {\n    evt: Record<string, unknown>;\n    bytes: number;\n  };\n\n  let executingQueue = false,\n    configCollectorUrl: string,\n    outQueue: Array<PostEvent> | Array<string> = [];\n\n  //Force to lower case if its a string\n  eventMethod = typeof eventMethod === 'string' ? eventMethod.toLowerCase() : eventMethod;\n\n  // Use the Beacon API if eventMethod is set null, true, or 'beacon'.\n  const isBeaconRequested =\n      eventMethod === null || eventMethod === true || eventMethod === 'beacon' || eventMethod === 'true',\n    // Fall back to POST or GET for browsers which don't support Beacon API\n    isBeaconAvailable = Boolean(\n      isBeaconRequested &&\n        window.navigator &&\n        window.navigator.sendBeacon &&\n        !hasWebKitBeaconBug(window.navigator.userAgent)\n    ),\n    useBeacon = isBeaconAvailable && isBeaconRequested,\n    // Use GET if specified\n    isGetRequested = eventMethod === 'get',\n    // Don't use XhrHttpRequest for browsers which don't support CORS XMLHttpRequests (e.g. IE <= 9)\n    useXhr = Boolean(window.XMLHttpRequest && 'withCredentials' in new XMLHttpRequest()),\n    // Use POST if specified\n    usePost = !isGetRequested && useXhr && (eventMethod === 'post' || isBeaconRequested),\n    // Resolve all options and capabilities and decide path\n    path = usePost ? postPath : '/i',\n    // Different queue names for GET and POST since they are stored differently\n    queueName = `snowplowOutQueue_${id}_${usePost ? 'post2' : 'get'}`;\n\n  // Get buffer size or set 1 if unable to buffer\n  bufferSize = (useLocalStorage && localStorageAccessible() && usePost && bufferSize) || 1;\n\n  if (useLocalStorage) {\n    // Catch any JSON parse errors or localStorage that might be thrown\n    try {\n      const localStorageQueue = window.localStorage.getItem(queueName);\n      outQueue = localStorageQueue ? JSON.parse(localStorageQueue) : [];\n    } catch (e) {}\n  }\n\n  // Initialize to and empty array if we didn't get anything out of localStorage\n  if (!Array.isArray(outQueue)) {\n    outQueue = [];\n  }\n\n  // Used by pageUnloadGuard\n  sharedSate.outQueues.push(outQueue);\n\n  if (useXhr && bufferSize > 1) {\n    sharedSate.bufferFlushers.push(function (sync) {\n      if (!executingQueue) {\n        executeQueue(sync);\n      }\n    });\n  }\n\n  /*\n   * Convert a dictionary to a querystring\n   * The context field is the last in the querystring\n   */\n  function getQuerystring(request: Payload) {\n    let querystring = '?',\n      lowPriorityKeys = { co: true, cx: true },\n      firstPair = true;\n\n    for (const key in request) {\n      if (request.hasOwnProperty(key) && !lowPriorityKeys.hasOwnProperty(key)) {\n        if (!firstPair) {\n          querystring += '&';\n        } else {\n          firstPair = false;\n        }\n        querystring += encodeURIComponent(key) + '=' + encodeURIComponent(request[key] as string | number | boolean);\n      }\n    }\n\n    for (const contextKey in lowPriorityKeys) {\n      if (request.hasOwnProperty(contextKey) && lowPriorityKeys.hasOwnProperty(contextKey)) {\n        querystring += '&' + contextKey + '=' + encodeURIComponent(request[contextKey] as string | number | boolean);\n      }\n    }\n\n    return querystring;\n  }\n\n  /*\n   * Convert numeric fields to strings to match payload_data schema\n   */\n  function getBody(request: Payload): PostEvent {\n    const cleanedRequest = Object.keys(request)\n      .map<[string, unknown]>((k) => [k, request[k]])\n      .reduce((acc, [key, value]) => {\n        acc[key] = (value as Object).toString();\n        return acc;\n      }, {} as Record<string, unknown>);\n    return {\n      evt: cleanedRequest,\n      bytes: getUTF8Length(JSON.stringify(cleanedRequest)),\n    };\n  }\n\n  /**\n   * Count the number of bytes a string will occupy when UTF-8 encoded\n   * Taken from http://stackoverflow.com/questions/2848462/count-bytes-in-textarea-using-javascript/\n   *\n   * @param string - s\n   * @returns number Length of s in bytes when UTF-8 encoded\n   */\n  function getUTF8Length(s: string) {\n    let len = 0;\n    for (let i = 0; i < s.length; i++) {\n      const code = s.charCodeAt(i);\n      if (code <= 0x7f) {\n        len += 1;\n      } else if (code <= 0x7ff) {\n        len += 2;\n      } else if (code >= 0xd800 && code <= 0xdfff) {\n        // Surrogate pair: These take 4 bytes in UTF-8 and 2 chars in UCS-2\n        // (Assume next char is the other [valid] half and just skip it)\n        len += 4;\n        i++;\n      } else if (code < 0xffff) {\n        len += 3;\n      } else {\n        len += 4;\n      }\n    }\n    return len;\n  }\n\n  const postable = (queue: Array<PostEvent> | Array<string>): queue is Array<PostEvent> => {\n    return typeof queue[0] === 'object';\n  };\n\n  /*\n   * Queue for submission to the collector and start processing queue\n   */\n  function enqueueRequest(request: Payload, url: string) {\n    configCollectorUrl = url + path;\n    if (usePost) {\n      const body = getBody(request);\n      if (body.bytes >= maxPostBytes) {\n        LOG.warn('Event (' + body.bytes + 'B) too big, max is ' + maxPostBytes);\n        const xhr = initializeXMLHttpRequest(configCollectorUrl, true, false);\n        xhr.send(encloseInPayloadDataEnvelope(attachStmToEvent([body.evt])));\n        return;\n      } else {\n        (outQueue as Array<PostEvent>).push(body);\n      }\n    } else {\n      (outQueue as Array<string>).push(getQuerystring(request));\n    }\n    let savedToLocalStorage = false;\n    if (useLocalStorage) {\n      savedToLocalStorage = attemptWriteLocalStorage(\n        queueName,\n        JSON.stringify(outQueue.slice(0, maxLocalStorageQueueSize))\n      );\n    }\n\n    // If we're not processing the queue, we'll start.\n    if (!executingQueue && (!savedToLocalStorage || outQueue.length >= bufferSize)) {\n      executeQueue();\n    }\n  }\n\n  /*\n   * Run through the queue of requests, sending them one at a time.\n   * Stops processing when we run out of queued requests, or we get an error.\n   */\n  function executeQueue(sync: boolean = false) {\n    // Failsafe in case there is some way for a bad value like \"null\" to end up in the outQueue\n    while (outQueue.length && typeof outQueue[0] !== 'string' && typeof outQueue[0] !== 'object') {\n      outQueue.shift();\n    }\n\n    if (outQueue.length < 1) {\n      executingQueue = false;\n      return;\n    }\n\n    // Let's check that we have a URL\n    if (!isString(configCollectorUrl)) {\n      throw 'No collector configured';\n    }\n\n    executingQueue = true;\n\n    if (useXhr) {\n      // Keep track of number of events to delete from queue\n      const chooseHowManyToSend = (queue: Array<{ bytes: number }>) => {\n        let numberToSend = 0,\n          byteCount = 0;\n        while (numberToSend < queue.length) {\n          byteCount += queue[numberToSend].bytes;\n          if (byteCount >= maxPostBytes) {\n            break;\n          } else {\n            numberToSend += 1;\n          }\n        }\n        return numberToSend;\n      };\n\n      let url: string, xhr: XMLHttpRequest, numberToSend: number;\n      if (postable(outQueue)) {\n        url = configCollectorUrl;\n        xhr = initializeXMLHttpRequest(url, true, sync);\n        numberToSend = chooseHowManyToSend(outQueue);\n      } else {\n        url = createGetUrl(outQueue[0]);\n        xhr = initializeXMLHttpRequest(url, false, sync);\n        numberToSend = 1;\n      }\n\n      // Time out POST requests after connectionTimeout\n      const xhrTimeout = setTimeout(function () {\n        xhr.abort();\n        executingQueue = false;\n      }, connectionTimeout);\n\n      // The events (`numberToSend` of them), have been sent, so we remove them from the outQueue\n      // We also call executeQueue() again, to let executeQueue() check if we should keep running through the queue\n      const onPostSuccess = (numberToSend: number): void => {\n        for (let deleteCount = 0; deleteCount < numberToSend; deleteCount++) {\n          outQueue.shift();\n        }\n        if (useLocalStorage) {\n          attemptWriteLocalStorage(queueName, JSON.stringify(outQueue.slice(0, maxLocalStorageQueueSize)));\n        }\n        executeQueue();\n      };\n\n      xhr.onreadystatechange = function () {\n        if (xhr.readyState === 4 && xhr.status >= 200 && xhr.status < 400) {\n          clearTimeout(xhrTimeout);\n          onPostSuccess(numberToSend);\n        } else if (xhr.readyState === 4 && xhr.status >= 400) {\n          clearTimeout(xhrTimeout);\n          executingQueue = false;\n        }\n      };\n\n      if (!postable(outQueue)) {\n        // If not postable then it's a GET so just send it\n        xhr.send();\n      } else {\n        let batch = outQueue.slice(0, numberToSend);\n\n        if (batch.length > 0) {\n          let beaconStatus = false;\n\n          const eventBatch = batch.map(function (x) {\n            return x.evt;\n          });\n\n          if (useBeacon) {\n            const blob = new Blob([encloseInPayloadDataEnvelope(attachStmToEvent(eventBatch))], {\n              type: 'application/json',\n            });\n            try {\n              beaconStatus = navigator.sendBeacon(url, blob);\n            } catch (error) {\n              beaconStatus = false;\n            }\n          }\n\n          // When beaconStatus is true, we can't _guarantee_ that it was successful (beacon queues asynchronously)\n          // but the browser has taken it out of our hands, so we want to flush the queue assuming it will do its job\n          if (beaconStatus === true) {\n            onPostSuccess(numberToSend);\n          } else {\n            xhr.send(encloseInPayloadDataEnvelope(attachStmToEvent(eventBatch)));\n          }\n        }\n      }\n    } else if (!anonymousTracking && !postable(outQueue)) {\n      // We can't send with this technique if anonymous tracking is on as we can't attach the header\n      let image = new Image(1, 1),\n        loading = true;\n\n      image.onload = function () {\n        if (!loading) return;\n        loading = false;\n        outQueue.shift();\n        if (useLocalStorage) {\n          attemptWriteLocalStorage(queueName, JSON.stringify(outQueue.slice(0, maxLocalStorageQueueSize)));\n        }\n        executeQueue();\n      };\n\n      image.onerror = function () {\n        if (!loading) return;\n        loading = false;\n        executingQueue = false;\n      };\n\n      image.src = createGetUrl(outQueue[0]);\n\n      setTimeout(function () {\n        if (loading && executingQueue) {\n          loading = false;\n          executeQueue();\n        }\n      }, connectionTimeout);\n    } else {\n      executingQueue = false;\n    }\n  }\n\n  /**\n   * Open an XMLHttpRequest for a given endpoint with the correct credentials and header\n   *\n   * @param string - url The destination URL\n   * @returns object The XMLHttpRequest\n   */\n  function initializeXMLHttpRequest(url: string, post: boolean, sync: boolean) {\n    const xhr = new XMLHttpRequest();\n    if (post) {\n      xhr.open('POST', url, !sync);\n      xhr.setRequestHeader('Content-Type', 'application/json; charset=UTF-8');\n    } else {\n      xhr.open('GET', url, !sync);\n    }\n    xhr.withCredentials = true;\n    if (anonymousTracking) {\n      xhr.setRequestHeader('SP-Anonymous', '*');\n    }\n    return xhr;\n  }\n\n  /**\n   * Enclose an array of events in a self-describing payload_data JSON string\n   *\n   * @param array - events Batch of events\n   * @returns string payload_data self-describing JSON\n   */\n  function encloseInPayloadDataEnvelope(events: Array<Record<string, unknown>>) {\n    return JSON.stringify({\n      schema: 'iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-4',\n      data: events,\n    });\n  }\n\n  /**\n   * Attaches the STM field to outbound POST events.\n   *\n   * @param events - the events to attach the STM to\n   */\n  function attachStmToEvent(events: Array<Record<string, unknown>>) {\n    const stm = new Date().getTime().toString();\n    for (let i = 0; i < events.length; i++) {\n      events[i]['stm'] = stm;\n    }\n    return events;\n  }\n\n  /**\n   * Creates the full URL for sending the GET request. Will append `stm` if enabled\n   *\n   * @param nextRequest - the query string of the next request\n   */\n  function createGetUrl(nextRequest: string) {\n    if (useStm) {\n      return configCollectorUrl + nextRequest.replace('?', '?stm=' + new Date().getTime() + '&');\n    }\n\n    return configCollectorUrl + nextRequest;\n  }\n\n  return {\n    enqueueRequest: enqueueRequest,\n    executeQueue: () => {\n      if (!executingQueue) {\n        executeQueue();\n      }\n    },\n    setUseLocalStorage: (localStorage: boolean) => {\n      useLocalStorage = localStorage;\n    },\n    setAnonymousTracking: (anonymous: boolean) => {\n      anonymousTracking = anonymous;\n    },\n    setCollectorUrl: (url: string) => {\n      configCollectorUrl = url + path;\n    },\n    setBufferSize: (newBufferSize: number) => {\n      bufferSize = newBufferSize;\n    },\n  };\n\n  function hasWebKitBeaconBug(useragent: string) {\n    return (\n      isIosVersionLessThanOrEqualTo(13, useragent) ||\n      (isMacosxVersionLessThanOrEqualTo(10, 15, useragent) && isSafari(useragent))\n    );\n\n    function isIosVersionLessThanOrEqualTo(major: number, useragent: string) {\n      const match = useragent.match('(iP.+; CPU .*OS (d+)[_d]*.*) AppleWebKit/');\n      if (match && match.length) {\n        return parseInt(match[0]) <= major;\n      }\n      return false;\n    }\n\n    function isMacosxVersionLessThanOrEqualTo(major: number, minor: number, useragent: string) {\n      const match = useragent.match('(Macintosh;.*Mac OS X (d+)_(d+)[_d]*.*) AppleWebKit/');\n      if (match && match.length) {\n        return parseInt(match[0]) <= major || (parseInt(match[0]) === major && parseInt(match[1]) <= minor);\n      }\n      return false;\n    }\n\n    function isSafari(useragent: string) {\n      return useragent.match('Version/.* Safari/') && !isChromiumBased(useragent);\n    }\n\n    function isChromiumBased(useragent: string) {\n      return useragent.match('Chrom(e|ium)');\n    }\n  }\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { fromQuerystring, getHostName } from './helpers';\n\n/*\n * Extract parameter from URL\n */\nfunction getParameter(url: string, name: string) {\n  // scheme : // [username [: password] @] hostname [: port] [/ [path] [? query] [# fragment]]\n  var e = new RegExp('^(?:https?|ftp)(?::/*(?:[^?]+))([?][^#]+)'),\n    matches = e.exec(url);\n\n  if (matches && matches?.length > 1) {\n    return fromQuerystring(name, matches[1]);\n  }\n  return null;\n}\n\n/*\n * Fix-up URL when page rendered from search engine cache or translated page.\n */\nexport function fixupUrl(hostName: string, href: string, referrer: string) {\n  if (hostName === 'translate.googleusercontent.com') {\n    // Google\n    if (referrer === '') {\n      referrer = href;\n    }\n    href = getParameter(href, 'u') ?? '';\n    hostName = getHostName(href);\n  } else if (\n    hostName === 'cc.bingj.com' || // Bing & Yahoo\n    hostName === 'webcache.googleusercontent.com' // Google\n  ) {\n    href = document.links[0].href;\n    hostName = getHostName(href);\n  }\n  return [hostName, href, referrer];\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport {\n  trackerCore,\n  buildPagePing,\n  buildPageView,\n  CommonEventProperties,\n  PayloadBuilder,\n  SelfDescribingJson,\n  LOG,\n} from '@snowplow/tracker-core';\nimport hash from 'sha1';\nimport { v4 as uuid } from 'uuid';\nimport { detectDocumentSize, detectViewport } from '../detectors';\nimport {\n  decorateQuerystring,\n  findRootDomain,\n  fixupDomain,\n  getReferrer,\n  addEventListener,\n  getHostName,\n  cookie,\n  attemptGetLocalStorage,\n  attemptWriteLocalStorage,\n  attemptDeleteLocalStorage,\n  deleteCookie,\n  fixupTitle,\n  fromQuerystring,\n  isInteger,\n} from '../helpers';\nimport { OutQueueManager } from './out_queue';\nimport { fixupUrl } from '../proxies';\nimport { SharedState } from '../state';\nimport {\n  PageViewEvent,\n  ActivityCallback,\n  ActivityCallbackData,\n  TrackerConfiguration,\n  BrowserTracker,\n  ActivityTrackingConfiguration,\n  ActivityTrackingConfigurationCallback,\n  DisableAnonymousTrackingConfiguration,\n  EnableAnonymousTrackingConfiguration,\n  FlushBufferConfiguration,\n  BrowserPluginConfiguration,\n  ClearUserDataConfiguration,\n} from './types';\n\n/** Repesents an instance of an activity tracking configuration */\ntype ActivityConfig = {\n  /** The callback to fire based on heart beat */\n  callback: ActivityCallback;\n  /** The minimum time that must have elapsed before first heartbeat */\n  configMinimumVisitLength: number;\n  /** The interval at which the callback will be fired */\n  configHeartBeatTimer: number;\n  /** The setInterval identifier */\n  activityInterval?: number;\n};\n\n/** The configurations for the two types of Activity Tracking */\ntype ActivityConfigurations = {\n  /** The configuration for enableActivityTrackingCallback */\n  callback?: ActivityConfig;\n  /** The configuration for enableActivityTracking */\n  pagePing?: ActivityConfig;\n};\n\n/** The configuration for if either activity tracking system is enable */\ntype ActivityTrackingConfig = {\n  /** Tracks if activity tracking is enabled */\n  enabled: boolean;\n  /** Tracks if activity tracking hooks have been installed */\n  installed: boolean;\n  /** Stores the configuration for each type of activity tracking */\n  configurations: ActivityConfigurations;\n};\n\n/**\n * The Snowplow Tracker\n *\n * @param trackerId - The unique identifier of the tracker\n * @param namespace - The namespace of the tracker object\n * @param version - The current version of the JavaScript Tracker\n * @param endpoint - The collector endpoint to send events to, with or without protocol\n * @param sharedState - An object containing state which is shared across tracker instances\n * @param trackerConfiguration - Dictionary of configuration options\n */\nexport function Tracker(\n  trackerId: string,\n  namespace: string,\n  version: string,\n  endpoint: string,\n  sharedState: SharedState,\n  trackerConfiguration: TrackerConfiguration = {}\n): BrowserTracker {\n  const newTracker = (\n    trackerId: string,\n    namespace: string,\n    version: string,\n    endpoint: string,\n    state: SharedState,\n    trackerConfiguration: TrackerConfiguration\n  ) => {\n    /************************************************************\n     * Private members\n     ************************************************************/\n\n    //use POST if eventMethod isn't present on the newTrackerConfiguration\n    trackerConfiguration.eventMethod = trackerConfiguration.eventMethod ?? 'post';\n\n    const getStateStorageStrategy = (config: TrackerConfiguration) =>\n        config.stateStorageStrategy ?? 'cookieAndLocalStorage',\n      getAnonymousSessionTracking = (config: TrackerConfiguration) => {\n        if (typeof config.anonymousTracking === 'boolean') {\n          return false;\n        }\n        return config.anonymousTracking?.withSessionTracking === true ?? false;\n      },\n      getAnonymousServerTracking = (config: TrackerConfiguration) => {\n        if (typeof config.anonymousTracking === 'boolean') {\n          return false;\n        }\n        return config.anonymousTracking?.withServerAnonymisation === true ?? false;\n      },\n      getAnonymousTracking = (config: TrackerConfiguration) => !!config.anonymousTracking;\n\n    // Get all injected plugins\n    trackerConfiguration.plugins = trackerConfiguration.plugins ?? [];\n    if (trackerConfiguration?.contexts?.webPage ?? true) {\n      trackerConfiguration.plugins.push(getWebPagePlugin()); // Defaults to including the Web Page context\n    }\n\n    let // Tracker core\n      core = trackerCore({\n        base64: trackerConfiguration.encodeBase64,\n        corePlugins: trackerConfiguration.plugins,\n        callback: function (payloadBuilder) {\n          addBrowserData(payloadBuilder);\n          sendRequest(payloadBuilder);\n        },\n      }),\n      // Aliases\n      browserLanguage = (navigator as any).userLanguage || navigator.language,\n      documentCharset = document.characterSet || document.charset,\n      // Current URL and Referrer URL\n      locationArray = fixupUrl(window.location.hostname, window.location.href, getReferrer()),\n      domainAlias = fixupDomain(locationArray[0]),\n      locationHrefAlias = locationArray[1],\n      configReferrerUrl = locationArray[2],\n      customReferrer: string,\n      // Platform defaults to web for this tracker\n      configPlatform = trackerConfiguration.platform ?? 'web',\n      // Snowplow collector URL\n      configCollectorUrl = asCollectorUrl(endpoint),\n      // Custom path for post requests (to get around adblockers)\n      configPostPath = trackerConfiguration.postPath ?? '/com.snowplowanalytics.snowplow/tp2',\n      // Site ID\n      configTrackerSiteId = trackerConfiguration.appId ?? '',\n      // Document URL\n      configCustomUrl: string,\n      // Document title\n      lastDocumentTitle = document.title,\n      // Custom title\n      lastConfigTitle: string | null | undefined,\n      // Controls whether activity tracking page ping event timers are reset on page view events\n      resetActivityTrackingOnPageView = trackerConfiguration.resetActivityTrackingOnPageView ?? true,\n      // Disallow hash tags in URL. TODO: Should this be set to true by default?\n      configDiscardHashTag: boolean,\n      // Disallow brace in URL.\n      configDiscardBrace: boolean,\n      // First-party cookie name prefix\n      configCookieNamePrefix = trackerConfiguration.cookieName ?? '_sp_',\n      // First-party cookie domain\n      // User agent defaults to origin hostname\n      configCookieDomain = trackerConfiguration.cookieDomain ?? undefined,\n      // First-party cookie path\n      // Default is user agent defined.\n      configCookiePath = '/',\n      // First-party cookie samesite attribute\n      configCookieSameSite = trackerConfiguration.cookieSameSite ?? 'None',\n      // First-party cookie secure attribute\n      configCookieSecure = trackerConfiguration.cookieSecure ?? true,\n      // Do Not Track browser feature\n      dnt = navigator.doNotTrack || (navigator as any).msDoNotTrack || window.doNotTrack,\n      // Do Not Track\n      configDoNotTrack =\n        typeof trackerConfiguration.respectDoNotTrack !== 'undefined'\n          ? trackerConfiguration.respectDoNotTrack && (dnt === 'yes' || dnt === '1')\n          : false,\n      // Opt out of cookie tracking\n      configOptOutCookie: string | null | undefined,\n      // Life of the visitor cookie (in seconds)\n      configVisitorCookieTimeout = trackerConfiguration.cookieLifetime ?? 63072000, // 2 years\n      // Life of the session cookie (in seconds)\n      configSessionCookieTimeout = trackerConfiguration.sessionCookieTimeout ?? 1800, // 30 minutes\n      // Allows tracking user session (using cookies or local storage), can only be used with anonymousTracking\n      configAnonymousSessionTracking = getAnonymousSessionTracking(trackerConfiguration),\n      // Will send a header to server to prevent returning cookie and capturing IP\n      configAnonymousServerTracking = getAnonymousServerTracking(trackerConfiguration),\n      // Sets tracker to work in anonymous mode without accessing client storage\n      configAnonymousTracking = getAnonymousTracking(trackerConfiguration),\n      // Strategy defining how to store the state: cookie, localStorage, cookieAndLocalStorage or none\n      configStateStorageStrategy = getStateStorageStrategy(trackerConfiguration),\n      // Last activity timestamp\n      lastActivityTime: number,\n      // The last time an event was fired on the page - used to invalidate session if cookies are disabled\n      lastEventTime = new Date().getTime(),\n      // How are we scrolling?\n      minXOffset: number,\n      maxXOffset: number,\n      minYOffset: number,\n      maxYOffset: number,\n      // Domain hash value\n      domainHash: string,\n      // Domain unique user ID\n      domainUserId: string,\n      // ID for the current session\n      memorizedSessionId: string,\n      // Index for the current session - kept in memory in case cookies are disabled\n      memorizedVisitCount = 1,\n      // Business-defined unique user ID\n      businessUserId: string | null | undefined,\n      // Manager for local storage queue\n      outQueue = OutQueueManager(\n        trackerId,\n        state,\n        configStateStorageStrategy == 'localStorage' || configStateStorageStrategy == 'cookieAndLocalStorage',\n        trackerConfiguration.eventMethod,\n        configPostPath,\n        trackerConfiguration.bufferSize ?? 1,\n        trackerConfiguration.maxPostBytes ?? 40000,\n        trackerConfiguration.useStm ?? true,\n        trackerConfiguration.maxLocalStorageQueueSize ?? 1000,\n        trackerConfiguration.connectionTimeout ?? 5000,\n        configAnonymousServerTracking\n      ),\n      // Whether pageViewId should be regenerated after each trackPageView. Affect web_page context\n      preservePageViewId = false,\n      // Whether first trackPageView was fired and pageViewId should not be changed anymore until reload\n      pageViewSent = false,\n      // Activity tracking config for callback and pacge ping variants\n      activityTrackingConfig: ActivityTrackingConfig = {\n        enabled: false,\n        installed: false, // Guard against installing the activity tracker more than once per Tracker instance\n        configurations: {},\n      };\n\n    if (trackerConfiguration.hasOwnProperty('discoverRootDomain') && trackerConfiguration.discoverRootDomain) {\n      configCookieDomain = findRootDomain(configCookieSameSite, configCookieSecure);\n    }\n\n    // Set up unchanging name-value pairs\n    core.setTrackerVersion(version);\n    core.setTrackerNamespace(namespace);\n    core.setAppId(configTrackerSiteId);\n    core.setPlatform(configPlatform);\n    core.addPayloadPair('cookie', navigator.cookieEnabled ? '1' : '0');\n    core.addPayloadPair('cs', documentCharset);\n    core.addPayloadPair('lang', browserLanguage);\n    core.addPayloadPair('res', screen.width + 'x' + screen.height);\n    core.addPayloadPair('cd', screen.colorDepth);\n\n    /*\n     * Initialize tracker\n     */\n    updateDomainHash();\n\n    initializeIdsAndCookies();\n\n    if (trackerConfiguration.crossDomainLinker) {\n      decorateLinks(trackerConfiguration.crossDomainLinker);\n    }\n\n    /**\n     * Recalculate the domain, URL, and referrer\n     */\n    function refreshUrl() {\n      locationArray = fixupUrl(window.location.hostname, window.location.href, getReferrer());\n\n      // If this is a single-page app and the page URL has changed, then:\n      //   - if the new URL's querystring contains a \"refer(r)er\" parameter, use it as the referrer\n      //   - otherwise use the old URL as the referer\n      if (locationArray[1] !== locationHrefAlias) {\n        configReferrerUrl = getReferrer(locationHrefAlias);\n      }\n\n      domainAlias = fixupDomain(locationArray[0]);\n      locationHrefAlias = locationArray[1];\n    }\n\n    /**\n     * Decorate the querystring of a single link\n     *\n     * @param event - e The event targeting the link\n     */\n    function linkDecorationHandler(evt: Event) {\n      var timestamp = new Date().getTime();\n      let elt = evt.currentTarget as HTMLAnchorElement | HTMLAreaElement | null;\n      if (elt?.href) {\n        elt.href = decorateQuerystring(elt.href, '_sp', domainUserId + '.' + timestamp);\n      }\n    }\n\n    /**\n     * Enable querystring decoration for links pasing a filter\n     * Whenever such a link is clicked on or navigated to via the keyboard,\n     * add \"_sp={{duid}}.{{timestamp}}\" to its querystring\n     *\n     * @param crossDomainLinker - Function used to determine which links to decorate\n     */\n    function decorateLinks(crossDomainLinker: (elt: HTMLAnchorElement | HTMLAreaElement) => boolean) {\n      for (var i = 0; i < document.links.length; i++) {\n        var elt = document.links[i];\n        if (!(elt as any).spDecorationEnabled && crossDomainLinker(elt)) {\n          addEventListener(elt, 'click', linkDecorationHandler, true);\n          addEventListener(elt, 'mousedown', linkDecorationHandler, true);\n\n          // Don't add event listeners more than once\n          (elt as any).spDecorationEnabled = true;\n        }\n      }\n    }\n\n    /*\n     * Removes hash tag from the URL\n     *\n     * URLs are purified before being recorded in the cookie,\n     * or before being sent as GET parameters\n     */\n    function purify(url: string) {\n      var targetPattern;\n\n      if (configDiscardHashTag) {\n        targetPattern = new RegExp('#.*');\n        url = url.replace(targetPattern, '');\n      }\n\n      if (configDiscardBrace) {\n        targetPattern = new RegExp('[{}]', 'g');\n        url = url.replace(targetPattern, '');\n      }\n      return url;\n    }\n\n    /*\n     * Extract scheme/protocol from URL\n     */\n    function getProtocolScheme(url: string) {\n      var e = new RegExp('^([a-z]+):'),\n        matches = e.exec(url);\n\n      return matches ? matches[1] : null;\n    }\n\n    /*\n     * Resolve relative reference\n     *\n     * Note: not as described in rfc3986 section 5.2\n     */\n    function resolveRelativeReference(baseUrl: string, url: string) {\n      var protocol = getProtocolScheme(url),\n        i;\n\n      if (protocol) {\n        return url;\n      }\n\n      if (url.slice(0, 1) === '/') {\n        return getProtocolScheme(baseUrl) + '://' + getHostName(baseUrl) + url;\n      }\n\n      baseUrl = purify(baseUrl);\n      if ((i = baseUrl.indexOf('?')) >= 0) {\n        baseUrl = baseUrl.slice(0, i);\n      }\n      if ((i = baseUrl.lastIndexOf('/')) !== baseUrl.length - 1) {\n        baseUrl = baseUrl.slice(0, i + 1);\n      }\n\n      return baseUrl + url;\n    }\n\n    /*\n     * Send request\n     */\n    function sendRequest(request: PayloadBuilder) {\n      // Set to true if Opt-out cookie is defined\n      var toOptoutByCookie;\n      if (configOptOutCookie) {\n        toOptoutByCookie = !!cookie(configOptOutCookie);\n      } else {\n        toOptoutByCookie = false;\n      }\n\n      if (!(configDoNotTrack || toOptoutByCookie)) {\n        outQueue.enqueueRequest(request.build(), configCollectorUrl);\n      }\n    }\n\n    /*\n     * Get cookie name with prefix and domain hash\n     */\n    function getSnowplowCookieName(baseName: string) {\n      return configCookieNamePrefix + baseName + '.' + domainHash;\n    }\n\n    /*\n     * Cookie getter.\n     */\n    function getSnowplowCookieValue(cookieName: string) {\n      var fullName = getSnowplowCookieName(cookieName);\n      if (configStateStorageStrategy == 'localStorage') {\n        return attemptGetLocalStorage(fullName);\n      } else if (configStateStorageStrategy == 'cookie' || configStateStorageStrategy == 'cookieAndLocalStorage') {\n        return cookie(fullName);\n      }\n      return undefined;\n    }\n\n    /*\n     * Update domain hash\n     */\n    function updateDomainHash() {\n      refreshUrl();\n      domainHash = hash((configCookieDomain || domainAlias) + (configCookiePath || '/')).slice(0, 4); // 4 hexits = 16 bits\n    }\n\n    /*\n     * Process all \"activity\" events.\n     * For performance, this function must have low overhead.\n     */\n    function activityHandler() {\n      var now = new Date();\n      lastActivityTime = now.getTime();\n    }\n\n    /*\n     * Process all \"scroll\" events.\n     */\n    function scrollHandler() {\n      updateMaxScrolls();\n      activityHandler();\n    }\n\n    /*\n     * Returns [pageXOffset, pageYOffset]\n     */\n    function getPageOffsets() {\n      const documentElement = document.documentElement;\n      if (documentElement) {\n        return [documentElement.scrollLeft || window.pageXOffset, documentElement.scrollTop || window.pageYOffset];\n      }\n\n      return [0, 0];\n    }\n\n    /*\n     * Quick initialization/reset of max scroll levels\n     */\n    function resetMaxScrolls() {\n      const offsets = getPageOffsets();\n\n      const x = offsets[0];\n      minXOffset = x;\n      maxXOffset = x;\n\n      const y = offsets[1];\n      minYOffset = y;\n      maxYOffset = y;\n    }\n\n    /*\n     * Check the max scroll levels, updating as necessary\n     */\n    function updateMaxScrolls() {\n      const offsets = getPageOffsets();\n\n      const x = offsets[0];\n      if (x < minXOffset) {\n        minXOffset = x;\n      } else if (x > maxXOffset) {\n        maxXOffset = x;\n      }\n\n      const y = offsets[1];\n      if (y < minYOffset) {\n        minYOffset = y;\n      } else if (y > maxYOffset) {\n        maxYOffset = y;\n      }\n    }\n\n    /*\n     * Prevents offsets from being decimal or NaN\n     * See https://github.com/snowplow/snowplow-javascript-tracker/issues/324\n     */\n    function cleanOffset(offset: number) {\n      return Math.round(offset);\n    }\n\n    /*\n     * Sets or renews the session cookie\n     */\n    function setSessionCookie() {\n      var cookieName = getSnowplowCookieName('ses');\n      var cookieValue = '*';\n      setCookie(cookieName, cookieValue, configSessionCookieTimeout);\n    }\n\n    /*\n     * Sets the Visitor ID cookie: either the first time loadDomainUserIdCookie is called\n     * or when there is a new visit or a new page view\n     */\n    function setDomainUserIdCookie(\n      domainUserId: string,\n      createTs: number,\n      visitCount: number,\n      nowTs: number,\n      lastVisitTs: number,\n      sessionId: string\n    ) {\n      var cookieName = getSnowplowCookieName('id');\n      var cookieValue =\n        domainUserId + '.' + createTs + '.' + visitCount + '.' + nowTs + '.' + lastVisitTs + '.' + sessionId;\n      setCookie(cookieName, cookieValue, configVisitorCookieTimeout);\n    }\n\n    /*\n     * no-op if anonymousTracking enabled, will still set cookies if anonymousSessionTracking is enabled\n     * Sets a cookie based on the storage strategy:\n     * - if 'localStorage': attemps to write to local storage\n     * - if 'cookie' or 'cookieAndLocalStorage': writes to cookies\n     * - otherwise: no-op\n     */\n    function setCookie(name: string, value: string, timeout: number) {\n      if (configAnonymousTracking && !configAnonymousSessionTracking) {\n        return;\n      }\n\n      if (configStateStorageStrategy == 'localStorage') {\n        attemptWriteLocalStorage(name, value, timeout);\n      } else if (configStateStorageStrategy == 'cookie' || configStateStorageStrategy == 'cookieAndLocalStorage') {\n        cookie(name, value, timeout, configCookiePath, configCookieDomain, configCookieSameSite, configCookieSecure);\n      }\n    }\n\n    /**\n     * Clears all cookie and local storage for id and ses values\n     */\n    function clearUserDataAndCookies(configuration?: ClearUserDataConfiguration) {\n      const idname = getSnowplowCookieName('id');\n      const sesname = getSnowplowCookieName('ses');\n      attemptDeleteLocalStorage(idname);\n      attemptDeleteLocalStorage(sesname);\n      deleteCookie(idname, configCookieDomain, configCookieSameSite, configCookieSecure);\n      deleteCookie(sesname, configCookieDomain, configCookieSameSite, configCookieSecure);\n      if (!configuration?.preserveSession) {\n        memorizedSessionId = uuid();\n        memorizedVisitCount = 0;\n      }\n      if (!configuration?.preserveUser) {\n        domainUserId = uuid();\n        businessUserId = null;\n      }\n    }\n\n    /**\n     * Toggle Anaonymous Tracking\n     */\n    function toggleAnonymousTracking(\n      configuration?: EnableAnonymousTrackingConfiguration | DisableAnonymousTrackingConfiguration\n    ) {\n      if (configuration && configuration.stateStorageStrategy) {\n        trackerConfiguration.stateStorageStrategy = configuration.stateStorageStrategy;\n        configStateStorageStrategy = getStateStorageStrategy(trackerConfiguration);\n      }\n\n      configAnonymousTracking = getAnonymousTracking(trackerConfiguration);\n      configAnonymousSessionTracking = getAnonymousSessionTracking(trackerConfiguration);\n      configAnonymousServerTracking = getAnonymousServerTracking(trackerConfiguration);\n\n      outQueue.setUseLocalStorage(\n        configStateStorageStrategy == 'localStorage' || configStateStorageStrategy == 'cookieAndLocalStorage'\n      );\n      outQueue.setAnonymousTracking(configAnonymousServerTracking);\n    }\n\n    /*\n     * Load the domain user ID and the session ID\n     * Set the cookies (if cookies are enabled)\n     */\n    function initializeIdsAndCookies() {\n      if (configAnonymousTracking && !configAnonymousSessionTracking) {\n        return;\n      }\n\n      var sesCookieSet = configStateStorageStrategy != 'none' && !!getSnowplowCookieValue('ses');\n      var idCookieComponents = loadDomainUserIdCookie();\n\n      if (idCookieComponents[1]) {\n        domainUserId = idCookieComponents[1] as string;\n      } else if (!configAnonymousTracking) {\n        domainUserId = uuid();\n        idCookieComponents[1] = domainUserId;\n      } else {\n        domainUserId = '';\n        idCookieComponents[1] = domainUserId;\n      }\n\n      memorizedSessionId = idCookieComponents[6] as string;\n\n      if (!sesCookieSet) {\n        // Increment the session ID\n        (idCookieComponents[3] as number)++;\n        // Create a new sessionId\n        memorizedSessionId = uuid();\n        idCookieComponents[6] = memorizedSessionId;\n        // Set lastVisitTs to currentVisitTs\n        idCookieComponents[5] = idCookieComponents[4];\n      }\n\n      if (configStateStorageStrategy != 'none') {\n        setSessionCookie();\n        // Update currentVisitTs\n        idCookieComponents[4] = Math.round(new Date().getTime() / 1000);\n        idCookieComponents.shift();\n        setDomainUserIdCookie.apply(null, idCookieComponents as any); // TODO: Remove any\n      }\n    }\n\n    /*\n     * Load visitor ID cookie\n     */\n    function loadDomainUserIdCookie() {\n      if (configStateStorageStrategy == 'none') {\n        return [];\n      }\n      var now = new Date(),\n        nowTs = Math.round(now.getTime() / 1000),\n        id = getSnowplowCookieValue('id'),\n        tmpContainer;\n\n      if (id) {\n        tmpContainer = id.split('.');\n        // cookies enabled\n        tmpContainer.unshift('0');\n      } else {\n        tmpContainer = [\n          // cookies disabled\n          '1',\n          // Domain user ID\n          domainUserId,\n          // Creation timestamp - seconds since Unix epoch\n          nowTs,\n          // visitCount - 0 = no previous visit\n          0,\n          // Current visit timestamp\n          nowTs,\n          // Last visit timestamp - blank meaning no previous visit\n          '',\n        ];\n      }\n\n      if (!tmpContainer[6] || tmpContainer[6] === 'undefined') {\n        // session id\n        tmpContainer[6] = uuid();\n      }\n\n      return tmpContainer;\n    }\n\n    /*\n     * Attaches common web fields to every request (resolution, url, referrer, etc.)\n     * Also sets the required cookies.\n     */\n    function addBrowserData(payloadBuilder: PayloadBuilder) {\n      const anonymizeOr = (value?: string | number | null) => (configAnonymousTracking ? null : value);\n      const anonymizeSessionOr = (value?: string | number | null) =>\n        configAnonymousSessionTracking ? value : anonymizeOr(value);\n\n      var nowTs = Math.round(new Date().getTime() / 1000),\n        ses = getSnowplowCookieValue('ses'),\n        id = loadDomainUserIdCookie(),\n        cookiesDisabled = id[0],\n        _domainUserId = id[1] as string, // We could use the global (domainUserId) but this is better etiquette\n        createTs = id[2] as number,\n        visitCount = id[3] as number,\n        currentVisitTs = id[4] as number,\n        lastVisitTs = id[5] as number,\n        sessionIdFromCookie = id[6] as string;\n\n      var toOptoutByCookie;\n      if (configOptOutCookie) {\n        toOptoutByCookie = !!cookie(configOptOutCookie);\n      } else {\n        toOptoutByCookie = false;\n      }\n\n      if (configDoNotTrack || toOptoutByCookie) {\n        clearUserDataAndCookies();\n        return;\n      }\n\n      // If cookies are enabled, base visit count and session ID on the cookies\n      if (cookiesDisabled === '0') {\n        memorizedSessionId = sessionIdFromCookie as string;\n\n        // New session?\n        if (!ses && configStateStorageStrategy != 'none') {\n          // New session (aka new visit)\n          (visitCount as number)++;\n          // Update the last visit timestamp\n          lastVisitTs = currentVisitTs;\n          // Regenerate the session ID\n          memorizedSessionId = uuid();\n        }\n\n        memorizedVisitCount = visitCount as number;\n      } else if (new Date().getTime() - lastEventTime > configSessionCookieTimeout * 1000) {\n        memorizedSessionId = uuid();\n        memorizedVisitCount++;\n      }\n\n      payloadBuilder.add('vp', detectViewport());\n      payloadBuilder.add('ds', detectDocumentSize());\n      payloadBuilder.add('vid', anonymizeSessionOr(memorizedVisitCount));\n      payloadBuilder.add('sid', anonymizeSessionOr(memorizedSessionId));\n      payloadBuilder.add('duid', anonymizeOr(_domainUserId)); // Set to our local variable\n      payloadBuilder.add('uid', anonymizeOr(businessUserId));\n\n      refreshUrl();\n\n      payloadBuilder.add('refr', purify(customReferrer || configReferrerUrl));\n\n      // Add the page URL last as it may take us over the IE limit (and we don't always need it)\n      payloadBuilder.add('url', purify(configCustomUrl || locationHrefAlias));\n\n      // Update cookies\n      if (configStateStorageStrategy != 'none') {\n        setDomainUserIdCookie(_domainUserId, createTs, memorizedVisitCount, nowTs, lastVisitTs, memorizedSessionId);\n        setSessionCookie();\n      }\n\n      lastEventTime = new Date().getTime();\n    }\n\n    /**\n     * Adds the protocol in front of our collector URL\n     *\n     * @param string - collectorUrl The collector URL with or without protocol\n     * @returns string collectorUrl The tracker URL with protocol\n     */\n    function asCollectorUrl(collectorUrl: string) {\n      if (collectorUrl.indexOf('http') === 0) {\n        return collectorUrl;\n      }\n\n      return ('https:' === document.location.protocol ? 'https' : 'http') + '://' + collectorUrl;\n    }\n\n    /**\n     * Initialize new `pageViewId` if it shouldn't be preserved.\n     * Should be called when `trackPageView` is invoked\n     */\n    function resetPageView() {\n      if (!preservePageViewId || state.pageViewId == null) {\n        state.pageViewId = uuid();\n      }\n    }\n\n    /**\n     * Safe function to get `pageViewId`.\n     * Generates it if it wasn't initialized by other tracker\n     */\n    function getPageViewId() {\n      if (state.pageViewId == null) {\n        state.pageViewId = uuid();\n      }\n      return state.pageViewId;\n    }\n\n    /**\n     * Put together a web page context with a unique UUID for the page view\n     *\n     * @returns web_page context\n     */\n    function getWebPagePlugin() {\n      return {\n        contexts: () => {\n          return [\n            {\n              schema: 'iglu:com.snowplowanalytics.snowplow/web_page/jsonschema/1-0-0',\n              data: {\n                id: getPageViewId(),\n              },\n            },\n          ];\n        },\n      };\n    }\n\n    /**\n     * Expires current session and starts a new session.\n     */\n    function newSession() {\n      // If cookies are enabled, base visit count and session ID on the cookies\n      var nowTs = Math.round(new Date().getTime() / 1000),\n        id = loadDomainUserIdCookie(),\n        cookiesDisabled = id[0],\n        _domainUserId = id[1] as string, // We could use the global (domainUserId) but this is better etiquette\n        createTs = id[2] as number,\n        visitCount = id[3] as number,\n        currentVisitTs = id[4] as number,\n        lastVisitTs = id[5] as number,\n        sessionIdFromCookie = id[6] as string;\n\n      // When cookies are enabled\n      if (cookiesDisabled === '0') {\n        memorizedSessionId = sessionIdFromCookie;\n\n        // When cookie/local storage is enabled - make a new session\n        if (configStateStorageStrategy != 'none') {\n          // New session (aka new visit)\n          visitCount++;\n          // Update the last visit timestamp\n          lastVisitTs = currentVisitTs;\n          // Regenerate the session ID\n          memorizedSessionId = uuid();\n        }\n\n        memorizedVisitCount = visitCount;\n\n        // Create a new session cookie\n        setSessionCookie();\n      } else {\n        memorizedSessionId = uuid();\n        memorizedVisitCount++;\n      }\n\n      // Update cookies\n      if (configStateStorageStrategy != 'none') {\n        setDomainUserIdCookie(_domainUserId, createTs, memorizedVisitCount, nowTs, lastVisitTs, memorizedSessionId);\n        setSessionCookie();\n      }\n\n      lastEventTime = new Date().getTime();\n    }\n\n    /**\n     * Combine an array of unchanging contexts with the result of a context-creating function\n     *\n     * @param staticContexts - Array of custom contexts\n     * @param contextCallback - Function returning an array of contexts\n     */\n    function finalizeContexts(\n      staticContexts?: Array<SelfDescribingJson> | null,\n      contextCallback?: (() => Array<SelfDescribingJson>) | null\n    ) {\n      return (staticContexts || []).concat(contextCallback ? contextCallback() : []);\n    }\n\n    function logPageView({ title, context, timestamp, contextCallback }: PageViewEvent & CommonEventProperties) {\n      refreshUrl();\n      if (pageViewSent) {\n        // Do not reset pageViewId if previous events were not page_view\n        resetPageView();\n      }\n      pageViewSent = true;\n\n      // So we know what document.title was at the time of trackPageView\n      lastDocumentTitle = document.title;\n      lastConfigTitle = title;\n\n      // Fixup page title\n      var pageTitle = fixupTitle(lastConfigTitle || lastDocumentTitle);\n\n      // Log page view\n      core.track(\n        buildPageView({\n          pageUrl: purify(configCustomUrl || locationHrefAlias),\n          pageTitle,\n          referrer: purify(customReferrer || configReferrerUrl),\n        }),\n        finalizeContexts(context, contextCallback),\n        timestamp\n      );\n\n      // Send ping (to log that user has stayed on page)\n      var now = new Date();\n      var installingActivityTracking = false;\n\n      if (activityTrackingConfig.enabled && !activityTrackingConfig.installed) {\n        activityTrackingConfig.installed = true;\n        installingActivityTracking = true;\n\n        // Add mousewheel event handler, detect passive event listeners for performance\n        var detectPassiveEvents: { update: () => void; hasSupport?: boolean } = {\n          update: function update() {\n            if (typeof window !== 'undefined' && typeof window.addEventListener === 'function') {\n              var passive = false;\n              var options = Object.defineProperty({}, 'passive', {\n                get: function get() {\n                  passive = true;\n                },\n                set: function set() {},\n              });\n              // note: have to set and remove a no-op listener instead of null\n              // (which was used previously), becasue Edge v15 throws an error\n              // when providing a null callback.\n              // https://github.com/rafrex/detect-passive-events/pull/3\n              var noop = function noop() {};\n              window.addEventListener('testPassiveEventSupport', noop, options);\n              window.removeEventListener('testPassiveEventSupport', noop, options);\n              detectPassiveEvents.hasSupport = passive;\n            }\n          },\n        };\n        detectPassiveEvents.update();\n\n        // Detect available wheel event\n        var wheelEvent =\n          'onwheel' in document.createElement('div')\n            ? 'wheel' // Modern browsers support \"wheel\"\n            : (document as any).onmousewheel !== undefined\n            ? 'mousewheel' // Webkit and IE support at least \"mousewheel\"\n            : 'DOMMouseScroll'; // let's assume that remaining browsers are older Firefox\n\n        if (Object.prototype.hasOwnProperty.call(detectPassiveEvents, 'hasSupport')) {\n          addEventListener(document, wheelEvent, activityHandler, { passive: true });\n        } else {\n          addEventListener(document, wheelEvent, activityHandler);\n        }\n\n        // Capture our initial scroll points\n        resetMaxScrolls();\n\n        // Add event handlers; cross-browser compatibility here varies significantly\n        // @see http://quirksmode.org/dom/events\n        const documentHandlers = ['click', 'mouseup', 'mousedown', 'mousemove', 'keypress', 'keydown', 'keyup'];\n        const windowHandlers = ['resize', 'focus', 'blur'];\n        const listener =\n          (_: Document | Window, handler = activityHandler) =>\n          (ev: string) =>\n            addEventListener(document, ev, handler);\n\n        documentHandlers.forEach(listener(document));\n        windowHandlers.forEach(listener(window));\n        listener(window, scrollHandler)('scroll');\n      }\n\n      if (activityTrackingConfig.enabled && (resetActivityTrackingOnPageView || installingActivityTracking)) {\n        // Periodic check for activity.\n        lastActivityTime = now.getTime();\n\n        let key: keyof ActivityConfigurations;\n        for (key in activityTrackingConfig.configurations) {\n          const config = activityTrackingConfig.configurations[key];\n          if (config) {\n            //Clear page ping heartbeat on new page view\n            window.clearInterval(config.activityInterval);\n\n            activityInterval(config, context, contextCallback);\n          }\n        }\n      }\n    }\n\n    function activityInterval(\n      config: ActivityConfig,\n      context?: Array<SelfDescribingJson> | null,\n      contextCallback?: (() => Array<SelfDescribingJson>) | null\n    ) {\n      const executePagePing = (cb: ActivityCallback, c: Array<SelfDescribingJson>) => {\n        refreshUrl();\n        cb({ context: c, pageViewId: getPageViewId(), minXOffset, minYOffset, maxXOffset, maxYOffset });\n        resetMaxScrolls();\n      };\n\n      const timeout = () => {\n        var now = new Date();\n\n        // There was activity during the heart beat period;\n        // on average, this is going to overstate the visitDuration by configHeartBeatTimer/2\n        if (lastActivityTime + config.configMinimumVisitLength > now.getTime()) {\n          executePagePing(config.callback, finalizeContexts(context, contextCallback));\n        }\n\n        config.activityInterval = window.setInterval(heartbeat, config.configHeartBeatTimer);\n      };\n\n      const heartbeat = () => {\n        var now = new Date();\n\n        // There was activity during the heart beat period;\n        // on average, this is going to overstate the visitDuration by configHeartBeatTimer/2\n        if (lastActivityTime + config.configHeartBeatTimer > now.getTime()) {\n          executePagePing(config.callback, finalizeContexts(context, contextCallback));\n        }\n      };\n\n      if (config.configMinimumVisitLength != 0) {\n        config.activityInterval = window.setTimeout(timeout, config.configMinimumVisitLength);\n      } else {\n        config.activityInterval = window.setInterval(heartbeat, config.configHeartBeatTimer);\n      }\n    }\n\n    /**\n     * Configure the activity tracking and ensures integer values for min visit and heartbeat\n     */\n    function configureActivityTracking(\n      configuration: ActivityTrackingConfiguration & ActivityTrackingConfigurationCallback\n    ): ActivityConfig | undefined {\n      const { minimumVisitLength, heartbeatDelay, callback } = configuration;\n      if (isInteger(minimumVisitLength) && isInteger(heartbeatDelay)) {\n        return {\n          configMinimumVisitLength: minimumVisitLength * 1000,\n          configHeartBeatTimer: heartbeatDelay * 1000,\n          callback,\n        };\n      }\n\n      LOG.error('Activity tracking minimumVisitLength & heartbeatDelay must be integers');\n      return undefined;\n    }\n\n    /**\n     * Log that a user is still viewing a given page by sending a page ping.\n     * Not part of the public API - only called from logPageView() above.\n     */\n    function logPagePing({ context, minXOffset, minYOffset, maxXOffset, maxYOffset }: ActivityCallbackData) {\n      var newDocumentTitle = document.title;\n      if (newDocumentTitle !== lastDocumentTitle) {\n        lastDocumentTitle = newDocumentTitle;\n        lastConfigTitle = undefined;\n      }\n      core.track(\n        buildPagePing({\n          pageUrl: purify(configCustomUrl || locationHrefAlias),\n          pageTitle: fixupTitle(lastConfigTitle || lastDocumentTitle),\n          referrer: purify(customReferrer || configReferrerUrl),\n          minXOffset: cleanOffset(minXOffset),\n          maxXOffset: cleanOffset(maxXOffset),\n          minYOffset: cleanOffset(minYOffset),\n          maxYOffset: cleanOffset(maxYOffset),\n        }),\n        context\n      );\n    }\n\n    const apiMethods = {\n      getDomainSessionIndex: function () {\n        return memorizedVisitCount;\n      },\n\n      getPageViewId: function () {\n        return getPageViewId();\n      },\n\n      newSession: newSession,\n\n      getCookieName: function (basename: string) {\n        return getSnowplowCookieName(basename);\n      },\n\n      getUserId: function () {\n        return businessUserId;\n      },\n\n      getDomainUserId: function () {\n        return loadDomainUserIdCookie()[1];\n      },\n\n      getDomainUserInfo: function () {\n        return loadDomainUserIdCookie();\n      },\n\n      setReferrerUrl: function (url: string) {\n        customReferrer = url;\n      },\n\n      setCustomUrl: function (url: string) {\n        refreshUrl();\n        configCustomUrl = resolveRelativeReference(locationHrefAlias, url);\n      },\n\n      setDocumentTitle: function (title: string) {\n        // So we know what document.title was at the time of trackPageView\n        lastDocumentTitle = document.title;\n        lastConfigTitle = title;\n      },\n\n      discardHashTag: function (enableFilter: boolean) {\n        configDiscardHashTag = enableFilter;\n      },\n\n      discardBrace: function (enableFilter: boolean) {\n        configDiscardBrace = enableFilter;\n      },\n\n      setCookiePath: function (path: string) {\n        configCookiePath = path;\n        updateDomainHash();\n      },\n\n      setVisitorCookieTimeout: function (timeout: number) {\n        configVisitorCookieTimeout = timeout;\n      },\n\n      crossDomainLinker: function (crossDomainLinkerCriterion: (elt: HTMLAnchorElement | HTMLAreaElement) => boolean) {\n        decorateLinks(crossDomainLinkerCriterion);\n      },\n\n      enableActivityTracking: function (configuration: ActivityTrackingConfiguration) {\n        if (!activityTrackingConfig.configurations.pagePing) {\n          activityTrackingConfig.enabled = true;\n          activityTrackingConfig.configurations.pagePing = configureActivityTracking({\n            ...configuration,\n            callback: logPagePing,\n          });\n        }\n      },\n\n      enableActivityTrackingCallback: function (\n        configuration: ActivityTrackingConfiguration & ActivityTrackingConfigurationCallback\n      ) {\n        if (!activityTrackingConfig.configurations.callback) {\n          activityTrackingConfig.enabled = true;\n          activityTrackingConfig.configurations.callback = configureActivityTracking(configuration);\n        }\n      },\n\n      updatePageActivity: function () {\n        activityHandler();\n      },\n\n      setOptOutCookie: function (name?: string | null) {\n        configOptOutCookie = name;\n      },\n\n      setUserId: function (userId?: string | null) {\n        businessUserId = userId;\n      },\n\n      setUserIdFromLocation: function (querystringField: string) {\n        refreshUrl();\n        businessUserId = fromQuerystring(querystringField, locationHrefAlias);\n      },\n\n      setUserIdFromReferrer: function (querystringField: string) {\n        refreshUrl();\n        businessUserId = fromQuerystring(querystringField, configReferrerUrl);\n      },\n\n      setUserIdFromCookie: function (cookieName: string) {\n        businessUserId = cookie(cookieName);\n      },\n\n      setCollectorUrl: function (collectorUrl: string) {\n        configCollectorUrl = asCollectorUrl(collectorUrl);\n        outQueue.setCollectorUrl(configCollectorUrl);\n      },\n\n      setBufferSize: function (newBufferSize: number) {\n        outQueue.setBufferSize(newBufferSize);\n      },\n\n      flushBuffer: function (configuration: FlushBufferConfiguration = {}) {\n        outQueue.executeQueue();\n        if (configuration.newBufferSize) {\n          outQueue.setBufferSize(configuration.newBufferSize);\n        }\n      },\n\n      trackPageView: function (event: PageViewEvent & CommonEventProperties = {}) {\n        logPageView(event);\n      },\n\n      preservePageViewId: function () {\n        preservePageViewId = true;\n      },\n\n      disableAnonymousTracking: function (configuration?: DisableAnonymousTrackingConfiguration) {\n        trackerConfiguration.anonymousTracking = false;\n\n        toggleAnonymousTracking(configuration);\n\n        initializeIdsAndCookies();\n\n        outQueue.executeQueue(); // There might be some events in the queue we've been unable to send in anonymous mode\n      },\n\n      enableAnonymousTracking: function (configuration?: EnableAnonymousTrackingConfiguration) {\n        trackerConfiguration.anonymousTracking = (configuration && configuration?.options) ?? true;\n\n        toggleAnonymousTracking(configuration);\n\n        // Reset the page view, if not tracking the session, so can't stitch user into new events on the page view id\n        if (!configAnonymousSessionTracking) {\n          resetPageView();\n        }\n      },\n\n      clearUserData: clearUserDataAndCookies,\n    };\n\n    return {\n      ...apiMethods,\n      id: trackerId,\n      namespace,\n      core: core,\n      sharedState: state,\n    };\n  };\n\n  // Initialise the tracker\n  const partialTracker = newTracker(trackerId, namespace, version, endpoint, sharedState, trackerConfiguration),\n    tracker = {\n      ...partialTracker,\n      addPlugin: (configuration: BrowserPluginConfiguration) => {\n        tracker.core.addPlugin(configuration);\n        configuration.plugin.activateBrowserPlugin?.(tracker);\n      },\n    };\n\n  // Initialise each plugin with the tracker\n  trackerConfiguration.plugins?.forEach((p) => {\n    p.activateBrowserPlugin?.(tracker);\n  });\n\n  return tracker;\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { LOG } from '@snowplow/tracker-core';\nimport { SharedState } from './state';\nimport { Tracker } from './tracker';\nimport { BrowserTracker, TrackerConfiguration } from './tracker/types';\n\nconst namedTrackers: Record<string, BrowserTracker> = {};\n\n/**\n * Dispatch function to all specified trackers\n *\n * @param trackers - An optional list of trackers to send the event to, or will send to all trackers\n * @param fn - The function which will run against each tracker\n */\nexport function dispatchToTrackers(trackers: Array<string> | undefined, fn: (t: BrowserTracker) => void) {\n  try {\n    getTrackers(trackers ?? allTrackerNames()).forEach(fn);\n  } catch (ex) {\n    LOG.error('Function failed', ex);\n  }\n}\n\n/**\n * Dispatch function to all specified trackers from the supplied collection\n *\n * @param trackers - An optional list of trackers to send the event to, or will send to all trackers\n * @param trackerCollection - The collection which the trackers will be selected from\n * @param fn - The function which will run against each tracker\n */\nexport function dispatchToTrackersInCollection(\n  trackers: Array<string> | undefined,\n  trackerCollection: Record<string, BrowserTracker>,\n  fn: (t: BrowserTracker) => void\n) {\n  try {\n    getTrackersFromCollection(trackers ?? Object.keys(trackerCollection), trackerCollection).forEach(fn);\n  } catch (ex) {\n    LOG.error('Function failed', ex);\n  }\n}\n\n/**\n * Checks if a tracker has been created for a particular identifier\n * @param trackerId - The unique identifier of the tracker\n */\nexport function trackerExists(trackerId: string) {\n  return namedTrackers.hasOwnProperty(trackerId);\n}\n\n/**\n * Creates a Tracker and adds it to the internal collection\n * @param trackerId - The unique identifier of the tracker\n * @param namespace - The namespace of the tracker, tracked with each event as `tna`\n * @param version - The current version of the tracker library\n * @param endpoint - The endpoint to send events to\n * @param sharedState - The instance of shared state to use for this tracker\n * @param configuration - The configuration to use for this tracker instance\n */\nexport function addTracker(\n  trackerId: string,\n  namespace: string,\n  version: string,\n  endpoint: string,\n  sharedState: SharedState,\n  configuration?: TrackerConfiguration\n) {\n  if (!namedTrackers.hasOwnProperty(trackerId)) {\n    namedTrackers[trackerId] = Tracker(trackerId, namespace, version, endpoint, sharedState, configuration);\n    return namedTrackers[trackerId];\n  }\n  return null;\n}\n\n/**\n * Gets a single instance of the internal tracker object\n * @param trackerId - The unique identifier of the tracker\n * @returns The tracker instance, or null if not found\n */\nexport function getTracker(trackerId: string) {\n  if (namedTrackers.hasOwnProperty(trackerId)) {\n    return namedTrackers[trackerId];\n  }\n\n  LOG.warn(trackerId + ' not configured');\n  return null;\n}\n\n/**\n * Gets an array of tracker instances based on the list of identifiers\n * @param trackerIds - An array of unique identifiers of the trackers\n * @returns The tracker instances, or empty list if none found\n */\nexport function getTrackers(trackerIds: Array<string>): Array<BrowserTracker> {\n  return getTrackersFromCollection(trackerIds, namedTrackers);\n}\n\n/**\n * Gets all the trackers as a object, keyed by their unique identifiers\n */\nexport function allTrackers() {\n  return namedTrackers;\n}\n\n/**\n * Returns all the unique tracker identifiers\n */\nexport function allTrackerNames() {\n  return Object.keys(namedTrackers);\n}\n\nfunction getTrackersFromCollection(\n  trackerIds: Array<string>,\n  trackerCollection: Record<string, BrowserTracker>\n): Array<BrowserTracker> {\n  const trackers: Array<BrowserTracker> = [];\n  for (const id of trackerIds) {\n    if (trackerCollection.hasOwnProperty(id)) {\n      trackers.push(trackerCollection[id]);\n    } else {\n      LOG.warn(id + ' not configured');\n    }\n  }\n  return trackers;\n}\n","/*\n * Copyright (c) 2021 Snowplow Analytics Ltd, 2010 Anthon Pang\n * All rights reserved.\n *\n * Redistribution and use in source and binary forms, with or without\n * modification, are permitted provided that the following conditions are met:\n *\n * 1. Redistributions of source code must retain the above copyright notice, this\n *    list of conditions and the following disclaimer.\n *\n * 2. Redistributions in binary form must reproduce the above copyright notice,\n *    this list of conditions and the following disclaimer in the documentation\n *    and/or other materials provided with the distribution.\n *\n * 3. Neither the name of the copyright holder nor the names of its\n *    contributors may be used to endorse or promote products derived from\n *    this software without specific prior written permission.\n *\n * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\"\n * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\n * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\n * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE\n * FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n * DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR\n * SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER\n * CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,\n * OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\nimport { addEventListener } from './helpers';\n\ndeclare global {\n  interface Document {\n    attachEvent: (type: string, fn: EventListenerOrEventListenerObject) => void;\n    detachEvent: (type: string, fn: EventListenerOrEventListenerObject) => void;\n  }\n}\n\n/**\n * A set of variables which are shared among all initialised trackers\n */\nexport class SharedState {\n  /* List of request queues - one per Tracker instance */\n  outQueues: Array<unknown> = [];\n  bufferFlushers: Array<(sync: boolean) => void> = [];\n\n  /* DOM Ready */\n  hasLoaded: boolean = false;\n  registeredOnLoadHandlers: Array<() => void> = [];\n\n  /* pageViewId, which can changed by other trackers on page;\n   * initialized by tracker sent first event */\n  pageViewId?: string;\n}\n\nexport function createSharedState(): SharedState {\n  const sharedState = new SharedState(),\n    documentAlias = document,\n    windowAlias = window;\n\n  /*\n   * Handle page visibility event\n   * Works everywhere except IE9\n   */\n  function visibilityChangeHandler() {\n    if (documentAlias.visibilityState == 'hidden') {\n      // Flush all POST queues\n      sharedState.bufferFlushers.forEach(function (flusher) {\n        flusher(false);\n      });\n    }\n  }\n\n  function flushBuffers() {\n    // Flush all POST queues\n    sharedState.bufferFlushers.forEach(function (flusher) {\n      flusher(false);\n    });\n  }\n\n  /*\n   * Handler for onload event\n   */\n  function loadHandler() {\n    var i;\n\n    if (!sharedState.hasLoaded) {\n      sharedState.hasLoaded = true;\n      for (i = 0; i < sharedState.registeredOnLoadHandlers.length; i++) {\n        sharedState.registeredOnLoadHandlers[i]();\n      }\n    }\n    return true;\n  }\n\n  /*\n   * Add onload or DOM ready handler\n   */\n  function addReadyListener() {\n    if (documentAlias.addEventListener) {\n      documentAlias.addEventListener('DOMContentLoaded', function ready() {\n        documentAlias.removeEventListener('DOMContentLoaded', ready, false);\n        loadHandler();\n      });\n    } else if (documentAlias.attachEvent) {\n      documentAlias.attachEvent('onreadystatechange', function ready() {\n        if (documentAlias.readyState === 'complete') {\n          documentAlias.detachEvent('onreadystatechange', ready);\n          loadHandler();\n        }\n      });\n    }\n\n    // fallback\n    addEventListener(windowAlias, 'load', loadHandler, false);\n  }\n\n  /************************************************************\n   * Constructor\n   ************************************************************/\n\n  // initialize the Snowplow singleton\n  if (documentAlias.visibilityState) {\n    // Flush for mobile and modern browsers\n    addEventListener(documentAlias, 'visibilitychange', visibilityChangeHandler, false);\n  }\n  // Last attempt at flushing in beforeunload\n  addEventListener(windowAlias, 'beforeunload', flushBuffers, false);\n\n  if (document.readyState === 'loading') {\n    addReadyListener();\n  } else {\n    loadHandler();\n  }\n\n  return sharedState;\n}\n"],"names":["uuid"],"mappings":";;;;;;;;;;;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8BA;;;;;SAKgB,iBAAiB;IAC/B,IAAI;QACF,OAAO,CAAC,CAAC,MAAM,CAAC,cAAc,CAAC;KAChC;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,IAAI,CAAC;KACb;AACH,CAAC;AAED;;;;;SAKgB,eAAe;IAC7B,IAAI;QACF,OAAO,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC;KAC9B;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,IAAI,CAAC;KACb;AACH,CAAC;AAED;;;;;SAKgB,sBAAsB;IACpC,IAAI,GAAG,GAAG,WAAW,CAAC;IACtB,IAAI,CAAC,eAAe,EAAE,EAAE;QACtB,OAAO,KAAK,CAAC;KACd;IACD,IAAI;QACF,IAAM,EAAE,GAAG,MAAM,CAAC,YAAY,CAAC;QAC/B,EAAE,CAAC,OAAO,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;QACrB,EAAE,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QACnB,OAAO,IAAI,CAAC;KACb;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,KAAK,CAAC;KACd;AACH,CAAC;AAED;;;;;;;SAOgB,cAAc;IAC5B,IAAI,KAAK,EAAE,MAAM,CAAC;IAElB,IAAI,YAAY,IAAI,MAAM,EAAE;QAC1B,KAAK,GAAG,MAAM,CAAC,YAAY,CAAC,CAAC;QAC7B,MAAM,GAAG,MAAM,CAAC,aAAa,CAAC,CAAC;KAChC;SAAM;QACL,IAAM,CAAC,GAAG,QAAQ,CAAC,eAAe,IAAI,QAAQ,CAAC,IAAI,CAAC;QACpD,KAAK,GAAG,CAAC,CAAC,aAAa,CAAC,CAAC;QACzB,MAAM,GAAG,CAAC,CAAC,cAAc,CAAC,CAAC;KAC5B;IAED,IAAI,KAAK,IAAI,CAAC,IAAI,MAAM,IAAI,CAAC,EAAE;QAC7B,OAAO,KAAK,GAAG,GAAG,GAAG,MAAM,CAAC;KAC7B;SAAM;QACL,OAAO,IAAI,CAAC;KACb;AACH,CAAC;AAED;;;;;;;SAOgB,kBAAkB;IAChC,IAAI,EAAE,GAAG,QAAQ,CAAC,eAAe;IAC/B,EAAE,GAAG,QAAQ,CAAC,IAAI;;IAElB,UAAU,GAAG,EAAE,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,YAAY,EAAE,EAAE,CAAC,YAAY,CAAC,GAAG,CAAC,CAAC;IACnE,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,WAAW,EAAE,EAAE,CAAC,WAAW,EAAE,EAAE,CAAC,WAAW,CAAC,CAAC;IACjE,IAAI,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,YAAY,EAAE,EAAE,CAAC,YAAY,EAAE,EAAE,CAAC,YAAY,EAAE,UAAU,CAAC,CAAC;IAChF,OAAO,KAAK,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE,GAAG,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC;AACjD;;ACrHA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgDA;;;;SAIgB,QAAQ,CAAC,GAAW;IAClC,IAAI,GAAG,IAAI,OAAO,GAAG,CAAC,OAAO,EAAE,KAAK,QAAQ,EAAE;QAC5C,OAAO,IAAI,CAAC;KACb;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED;;;;SAIgB,SAAS,CAAC,GAAW;IACnC,QACE,CAAC,MAAM,CAAC,SAAS,IAAI,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,OAAO,GAAG,KAAK,QAAQ,IAAI,QAAQ,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,GAAG,CAAC,EACpH;AACJ,CAAC;AAED;;;;SAIgB,UAAU,CAAC,IAAa;IACtC,IAAI,IAAI,IAAI,OAAO,IAAI,KAAK,UAAU,EAAE;QACtC,OAAO,IAAI,CAAC;KACb;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED;;;SAGgB,UAAU,CAAC,KAAgC;IACzD,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,EAAE;QACpB,KAAK,GAAG,KAAK,CAAC,IAAI,IAAI,EAAE,CAAC;QAEzB,IAAI,GAAG,GAAG,QAAQ,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;QACjD,IAAI,GAAG,IAAI,GAAG,CAAC,CAAC,CAAC,IAAI,IAAI,EAAE;YACzB,KAAK,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;SACrB;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED;;;SAGgB,WAAW,CAAC,GAAW;;IAErC,IAAI,CAAC,GAAG,IAAI,MAAM,CAAC,4CAA4C,CAAC,EAC9D,OAAO,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAExB,OAAO,OAAO,GAAG,OAAO,CAAC,CAAC,CAAC,GAAG,GAAG,CAAC;AACpC,CAAC;AAED;;;SAGgB,WAAW,CAAC,MAAc;IACxC,IAAI,EAAE,GAAG,MAAM,CAAC,MAAM,CAAC;;IAGvB,IAAI,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,CAAC,KAAK,GAAG,EAAE;QAC/B,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC;KAC9B;;IAED,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,IAAI,EAAE;QAC/B,MAAM,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;KAC1B;IACD,OAAO,MAAM,CAAC;AAChB,CAAC;AAED;;;;;;;;;SASgB,WAAW,CAAC,WAAoB;IAC9C,IAAI,WAAW,GAAG,MAAM,EACtB,QAAQ,GAAG,EAAE,EACb,MAAM,GACJ,eAAe,CAAC,UAAU,EAAE,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,eAAe,CAAC,SAAS,EAAE,WAAW,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;;IAGpH,IAAI,MAAM,EAAE;QACV,OAAO,MAAM,CAAC;KACf;;IAGD,IAAI,WAAW,EAAE;QACf,OAAO,WAAW,CAAC;KACpB;IAED,IAAI;QACF,QAAQ,GAAG,WAAW,CAAC,GAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC;KAC9C;IAAC,OAAO,CAAC,EAAE;QACV,IAAI,WAAW,CAAC,MAAM,EAAE;YACtB,IAAI;gBACF,QAAQ,GAAG,WAAW,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;aACjD;YAAC,OAAO,EAAE,EAAE;gBACX,QAAQ,GAAG,EAAE,CAAC;aACf;SACF;KACF;IACD,IAAI,QAAQ,KAAK,EAAE,EAAE;QACnB,QAAQ,GAAG,QAAQ,CAAC,QAAQ,CAAC;KAC9B;IACD,OAAO,QAAQ,CAAC;AAClB,CAAC;AAED;;;SAGgB,gBAAgB,CAC9B,OAAkC,EAClC,SAAiB,EACjB,YAAgD,EAChD,OAA2C;IAE3C,IAAI,OAAO,CAAC,gBAAgB,EAAE;QAC5B,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,YAAY,EAAE,OAAO,CAAC,CAAC;QAC3D,OAAO,IAAI,CAAC;KACb;;IAGD,IAAI,OAAO,CAAC,WAAW,EAAE;QACvB,OAAO,OAAO,CAAC,WAAW,CAAC,IAAI,GAAG,SAAS,EAAE,YAAY,CAAC,CAAC;KAC5D;IACA,OAAe,CAAC,IAAI,GAAG,SAAS,CAAC,GAAG,YAAY,CAAC;AACpD,CAAC;AAED;;;SAGgB,eAAe,CAAC,KAAa,EAAE,GAAW;IACxD,IAAI,KAAK,GAAG,IAAI,MAAM,CAAC,YAAY,GAAG,KAAK,GAAG,WAAW,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACrE,IAAI,CAAC,KAAK,EAAE;QACV,OAAO,IAAI,CAAC;KACb;IACD,OAAO,kBAAkB,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC,CAAC;AAC1D,CAAC;AAED;;;;;;;SAOgB,mBAAmB,CAAC,GAAW,EAAE,IAAY,EAAE,KAAa;IAC1E,IAAI,eAAe,GAAG,IAAI,GAAG,GAAG,GAAG,KAAK,CAAC;IACzC,IAAI,SAAS,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAC/B,IAAI,OAAO,GAAG,SAAS,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IACtC,IAAI,iBAAiB,GAAG,OAAO,CAAC,KAAK,EAAE,CAAC;;IAExC,IAAI,WAAW,GAAG,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACpC,IAAI,CAAC,WAAW,EAAE;QAChB,WAAW,GAAG,eAAe,CAAC;KAC/B;SAAM;;QAEL,IAAI,iBAAiB,GAAG,IAAI,CAAC;QAC7B,IAAI,QAAQ,GAAG,WAAW,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;QACtC,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACxC,IAAI,QAAQ,CAAC,CAAC,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC,KAAK,IAAI,GAAG,GAAG,EAAE;gBACzD,iBAAiB,GAAG,KAAK,CAAC;gBAC1B,QAAQ,CAAC,CAAC,CAAC,GAAG,eAAe,CAAC;gBAC9B,WAAW,GAAG,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;gBACjC,MAAM;aACP;SACF;QACD,IAAI,iBAAiB,EAAE;YACrB,WAAW,GAAG,eAAe,GAAG,GAAG,GAAG,WAAW,CAAC;SACnD;KACF;IACD,SAAS,CAAC,CAAC,CAAC,GAAG,iBAAiB,GAAG,GAAG,GAAG,WAAW,CAAC;IACrD,OAAO,SAAS,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;AAC7B,CAAC;AAED;;;;;;;SAOgB,sBAAsB,CAAC,GAAW;IAChD,IAAI;QACF,IAAM,iBAAiB,GAAG,MAAM,CAAC,YAAY,EAC3C,GAAG,GAAG,iBAAiB,CAAC,OAAO,CAAC,GAAG,GAAG,UAAU,CAAC,CAAC;QACpD,IAAI,GAAG,KAAK,IAAI,IAAI,CAAC,GAAG,GAAG,IAAI,CAAC,GAAG,EAAE,EAAE;YACrC,OAAO,iBAAiB,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;SACvC;aAAM;YACL,iBAAiB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;YAClC,iBAAiB,CAAC,UAAU,CAAC,GAAG,GAAG,UAAU,CAAC,CAAC;SAChD;QACD,OAAO,SAAS,CAAC;KAClB;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,SAAS,CAAC;KAClB;AACH,CAAC;AAED;;;;;;;;SAQgB,wBAAwB,CAAC,GAAW,EAAE,KAAa,EAAE,GAAc;IAAd,oBAAA,EAAA,cAAc;IACjF,IAAI;QACF,IAAM,iBAAiB,GAAG,MAAM,CAAC,YAAY,EAC3C,CAAC,GAAG,IAAI,CAAC,GAAG,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC;QAC9B,iBAAiB,CAAC,OAAO,CAAI,GAAG,aAAU,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;QAC1D,iBAAiB,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;QACtC,OAAO,IAAI,CAAC;KACb;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,KAAK,CAAC;KACd;AACH,CAAC;AAED;;;;;;SAMgB,yBAAyB,CAAC,GAAW;IACnD,IAAI;QACF,IAAM,iBAAiB,GAAG,MAAM,CAAC,YAAY,CAAC;QAC9C,iBAAiB,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;QAClC,iBAAiB,CAAC,UAAU,CAAC,GAAG,GAAG,UAAU,CAAC,CAAC;QAC/C,OAAO,IAAI,CAAC;KACb;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,KAAK,CAAC;KACd;AACH,CAAC;AAED;;;;;;;SAOgB,wBAAwB,CAAC,GAAW;IAClD,IAAI;QACF,OAAO,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;KAC3C;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,SAAS,CAAC;KAClB;AACH,CAAC;AAED;;;;;;;SAOgB,0BAA0B,CAAC,GAAW,EAAE,KAAa;IACnE,IAAI;QACF,MAAM,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,EAAE,KAAK,CAAC,CAAC;QAC1C,OAAO,IAAI,CAAC;KACb;IAAC,OAAO,CAAC,EAAE;QACV,OAAO,KAAK,CAAC;KACd;AACH,CAAC;AAED;;;SAGgB,cAAc,CAAC,QAAgB,EAAE,MAAe;IAC9D,IAAM,2BAA2B,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAC1D,YAAY,GAAG,uBAAuB,EACtC,UAAU,GAAG,YAAY,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,EAChD,WAAW,GAAG,cAAc,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;IAEtD,IAAI,KAAK,GAAG,2BAA2B,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IACnD,IAAI,QAAQ,GAAG,KAAK,CAAC,MAAM,GAAG,CAAC,CAAC;IAChC,OAAO,QAAQ,IAAI,CAAC,EAAE;QACpB,IAAI,aAAa,GAAG,KAAK,CAAC,KAAK,CAAC,QAAQ,EAAE,KAAK,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAClE,MAAM,CAAC,UAAU,EAAE,WAAW,EAAE,CAAC,EAAE,GAAG,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;QACzE,IAAI,MAAM,CAAC,UAAU,CAAC,KAAK,WAAW,EAAE;;YAEtC,YAAY,CAAC,UAAU,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;YAC1D,IAAI,WAAW,GAAG,oBAAoB,CAAC,YAAY,CAAC,CAAC;YACrD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC3C,YAAY,CAAC,WAAW,CAAC,CAAC,CAAC,EAAE,aAAa,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;aAC/D;YAED,OAAO,aAAa,CAAC;SACtB;QACD,QAAQ,IAAI,CAAC,CAAC;KACf;;IAGD,OAAO,2BAA2B,CAAC;AACrC,CAAC;AAED;;;;;;;SAOgB,cAAc,CAAI,GAAM,EAAE,KAAU;IAClD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACrC,IAAI,KAAK,CAAC,CAAC,CAAC,KAAK,GAAG,EAAE;YACpB,OAAO,IAAI,CAAC;SACb;KACF;IACD,OAAO,KAAK,CAAC;AACf,CAAC;AAED;;;;;;SAMgB,YAAY,CAAC,UAAkB,EAAE,UAAmB,EAAE,QAAiB,EAAE,MAAgB;IACvG,MAAM,CAAC,UAAU,EAAE,EAAE,EAAE,CAAC,CAAC,EAAE,GAAG,EAAE,UAAU,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;AAChE,CAAC;AAED;;;;;;SAMgB,oBAAoB,CAAC,YAAoB;IACvD,IAAI,OAAO,GAAG,QAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC;IAC1C,IAAI,WAAW,GAAG,EAAE,CAAC;IACrB,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACvC,IAAI,OAAO,CAAC,CAAC,CAAC,CAAC,SAAS,CAAC,CAAC,EAAE,YAAY,CAAC,MAAM,CAAC,KAAK,YAAY,EAAE;YACjE,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;SAC9B;KACF;IACD,OAAO,WAAW,CAAC;AACrB,CAAC;AAED;;;;;;;;;;;;;SAagB,MAAM,CACpB,IAAY,EACZ,KAAc,EACd,GAAY,EACZ,IAAa,EACb,MAAe,EACf,QAAiB,EACjB,MAAgB;IAEhB,IAAI,SAAS,CAAC,MAAM,GAAG,CAAC,EAAE;QACxB,QAAQ,QAAQ,CAAC,MAAM;YACrB,IAAI;gBACJ,GAAG;gBACH,kBAAkB,CAAC,KAAK,aAAL,KAAK,cAAL,KAAK,GAAI,EAAE,CAAC;iBAC9B,GAAG,GAAG,YAAY,GAAG,IAAI,IAAI,CAAC,CAAC,IAAI,IAAI,EAAE,GAAG,GAAG,GAAG,IAAI,CAAC,CAAC,WAAW,EAAE,GAAG,EAAE,CAAC;iBAC3E,IAAI,GAAG,SAAS,GAAG,IAAI,GAAG,EAAE,CAAC;iBAC7B,MAAM,GAAG,WAAW,GAAG,MAAM,GAAG,EAAE,CAAC;iBACnC,QAAQ,GAAG,aAAa,GAAG,QAAQ,GAAG,EAAE,CAAC;iBACzC,MAAM,GAAG,UAAU,GAAG,EAAE,CAAC,EAAE;KAC/B;IAED,OAAO,kBAAkB,CAAC,CAAC,CAAC,IAAI,GAAG,QAAQ,CAAC,MAAM,EAAE,KAAK,CAAC,IAAI,GAAG,IAAI,GAAG,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,EAAE,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACxG,CAAC;AAED;;;;;;;SAOgB,mBAAmB,CAAC,GAAY;IAC9C,IAAI,MAAM,GAAG,QAAQ,CAAC,GAAa,CAAC,CAAC;IACrC,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,SAAS,GAAG,MAAM,CAAC;AAC5C,CAAC;AAED;;;;;;;SAOgB,qBAAqB,CAAC,GAAY;IAChD,IAAI,MAAM,GAAG,UAAU,CAAC,GAAa,CAAC,CAAC;IACvC,OAAO,KAAK,CAAC,MAAM,CAAC,GAAG,SAAS,GAAG,MAAM,CAAC;AAC5C,CAAC;AAED;;;;;;;;;SASgB,gBAAgB,CAAC,SAA+C;;IAE9E,IAAI,SAAS,IAAI,IAAI,IAAI,OAAO,SAAS,KAAK,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;QAClF,OAAO;YACL,OAAO,IAAI,CAAC;SACb,CAAC;KACH;IAED,IAAM,SAAS,GAAG,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;IAC/E,IAAM,mBAAmB,GAAG,sBAAsB,CAAC,SAAS,CAAC,CAAC;IAE9D,OAAO,SAAS,CAAC,SAAS,EAAE,UAAU,GAAgB;QACpD,OAAO,UAAU,CAAC,GAAG,EAAE,mBAAmB,CAAC,KAAK,SAAS,CAAC;KAC3D,CAAC,CAAC;AACL,CAAC;AAED;;;;;;;SAOgB,eAAe,CAA6B,SAA8B;;IAExF,IAAI,SAAS,IAAI,IAAI,IAAI,OAAO,SAAS,KAAK,QAAQ,IAAI,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE;QAClF,OAAO;YACL,OAAO,IAAI,CAAC;SACb,CAAC;KACH;IAED,IAAM,SAAS,GAAG,SAAS,CAAC,cAAc,CAAC,WAAW,CAAC,CAAC;IACxD,IAAM,mBAAmB,GAAG,sBAAsB,CAAC,SAAS,CAAC,CAAC;IAE9D,OAAO,SAAS,CAAC,SAAS,EAAE,UAAU,GAAM;QAC1C,OAAO,GAAG,CAAC,IAAI,IAAI,mBAAmB,KAAK,SAAS,CAAC;KACtD,CAAC,CAAC;AACL,CAAC;AAED;;;SAGgB,aAAa,CAAC,GAAY;IACxC,OAAO,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;AAC3C,CAAC;AAED;;;AAGA,SAAS,UAAU,CAAC,GAAY,EAAE,SAAkC;IAClE,IAAI,OAAO,GAAG,aAAa,CAAC,GAAG,CAAC,CAAC;IAEjC,KAAwB,UAAO,EAAP,mBAAO,EAAP,qBAAO,EAAP,IAAO,EAAE;QAA5B,IAAM,SAAS,gBAAA;QAClB,IAAI,SAAS,CAAC,SAAS,CAAC,EAAE;YACxB,OAAO,IAAI,CAAC;SACb;KACF;IAED,OAAO,KAAK,CAAC;AACf,CAAC;AAED,SAAS,SAAS,CAAI,SAA6B,EAAE,cAAmC;IACtF,IAAI,SAAS,CAAC,cAAc,CAAC,QAAQ,CAAC,IAAI,SAAS,CAAC,MAAM,EAAE;QAC1D,OAAO,SAAS,CAAC,MAAM,CAAC;KACzB;IAED,OAAO,cAAc,CAAC;AACxB,CAAC;AAED,SAAS,sBAAsB,CAAI,SAA6B;;IAE9D,IAAI,mBAAmB,GAA4B,EAAE,CAAC;IACtD,IAAI,gBAAgB,GAAG,SAAS,CAAC,SAAS,IAAI,SAAS,CAAC,QAAQ,CAAC;IAEjE,IAAI,gBAAgB,EAAE;QACpB,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,gBAAgB,CAAC,EAAE;YACpC,gBAAgB,GAAG,CAAC,gBAAgB,CAAC,CAAC;SACvC;QAED,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,gBAAgB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YAChD,mBAAmB,CAAC,gBAAgB,CAAC,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;SACjD;KACF;IAED,OAAO,mBAAmB,CAAC;AAC7B;;ACziBA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;;;;;;;;;;;;;;;;;SAiBgB,eAAe,CAC7B,EAAU,EACV,UAAuB,EACvB,eAAwB,EACxB,WAAoC,EACpC,QAAgB,EAChB,UAAkB,EAClB,YAAoB,EACpB,MAAe,EACf,wBAAgC,EAChC,iBAAyB,EACzB,iBAA0B;IAO1B,IAAI,cAAc,GAAG,KAAK,EACxB,kBAA0B,EAC1B,QAAQ,GAAqC,EAAE,CAAC;;IAGlD,WAAW,GAAG,OAAO,WAAW,KAAK,QAAQ,GAAG,WAAW,CAAC,WAAW,EAAE,GAAG,WAAW,CAAC;;IAGxF,IAAM,iBAAiB,GACnB,WAAW,KAAK,IAAI,IAAI,WAAW,KAAK,IAAI,IAAI,WAAW,KAAK,QAAQ,IAAI,WAAW,KAAK,MAAM;;IAEpG,iBAAiB,GAAG,OAAO,CACzB,iBAAiB;QACf,MAAM,CAAC,SAAS;QAChB,MAAM,CAAC,SAAS,CAAC,UAAU;QAC3B,CAAC,kBAAkB,CAAC,MAAM,CAAC,SAAS,CAAC,SAAS,CAAC,CAClD,EACD,SAAS,GAAG,iBAAiB,IAAI,iBAAiB;;IAElD,cAAc,GAAG,WAAW,KAAK,KAAK;;IAEtC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,cAAc,IAAI,iBAAiB,IAAI,IAAI,cAAc,EAAE,CAAC;;IAEpF,OAAO,GAAG,CAAC,cAAc,IAAI,MAAM,KAAK,WAAW,KAAK,MAAM,IAAI,iBAAiB,CAAC;;IAEpF,IAAI,GAAG,OAAO,GAAG,QAAQ,GAAG,IAAI;;IAEhC,SAAS,GAAG,sBAAoB,EAAE,UAAI,OAAO,GAAG,OAAO,GAAG,KAAK,CAAE,CAAC;;IAGpE,UAAU,GAAG,CAAC,eAAe,IAAI,sBAAsB,EAAE,IAAI,OAAO,IAAI,UAAU,KAAK,CAAC,CAAC;IAEzF,IAAI,eAAe,EAAE;;QAEnB,IAAI;YACF,IAAM,iBAAiB,GAAG,MAAM,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;YACjE,QAAQ,GAAG,iBAAiB,GAAG,IAAI,CAAC,KAAK,CAAC,iBAAiB,CAAC,GAAG,EAAE,CAAC;SACnE;QAAC,OAAO,CAAC,EAAE,GAAE;KACf;;IAGD,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;QAC5B,QAAQ,GAAG,EAAE,CAAC;KACf;;IAGD,UAAU,CAAC,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAEpC,IAAI,MAAM,IAAI,UAAU,GAAG,CAAC,EAAE;QAC5B,UAAU,CAAC,cAAc,CAAC,IAAI,CAAC,UAAU,IAAI;YAC3C,IAAI,CAAC,cAAc,EAAE;gBACnB,YAAY,CAAC,IAAI,CAAC,CAAC;aACpB;SACF,CAAC,CAAC;KACJ;;;;;IAMD,SAAS,cAAc,CAAC,OAAgB;QACtC,IAAI,WAAW,GAAG,GAAG,EACnB,eAAe,GAAG,EAAE,EAAE,EAAE,IAAI,EAAE,EAAE,EAAE,IAAI,EAAE,EACxC,SAAS,GAAG,IAAI,CAAC;QAEnB,KAAK,IAAM,GAAG,IAAI,OAAO,EAAE;YACzB,IAAI,OAAO,CAAC,cAAc,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC,cAAc,CAAC,GAAG,CAAC,EAAE;gBACvE,IAAI,CAAC,SAAS,EAAE;oBACd,WAAW,IAAI,GAAG,CAAC;iBACpB;qBAAM;oBACL,SAAS,GAAG,KAAK,CAAC;iBACnB;gBACD,WAAW,IAAI,kBAAkB,CAAC,GAAG,CAAC,GAAG,GAAG,GAAG,kBAAkB,CAAC,OAAO,CAAC,GAAG,CAA8B,CAAC,CAAC;aAC9G;SACF;QAED,KAAK,IAAM,UAAU,IAAI,eAAe,EAAE;YACxC,IAAI,OAAO,CAAC,cAAc,CAAC,UAAU,CAAC,IAAI,eAAe,CAAC,cAAc,CAAC,UAAU,CAAC,EAAE;gBACpF,WAAW,IAAI,GAAG,GAAG,UAAU,GAAG,GAAG,GAAG,kBAAkB,CAAC,OAAO,CAAC,UAAU,CAA8B,CAAC,CAAC;aAC9G;SACF;QAED,OAAO,WAAW,CAAC;KACpB;;;;IAKD,SAAS,OAAO,CAAC,OAAgB;QAC/B,IAAM,cAAc,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;aACxC,GAAG,CAAoB,UAAC,CAAC,IAAK,OAAA,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,GAAA,CAAC;aAC9C,MAAM,CAAC,UAAC,GAAG,EAAE,EAAY;gBAAX,GAAG,QAAA,EAAE,KAAK,QAAA;YACvB,GAAG,CAAC,GAAG,CAAC,GAAI,KAAgB,CAAC,QAAQ,EAAE,CAAC;YACxC,OAAO,GAAG,CAAC;SACZ,EAAE,EAA6B,CAAC,CAAC;QACpC,OAAO;YACL,GAAG,EAAE,cAAc;YACnB,KAAK,EAAE,aAAa,CAAC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC;SACrD,CAAC;KACH;;;;;;;;IASD,SAAS,aAAa,CAAC,CAAS;QAC9B,IAAI,GAAG,GAAG,CAAC,CAAC;QACZ,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACjC,IAAM,IAAI,GAAG,CAAC,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YAC7B,IAAI,IAAI,IAAI,IAAI,EAAE;gBAChB,GAAG,IAAI,CAAC,CAAC;aACV;iBAAM,IAAI,IAAI,IAAI,KAAK,EAAE;gBACxB,GAAG,IAAI,CAAC,CAAC;aACV;iBAAM,IAAI,IAAI,IAAI,MAAM,IAAI,IAAI,IAAI,MAAM,EAAE;;;gBAG3C,GAAG,IAAI,CAAC,CAAC;gBACT,CAAC,EAAE,CAAC;aACL;iBAAM,IAAI,IAAI,GAAG,MAAM,EAAE;gBACxB,GAAG,IAAI,CAAC,CAAC;aACV;iBAAM;gBACL,GAAG,IAAI,CAAC,CAAC;aACV;SACF;QACD,OAAO,GAAG,CAAC;KACZ;IAED,IAAM,QAAQ,GAAG,UAAC,KAAuC;QACvD,OAAO,OAAO,KAAK,CAAC,CAAC,CAAC,KAAK,QAAQ,CAAC;KACrC,CAAC;;;;IAKF,SAAS,cAAc,CAAC,OAAgB,EAAE,GAAW;QACnD,kBAAkB,GAAG,GAAG,GAAG,IAAI,CAAC;QAChC,IAAI,OAAO,EAAE;YACX,IAAM,IAAI,GAAG,OAAO,CAAC,OAAO,CAAC,CAAC;YAC9B,IAAI,IAAI,CAAC,KAAK,IAAI,YAAY,EAAE;gBAC9B,GAAG,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,KAAK,GAAG,qBAAqB,GAAG,YAAY,CAAC,CAAC;gBACxE,IAAM,GAAG,GAAG,wBAAwB,CAAC,kBAAkB,EAAE,IAAI,EAAE,KAAK,CAAC,CAAC;gBACtE,GAAG,CAAC,IAAI,CAAC,4BAA4B,CAAC,gBAAgB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;gBACrE,OAAO;aACR;iBAAM;gBACJ,QAA6B,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;aAC3C;SACF;aAAM;YACJ,QAA0B,CAAC,IAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,CAAC;SAC3D;QACD,IAAI,mBAAmB,GAAG,KAAK,CAAC;QAChC,IAAI,eAAe,EAAE;YACnB,mBAAmB,GAAG,wBAAwB,CAC5C,SAAS,EACT,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,wBAAwB,CAAC,CAAC,CAC5D,CAAC;SACH;;QAGD,IAAI,CAAC,cAAc,KAAK,CAAC,mBAAmB,IAAI,QAAQ,CAAC,MAAM,IAAI,UAAU,CAAC,EAAE;YAC9E,YAAY,EAAE,CAAC;SAChB;KACF;;;;;IAMD,SAAS,YAAY,CAAC,IAAqB;QAArB,qBAAA,EAAA,YAAqB;;QAEzC,OAAO,QAAQ,CAAC,MAAM,IAAI,OAAO,QAAQ,CAAC,CAAC,CAAC,KAAK,QAAQ,IAAI,OAAO,QAAQ,CAAC,CAAC,CAAC,KAAK,QAAQ,EAAE;YAC5F,QAAQ,CAAC,KAAK,EAAE,CAAC;SAClB;QAED,IAAI,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE;YACvB,cAAc,GAAG,KAAK,CAAC;YACvB,OAAO;SACR;;QAGD,IAAI,CAAC,QAAQ,CAAC,kBAAkB,CAAC,EAAE;YACjC,MAAM,yBAAyB,CAAC;SACjC;QAED,cAAc,GAAG,IAAI,CAAC;QAEtB,IAAI,MAAM,EAAE;;YAEV,IAAM,mBAAmB,GAAG,UAAC,KAA+B;gBAC1D,IAAI,YAAY,GAAG,CAAC,EAClB,SAAS,GAAG,CAAC,CAAC;gBAChB,OAAO,YAAY,GAAG,KAAK,CAAC,MAAM,EAAE;oBAClC,SAAS,IAAI,KAAK,CAAC,YAAY,CAAC,CAAC,KAAK,CAAC;oBACvC,IAAI,SAAS,IAAI,YAAY,EAAE;wBAC7B,MAAM;qBACP;yBAAM;wBACL,YAAY,IAAI,CAAC,CAAC;qBACnB;iBACF;gBACD,OAAO,YAAY,CAAC;aACrB,CAAC;YAEF,IAAI,GAAG,SAAQ,EAAE,KAAmB,EAAE,cAAoB,CAAC;YAC3D,IAAI,QAAQ,CAAC,QAAQ,CAAC,EAAE;gBACtB,GAAG,GAAG,kBAAkB,CAAC;gBACzB,KAAG,GAAG,wBAAwB,CAAC,GAAG,EAAE,IAAI,EAAE,IAAI,CAAC,CAAC;gBAChD,cAAY,GAAG,mBAAmB,CAAC,QAAQ,CAAC,CAAC;aAC9C;iBAAM;gBACL,GAAG,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;gBAChC,KAAG,GAAG,wBAAwB,CAAC,GAAG,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;gBACjD,cAAY,GAAG,CAAC,CAAC;aAClB;;YAGD,IAAM,YAAU,GAAG,UAAU,CAAC;gBAC5B,KAAG,CAAC,KAAK,EAAE,CAAC;gBACZ,cAAc,GAAG,KAAK,CAAC;aACxB,EAAE,iBAAiB,CAAC,CAAC;;;YAItB,IAAM,eAAa,GAAG,UAAC,YAAoB;gBACzC,KAAK,IAAI,WAAW,GAAG,CAAC,EAAE,WAAW,GAAG,YAAY,EAAE,WAAW,EAAE,EAAE;oBACnE,QAAQ,CAAC,KAAK,EAAE,CAAC;iBAClB;gBACD,IAAI,eAAe,EAAE;oBACnB,wBAAwB,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,wBAAwB,CAAC,CAAC,CAAC,CAAC;iBAClG;gBACD,YAAY,EAAE,CAAC;aAChB,CAAC;YAEF,KAAG,CAAC,kBAAkB,GAAG;gBACvB,IAAI,KAAG,CAAC,UAAU,KAAK,CAAC,IAAI,KAAG,CAAC,MAAM,IAAI,GAAG,IAAI,KAAG,CAAC,MAAM,GAAG,GAAG,EAAE;oBACjE,YAAY,CAAC,YAAU,CAAC,CAAC;oBACzB,eAAa,CAAC,cAAY,CAAC,CAAC;iBAC7B;qBAAM,IAAI,KAAG,CAAC,UAAU,KAAK,CAAC,IAAI,KAAG,CAAC,MAAM,IAAI,GAAG,EAAE;oBACpD,YAAY,CAAC,YAAU,CAAC,CAAC;oBACzB,cAAc,GAAG,KAAK,CAAC;iBACxB;aACF,CAAC;YAEF,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;;gBAEvB,KAAG,CAAC,IAAI,EAAE,CAAC;aACZ;iBAAM;gBACL,IAAI,KAAK,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,cAAY,CAAC,CAAC;gBAE5C,IAAI,KAAK,CAAC,MAAM,GAAG,CAAC,EAAE;oBACpB,IAAI,YAAY,GAAG,KAAK,CAAC;oBAEzB,IAAM,UAAU,GAAG,KAAK,CAAC,GAAG,CAAC,UAAU,CAAC;wBACtC,OAAO,CAAC,CAAC,GAAG,CAAC;qBACd,CAAC,CAAC;oBAEH,IAAI,SAAS,EAAE;wBACb,IAAM,IAAI,GAAG,IAAI,IAAI,CAAC,CAAC,4BAA4B,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;4BAClF,IAAI,EAAE,kBAAkB;yBACzB,CAAC,CAAC;wBACH,IAAI;4BACF,YAAY,GAAG,SAAS,CAAC,UAAU,CAAC,GAAG,EAAE,IAAI,CAAC,CAAC;yBAChD;wBAAC,OAAO,KAAK,EAAE;4BACd,YAAY,GAAG,KAAK,CAAC;yBACtB;qBACF;;;oBAID,IAAI,YAAY,KAAK,IAAI,EAAE;wBACzB,eAAa,CAAC,cAAY,CAAC,CAAC;qBAC7B;yBAAM;wBACL,KAAG,CAAC,IAAI,CAAC,4BAA4B,CAAC,gBAAgB,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;qBACtE;iBACF;aACF;SACF;aAAM,IAAI,CAAC,iBAAiB,IAAI,CAAC,QAAQ,CAAC,QAAQ,CAAC,EAAE;;YAEpD,IAAI,KAAK,GAAG,IAAI,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,EACzB,SAAO,GAAG,IAAI,CAAC;YAEjB,KAAK,CAAC,MAAM,GAAG;gBACb,IAAI,CAAC,SAAO;oBAAE,OAAO;gBACrB,SAAO,GAAG,KAAK,CAAC;gBAChB,QAAQ,CAAC,KAAK,EAAE,CAAC;gBACjB,IAAI,eAAe,EAAE;oBACnB,wBAAwB,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC,EAAE,wBAAwB,CAAC,CAAC,CAAC,CAAC;iBAClG;gBACD,YAAY,EAAE,CAAC;aAChB,CAAC;YAEF,KAAK,CAAC,OAAO,GAAG;gBACd,IAAI,CAAC,SAAO;oBAAE,OAAO;gBACrB,SAAO,GAAG,KAAK,CAAC;gBAChB,cAAc,GAAG,KAAK,CAAC;aACxB,CAAC;YAEF,KAAK,CAAC,GAAG,GAAG,YAAY,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;YAEtC,UAAU,CAAC;gBACT,IAAI,SAAO,IAAI,cAAc,EAAE;oBAC7B,SAAO,GAAG,KAAK,CAAC;oBAChB,YAAY,EAAE,CAAC;iBAChB;aACF,EAAE,iBAAiB,CAAC,CAAC;SACvB;aAAM;YACL,cAAc,GAAG,KAAK,CAAC;SACxB;KACF;;;;;;;IAQD,SAAS,wBAAwB,CAAC,GAAW,EAAE,IAAa,EAAE,IAAa;QACzE,IAAM,GAAG,GAAG,IAAI,cAAc,EAAE,CAAC;QACjC,IAAI,IAAI,EAAE;YACR,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;YAC7B,GAAG,CAAC,gBAAgB,CAAC,cAAc,EAAE,iCAAiC,CAAC,CAAC;SACzE;aAAM;YACL,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,EAAE,CAAC,IAAI,CAAC,CAAC;SAC7B;QACD,GAAG,CAAC,eAAe,GAAG,IAAI,CAAC;QAC3B,IAAI,iBAAiB,EAAE;YACrB,GAAG,CAAC,gBAAgB,CAAC,cAAc,EAAE,GAAG,CAAC,CAAC;SAC3C;QACD,OAAO,GAAG,CAAC;KACZ;;;;;;;IAQD,SAAS,4BAA4B,CAAC,MAAsC;QAC1E,OAAO,IAAI,CAAC,SAAS,CAAC;YACpB,MAAM,EAAE,mEAAmE;YAC3E,IAAI,EAAE,MAAM;SACb,CAAC,CAAC;KACJ;;;;;;IAOD,SAAS,gBAAgB,CAAC,MAAsC;QAC9D,IAAM,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC;QAC5C,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,MAAM,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;YACtC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,GAAG,GAAG,CAAC;SACxB;QACD,OAAO,MAAM,CAAC;KACf;;;;;;IAOD,SAAS,YAAY,CAAC,WAAmB;QACvC,IAAI,MAAM,EAAE;YACV,OAAO,kBAAkB,GAAG,WAAW,CAAC,OAAO,CAAC,GAAG,EAAE,OAAO,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,GAAG,CAAC,CAAC;SAC5F;QAED,OAAO,kBAAkB,GAAG,WAAW,CAAC;KACzC;IAED,OAAO;QACL,cAAc,EAAE,cAAc;QAC9B,YAAY,EAAE;YACZ,IAAI,CAAC,cAAc,EAAE;gBACnB,YAAY,EAAE,CAAC;aAChB;SACF;QACD,kBAAkB,EAAE,UAAC,YAAqB;YACxC,eAAe,GAAG,YAAY,CAAC;SAChC;QACD,oBAAoB,EAAE,UAAC,SAAkB;YACvC,iBAAiB,GAAG,SAAS,CAAC;SAC/B;QACD,eAAe,EAAE,UAAC,GAAW;YAC3B,kBAAkB,GAAG,GAAG,GAAG,IAAI,CAAC;SACjC;QACD,aAAa,EAAE,UAAC,aAAqB;YACnC,UAAU,GAAG,aAAa,CAAC;SAC5B;KACF,CAAC;IAEF,SAAS,kBAAkB,CAAC,SAAiB;QAC3C,QACE,6BAA6B,CAAC,EAAE,EAAE,SAAS,CAAC;aAC3C,gCAAgC,CAAC,EAAE,EAAE,EAAE,EAAE,SAAS,CAAC,IAAI,QAAQ,CAAC,SAAS,CAAC,CAAC,EAC5E;QAEF,SAAS,6BAA6B,CAAC,KAAa,EAAE,SAAiB;YACrE,IAAM,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC,2CAA2C,CAAC,CAAC;YAC3E,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,EAAE;gBACzB,OAAO,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC;aACpC;YACD,OAAO,KAAK,CAAC;SACd;QAED,SAAS,gCAAgC,CAAC,KAAa,EAAE,KAAa,EAAE,SAAiB;YACvF,IAAM,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC,sDAAsD,CAAC,CAAC;YACtF,IAAI,KAAK,IAAI,KAAK,CAAC,MAAM,EAAE;gBACzB,OAAO,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,KAAK,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,KAAK,KAAK,IAAI,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC,CAAC;aACrG;YACD,OAAO,KAAK,CAAC;SACd;QAED,SAAS,QAAQ,CAAC,SAAiB;YACjC,OAAO,SAAS,CAAC,KAAK,CAAC,oBAAoB,CAAC,IAAI,CAAC,eAAe,CAAC,SAAS,CAAC,CAAC;SAC7E;QAED,SAAS,eAAe,CAAC,SAAiB;YACxC,OAAO,SAAS,CAAC,KAAK,CAAC,cAAc,CAAC,CAAC;SACxC;KACF;AACH;;ACpfA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgCA;;;AAGA,SAAS,YAAY,CAAC,GAAW,EAAE,IAAY;;IAE7C,IAAI,CAAC,GAAG,IAAI,MAAM,CAAC,2CAA2C,CAAC,EAC7D,OAAO,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IAExB,IAAI,OAAO,IAAI,CAAA,OAAO,aAAP,OAAO,uBAAP,OAAO,CAAE,MAAM,IAAG,CAAC,EAAE;QAClC,OAAO,eAAe,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC;KAC1C;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAED;;;SAGgB,QAAQ,CAAC,QAAgB,EAAE,IAAY,EAAE,QAAgB;;IACvE,IAAI,QAAQ,KAAK,iCAAiC,EAAE;;QAElD,IAAI,QAAQ,KAAK,EAAE,EAAE;YACnB,QAAQ,GAAG,IAAI,CAAC;SACjB;QACD,IAAI,GAAG,MAAA,YAAY,CAAC,IAAI,EAAE,GAAG,CAAC,mCAAI,EAAE,CAAC;QACrC,QAAQ,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC;KAC9B;SAAM,IACL,QAAQ,KAAK,cAAc;QAC3B,QAAQ,KAAK,gCAAgC;MAC7C;QACA,IAAI,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;QAC9B,QAAQ,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC;KAC9B;IACD,OAAO,CAAC,QAAQ,EAAE,IAAI,EAAE,QAAQ,CAAC,CAAC;AACpC;;ACjEA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA0GA;;;;;;;;;;SAUgB,OAAO,CACrB,SAAiB,EACjB,SAAiB,EACjB,OAAe,EACf,QAAgB,EAChB,WAAwB,EACxB,oBAA+C;;IAA/C,qCAAA,EAAA,yBAA+C;IAE/C,IAAM,UAAU,GAAG,UACjB,SAAiB,EACjB,SAAiB,EACjB,OAAe,EACf,QAAgB,EAChB,KAAkB,EAClB,oBAA0C;;;;;;QAO1C,oBAAoB,CAAC,WAAW,GAAG,MAAA,oBAAoB,CAAC,WAAW,mCAAI,MAAM,CAAC;QAE9E,IAAM,uBAAuB,GAAG,UAAC,MAA4B,YACzD,OAAA,MAAA,MAAM,CAAC,oBAAoB,mCAAI,uBAAuB,CAAA,EAAA,EACxD,2BAA2B,GAAG,UAAC,MAA4B;;YACzD,IAAI,OAAO,MAAM,CAAC,iBAAiB,KAAK,SAAS,EAAE;gBACjD,OAAO,KAAK,CAAC;aACd;YACD,OAAO,MAAA,CAAA,MAAA,MAAM,CAAC,iBAAiB,0CAAE,mBAAmB,MAAK,IAAI,mCAAI,KAAK,CAAC;SACxE,EACD,0BAA0B,GAAG,UAAC,MAA4B;;YACxD,IAAI,OAAO,MAAM,CAAC,iBAAiB,KAAK,SAAS,EAAE;gBACjD,OAAO,KAAK,CAAC;aACd;YACD,OAAO,MAAA,CAAA,MAAA,MAAM,CAAC,iBAAiB,0CAAE,uBAAuB,MAAK,IAAI,mCAAI,KAAK,CAAC;SAC5E,EACD,oBAAoB,GAAG,UAAC,MAA4B,IAAK,OAAA,CAAC,CAAC,MAAM,CAAC,iBAAiB,GAAA,CAAC;;QAGtF,oBAAoB,CAAC,OAAO,GAAG,MAAA,oBAAoB,CAAC,OAAO,mCAAI,EAAE,CAAC;QAClE,IAAI,MAAA,MAAA,oBAAoB,aAApB,oBAAoB,uBAApB,oBAAoB,CAAE,QAAQ,0CAAE,OAAO,mCAAI,IAAI,EAAE;YACnD,oBAAoB,CAAC,OAAO,CAAC,IAAI,CAAC,gBAAgB,EAAE,CAAC,CAAC;SACvD;QAED;QACE,IAAI,GAAG,WAAW,CAAC;YACjB,MAAM,EAAE,oBAAoB,CAAC,YAAY;YACzC,WAAW,EAAE,oBAAoB,CAAC,OAAO;YACzC,QAAQ,EAAE,UAAU,cAAc;gBAChC,cAAc,CAAC,cAAc,CAAC,CAAC;gBAC/B,WAAW,CAAC,cAAc,CAAC,CAAC;aAC7B;SACF,CAAC;;QAEF,eAAe,GAAI,SAAiB,CAAC,YAAY,IAAI,SAAS,CAAC,QAAQ,EACvE,eAAe,GAAG,QAAQ,CAAC,YAAY,IAAI,QAAQ,CAAC,OAAO;;QAE3D,aAAa,GAAG,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,WAAW,EAAE,CAAC,EACvF,WAAW,GAAG,WAAW,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,EAC3C,iBAAiB,GAAG,aAAa,CAAC,CAAC,CAAC,EACpC,iBAAiB,GAAG,aAAa,CAAC,CAAC,CAAC,EACpC,cAAsB;;QAEtB,cAAc,GAAG,MAAA,oBAAoB,CAAC,QAAQ,mCAAI,KAAK;;QAEvD,kBAAkB,GAAG,cAAc,CAAC,QAAQ,CAAC;;QAE7C,cAAc,GAAG,MAAA,oBAAoB,CAAC,QAAQ,mCAAI,qCAAqC;;QAEvF,mBAAmB,GAAG,MAAA,oBAAoB,CAAC,KAAK,mCAAI,EAAE;;QAEtD,eAAuB;;QAEvB,iBAAiB,GAAG,QAAQ,CAAC,KAAK;;QAElC,eAA0C;;QAE1C,+BAA+B,GAAG,MAAA,oBAAoB,CAAC,+BAA+B,mCAAI,IAAI;;QAE9F,oBAA6B;;QAE7B,kBAA2B;;QAE3B,sBAAsB,GAAG,MAAA,oBAAoB,CAAC,UAAU,mCAAI,MAAM;;;QAGlE,kBAAkB,GAAG,MAAA,oBAAoB,CAAC,YAAY,mCAAI,SAAS;;;QAGnE,gBAAgB,GAAG,GAAG;;QAEtB,oBAAoB,GAAG,MAAA,oBAAoB,CAAC,cAAc,mCAAI,MAAM;;QAEpE,kBAAkB,GAAG,MAAA,oBAAoB,CAAC,YAAY,mCAAI,IAAI;;QAE9D,GAAG,GAAG,SAAS,CAAC,UAAU,IAAK,SAAiB,CAAC,YAAY,IAAI,MAAM,CAAC,UAAU;;QAElF,gBAAgB,GACd,OAAO,oBAAoB,CAAC,iBAAiB,KAAK,WAAW;cACzD,oBAAoB,CAAC,iBAAiB,KAAK,GAAG,KAAK,KAAK,IAAI,GAAG,KAAK,GAAG,CAAC;cACxE,KAAK;;QAEX,kBAA6C;;QAE7C,0BAA0B,GAAG,MAAA,oBAAoB,CAAC,cAAc,mCAAI,QAAQ;;QAE5E,0BAA0B,GAAG,MAAA,oBAAoB,CAAC,oBAAoB,mCAAI,IAAI;;QAE9E,8BAA8B,GAAG,2BAA2B,CAAC,oBAAoB,CAAC;;QAElF,6BAA6B,GAAG,0BAA0B,CAAC,oBAAoB,CAAC;;QAEhF,uBAAuB,GAAG,oBAAoB,CAAC,oBAAoB,CAAC;;QAEpE,0BAA0B,GAAG,uBAAuB,CAAC,oBAAoB,CAAC;;QAE1E,gBAAwB;;QAExB,aAAa,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE;;QAEpC,UAAkB,EAClB,UAAkB,EAClB,UAAkB,EAClB,UAAkB;;QAElB,UAAkB;;QAElB,YAAoB;;QAEpB,kBAA0B;;QAE1B,mBAAmB,GAAG,CAAC;;QAEvB,cAAyC;;QAEzC,QAAQ,GAAG,eAAe,CACxB,SAAS,EACT,KAAK,EACL,0BAA0B,IAAI,cAAc,IAAI,0BAA0B,IAAI,uBAAuB,EACrG,oBAAoB,CAAC,WAAW,EAChC,cAAc,EACd,MAAA,oBAAoB,CAAC,UAAU,mCAAI,CAAC,EACpC,MAAA,oBAAoB,CAAC,YAAY,mCAAI,KAAK,EAC1C,MAAA,oBAAoB,CAAC,MAAM,mCAAI,IAAI,EACnC,MAAA,oBAAoB,CAAC,wBAAwB,mCAAI,IAAI,EACrD,MAAA,oBAAoB,CAAC,iBAAiB,mCAAI,IAAI,EAC9C,6BAA6B,CAC9B;;QAED,kBAAkB,GAAG,KAAK;;QAE1B,YAAY,GAAG,KAAK;;QAEpB,sBAAsB,GAA2B;YAC/C,OAAO,EAAE,KAAK;YACd,SAAS,EAAE,KAAK;YAChB,cAAc,EAAE,EAAE;SACnB,CAAC;QAEJ,IAAI,oBAAoB,CAAC,cAAc,CAAC,oBAAoB,CAAC,IAAI,oBAAoB,CAAC,kBAAkB,EAAE;YACxG,kBAAkB,GAAG,cAAc,CAAC,oBAAoB,EAAE,kBAAkB,CAAC,CAAC;SAC/E;;QAGD,IAAI,CAAC,iBAAiB,CAAC,OAAO,CAAC,CAAC;QAChC,IAAI,CAAC,mBAAmB,CAAC,SAAS,CAAC,CAAC;QACpC,IAAI,CAAC,QAAQ,CAAC,mBAAmB,CAAC,CAAC;QACnC,IAAI,CAAC,WAAW,CAAC,cAAc,CAAC,CAAC;QACjC,IAAI,CAAC,cAAc,CAAC,QAAQ,EAAE,SAAS,CAAC,aAAa,GAAG,GAAG,GAAG,GAAG,CAAC,CAAC;QACnE,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,eAAe,CAAC,CAAC;QAC3C,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,eAAe,CAAC,CAAC;QAC7C,IAAI,CAAC,cAAc,CAAC,KAAK,EAAE,MAAM,CAAC,KAAK,GAAG,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,CAAC;QAC/D,IAAI,CAAC,cAAc,CAAC,IAAI,EAAE,MAAM,CAAC,UAAU,CAAC,CAAC;;;;QAK7C,gBAAgB,EAAE,CAAC;QAEnB,uBAAuB,EAAE,CAAC;QAE1B,IAAI,oBAAoB,CAAC,iBAAiB,EAAE;YAC1C,aAAa,CAAC,oBAAoB,CAAC,iBAAiB,CAAC,CAAC;SACvD;;;;QAKD,SAAS,UAAU;YACjB,aAAa,GAAG,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,QAAQ,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI,EAAE,WAAW,EAAE,CAAC,CAAC;;;;YAKxF,IAAI,aAAa,CAAC,CAAC,CAAC,KAAK,iBAAiB,EAAE;gBAC1C,iBAAiB,GAAG,WAAW,CAAC,iBAAiB,CAAC,CAAC;aACpD;YAED,WAAW,GAAG,WAAW,CAAC,aAAa,CAAC,CAAC,CAAC,CAAC,CAAC;YAC5C,iBAAiB,GAAG,aAAa,CAAC,CAAC,CAAC,CAAC;SACtC;;;;;;QAOD,SAAS,qBAAqB,CAAC,GAAU;YACvC,IAAI,SAAS,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;YACrC,IAAI,GAAG,GAAG,GAAG,CAAC,aAA2D,CAAC;YAC1E,IAAI,GAAG,aAAH,GAAG,uBAAH,GAAG,CAAE,IAAI,EAAE;gBACb,GAAG,CAAC,IAAI,GAAG,mBAAmB,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,YAAY,GAAG,GAAG,GAAG,SAAS,CAAC,CAAC;aACjF;SACF;;;;;;;;QASD,SAAS,aAAa,CAAC,iBAAwE;YAC7F,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAC9C,IAAI,GAAG,GAAG,QAAQ,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC5B,IAAI,CAAE,GAAW,CAAC,mBAAmB,IAAI,iBAAiB,CAAC,GAAG,CAAC,EAAE;oBAC/D,gBAAgB,CAAC,GAAG,EAAE,OAAO,EAAE,qBAAqB,EAAE,IAAI,CAAC,CAAC;oBAC5D,gBAAgB,CAAC,GAAG,EAAE,WAAW,EAAE,qBAAqB,EAAE,IAAI,CAAC,CAAC;;oBAG/D,GAAW,CAAC,mBAAmB,GAAG,IAAI,CAAC;iBACzC;aACF;SACF;;;;;;;QAQD,SAAS,MAAM,CAAC,GAAW;YACzB,IAAI,aAAa,CAAC;YAElB,IAAI,oBAAoB,EAAE;gBACxB,aAAa,GAAG,IAAI,MAAM,CAAC,KAAK,CAAC,CAAC;gBAClC,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;aACtC;YAED,IAAI,kBAAkB,EAAE;gBACtB,aAAa,GAAG,IAAI,MAAM,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;gBACxC,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,aAAa,EAAE,EAAE,CAAC,CAAC;aACtC;YACD,OAAO,GAAG,CAAC;SACZ;;;;QAKD,SAAS,iBAAiB,CAAC,GAAW;YACpC,IAAI,CAAC,GAAG,IAAI,MAAM,CAAC,YAAY,CAAC,EAC9B,OAAO,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;YAExB,OAAO,OAAO,GAAG,OAAO,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC;SACpC;;;;;;QAOD,SAAS,wBAAwB,CAAC,OAAe,EAAE,GAAW;YAC5D,IAAI,QAAQ,GAAG,iBAAiB,CAAC,GAAG,CAAC,EACnC,CAAC,CAAC;YAEJ,IAAI,QAAQ,EAAE;gBACZ,OAAO,GAAG,CAAC;aACZ;YAED,IAAI,GAAG,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,KAAK,GAAG,EAAE;gBAC3B,OAAO,iBAAiB,CAAC,OAAO,CAAC,GAAG,KAAK,GAAG,WAAW,CAAC,OAAO,CAAC,GAAG,GAAG,CAAC;aACxE;YAED,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC;YAC1B,IAAI,CAAC,CAAC,GAAG,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,EAAE;gBACnC,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;aAC/B;YACD,IAAI,CAAC,CAAC,GAAG,OAAO,CAAC,WAAW,CAAC,GAAG,CAAC,MAAM,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;gBACzD,OAAO,GAAG,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,GAAG,CAAC,CAAC,CAAC;aACnC;YAED,OAAO,OAAO,GAAG,GAAG,CAAC;SACtB;;;;QAKD,SAAS,WAAW,CAAC,OAAuB;;YAE1C,IAAI,gBAAgB,CAAC;YACrB,IAAI,kBAAkB,EAAE;gBACtB,gBAAgB,GAAG,CAAC,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;aACjD;iBAAM;gBACL,gBAAgB,GAAG,KAAK,CAAC;aAC1B;YAED,IAAI,EAAE,gBAAgB,IAAI,gBAAgB,CAAC,EAAE;gBAC3C,QAAQ,CAAC,cAAc,CAAC,OAAO,CAAC,KAAK,EAAE,EAAE,kBAAkB,CAAC,CAAC;aAC9D;SACF;;;;QAKD,SAAS,qBAAqB,CAAC,QAAgB;YAC7C,OAAO,sBAAsB,GAAG,QAAQ,GAAG,GAAG,GAAG,UAAU,CAAC;SAC7D;;;;QAKD,SAAS,sBAAsB,CAAC,UAAkB;YAChD,IAAI,QAAQ,GAAG,qBAAqB,CAAC,UAAU,CAAC,CAAC;YACjD,IAAI,0BAA0B,IAAI,cAAc,EAAE;gBAChD,OAAO,sBAAsB,CAAC,QAAQ,CAAC,CAAC;aACzC;iBAAM,IAAI,0BAA0B,IAAI,QAAQ,IAAI,0BAA0B,IAAI,uBAAuB,EAAE;gBAC1G,OAAO,MAAM,CAAC,QAAQ,CAAC,CAAC;aACzB;YACD,OAAO,SAAS,CAAC;SAClB;;;;QAKD,SAAS,gBAAgB;YACvB,UAAU,EAAE,CAAC;YACb,UAAU,GAAG,IAAI,CAAC,CAAC,kBAAkB,IAAI,WAAW,KAAK,gBAAgB,IAAI,GAAG,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;SAChG;;;;;QAMD,SAAS,eAAe;YACtB,IAAI,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;YACrB,gBAAgB,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC;SAClC;;;;QAKD,SAAS,aAAa;YACpB,gBAAgB,EAAE,CAAC;YACnB,eAAe,EAAE,CAAC;SACnB;;;;QAKD,SAAS,cAAc;YACrB,IAAM,eAAe,GAAG,QAAQ,CAAC,eAAe,CAAC;YACjD,IAAI,eAAe,EAAE;gBACnB,OAAO,CAAC,eAAe,CAAC,UAAU,IAAI,MAAM,CAAC,WAAW,EAAE,eAAe,CAAC,SAAS,IAAI,MAAM,CAAC,WAAW,CAAC,CAAC;aAC5G;YAED,OAAO,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;SACf;;;;QAKD,SAAS,eAAe;YACtB,IAAM,OAAO,GAAG,cAAc,EAAE,CAAC;YAEjC,IAAM,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;YACrB,UAAU,GAAG,CAAC,CAAC;YACf,UAAU,GAAG,CAAC,CAAC;YAEf,IAAM,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;YACrB,UAAU,GAAG,CAAC,CAAC;YACf,UAAU,GAAG,CAAC,CAAC;SAChB;;;;QAKD,SAAS,gBAAgB;YACvB,IAAM,OAAO,GAAG,cAAc,EAAE,CAAC;YAEjC,IAAM,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,GAAG,UAAU,EAAE;gBAClB,UAAU,GAAG,CAAC,CAAC;aAChB;iBAAM,IAAI,CAAC,GAAG,UAAU,EAAE;gBACzB,UAAU,GAAG,CAAC,CAAC;aAChB;YAED,IAAM,CAAC,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,GAAG,UAAU,EAAE;gBAClB,UAAU,GAAG,CAAC,CAAC;aAChB;iBAAM,IAAI,CAAC,GAAG,UAAU,EAAE;gBACzB,UAAU,GAAG,CAAC,CAAC;aAChB;SACF;;;;;QAMD,SAAS,WAAW,CAAC,MAAc;YACjC,OAAO,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;SAC3B;;;;QAKD,SAAS,gBAAgB;YACvB,IAAI,UAAU,GAAG,qBAAqB,CAAC,KAAK,CAAC,CAAC;YAC9C,IAAI,WAAW,GAAG,GAAG,CAAC;YACtB,SAAS,CAAC,UAAU,EAAE,WAAW,EAAE,0BAA0B,CAAC,CAAC;SAChE;;;;;QAMD,SAAS,qBAAqB,CAC5B,YAAoB,EACpB,QAAgB,EAChB,UAAkB,EAClB,KAAa,EACb,WAAmB,EACnB,SAAiB;YAEjB,IAAI,UAAU,GAAG,qBAAqB,CAAC,IAAI,CAAC,CAAC;YAC7C,IAAI,WAAW,GACb,YAAY,GAAG,GAAG,GAAG,QAAQ,GAAG,GAAG,GAAG,UAAU,GAAG,GAAG,GAAG,KAAK,GAAG,GAAG,GAAG,WAAW,GAAG,GAAG,GAAG,SAAS,CAAC;YACvG,SAAS,CAAC,UAAU,EAAE,WAAW,EAAE,0BAA0B,CAAC,CAAC;SAChE;;;;;;;;QASD,SAAS,SAAS,CAAC,IAAY,EAAE,KAAa,EAAE,OAAe;YAC7D,IAAI,uBAAuB,IAAI,CAAC,8BAA8B,EAAE;gBAC9D,OAAO;aACR;YAED,IAAI,0BAA0B,IAAI,cAAc,EAAE;gBAChD,wBAAwB,CAAC,IAAI,EAAE,KAAK,EAAE,OAAO,CAAC,CAAC;aAChD;iBAAM,IAAI,0BAA0B,IAAI,QAAQ,IAAI,0BAA0B,IAAI,uBAAuB,EAAE;gBAC1G,MAAM,CAAC,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,gBAAgB,EAAE,kBAAkB,EAAE,oBAAoB,EAAE,kBAAkB,CAAC,CAAC;aAC9G;SACF;;;;QAKD,SAAS,uBAAuB,CAAC,aAA0C;YACzE,IAAM,MAAM,GAAG,qBAAqB,CAAC,IAAI,CAAC,CAAC;YAC3C,IAAM,OAAO,GAAG,qBAAqB,CAAC,KAAK,CAAC,CAAC;YAC7C,yBAAyB,CAAC,MAAM,CAAC,CAAC;YAClC,yBAAyB,CAAC,OAAO,CAAC,CAAC;YACnC,YAAY,CAAC,MAAM,EAAE,kBAAkB,EAAE,oBAAoB,EAAE,kBAAkB,CAAC,CAAC;YACnF,YAAY,CAAC,OAAO,EAAE,kBAAkB,EAAE,oBAAoB,EAAE,kBAAkB,CAAC,CAAC;YACpF,IAAI,EAAC,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,eAAe,CAAA,EAAE;gBACnC,kBAAkB,GAAGA,EAAI,EAAE,CAAC;gBAC5B,mBAAmB,GAAG,CAAC,CAAC;aACzB;YACD,IAAI,EAAC,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,YAAY,CAAA,EAAE;gBAChC,YAAY,GAAGA,EAAI,EAAE,CAAC;gBACtB,cAAc,GAAG,IAAI,CAAC;aACvB;SACF;;;;QAKD,SAAS,uBAAuB,CAC9B,aAA4F;YAE5F,IAAI,aAAa,IAAI,aAAa,CAAC,oBAAoB,EAAE;gBACvD,oBAAoB,CAAC,oBAAoB,GAAG,aAAa,CAAC,oBAAoB,CAAC;gBAC/E,0BAA0B,GAAG,uBAAuB,CAAC,oBAAoB,CAAC,CAAC;aAC5E;YAED,uBAAuB,GAAG,oBAAoB,CAAC,oBAAoB,CAAC,CAAC;YACrE,8BAA8B,GAAG,2BAA2B,CAAC,oBAAoB,CAAC,CAAC;YACnF,6BAA6B,GAAG,0BAA0B,CAAC,oBAAoB,CAAC,CAAC;YAEjF,QAAQ,CAAC,kBAAkB,CACzB,0BAA0B,IAAI,cAAc,IAAI,0BAA0B,IAAI,uBAAuB,CACtG,CAAC;YACF,QAAQ,CAAC,oBAAoB,CAAC,6BAA6B,CAAC,CAAC;SAC9D;;;;;QAMD,SAAS,uBAAuB;YAC9B,IAAI,uBAAuB,IAAI,CAAC,8BAA8B,EAAE;gBAC9D,OAAO;aACR;YAED,IAAI,YAAY,GAAG,0BAA0B,IAAI,MAAM,IAAI,CAAC,CAAC,sBAAsB,CAAC,KAAK,CAAC,CAAC;YAC3F,IAAI,kBAAkB,GAAG,sBAAsB,EAAE,CAAC;YAElD,IAAI,kBAAkB,CAAC,CAAC,CAAC,EAAE;gBACzB,YAAY,GAAG,kBAAkB,CAAC,CAAC,CAAW,CAAC;aAChD;iBAAM,IAAI,CAAC,uBAAuB,EAAE;gBACnC,YAAY,GAAGA,EAAI,EAAE,CAAC;gBACtB,kBAAkB,CAAC,CAAC,CAAC,GAAG,YAAY,CAAC;aACtC;iBAAM;gBACL,YAAY,GAAG,EAAE,CAAC;gBAClB,kBAAkB,CAAC,CAAC,CAAC,GAAG,YAAY,CAAC;aACtC;YAED,kBAAkB,GAAG,kBAAkB,CAAC,CAAC,CAAW,CAAC;YAErD,IAAI,CAAC,YAAY,EAAE;;gBAEhB,kBAAkB,CAAC,CAAC,CAAY,EAAE,CAAC;;gBAEpC,kBAAkB,GAAGA,EAAI,EAAE,CAAC;gBAC5B,kBAAkB,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC;;gBAE3C,kBAAkB,CAAC,CAAC,CAAC,GAAG,kBAAkB,CAAC,CAAC,CAAC,CAAC;aAC/C;YAED,IAAI,0BAA0B,IAAI,MAAM,EAAE;gBACxC,gBAAgB,EAAE,CAAC;;gBAEnB,kBAAkB,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,CAAC;gBAChE,kBAAkB,CAAC,KAAK,EAAE,CAAC;gBAC3B,qBAAqB,CAAC,KAAK,CAAC,IAAI,EAAE,kBAAyB,CAAC,CAAC;aAC9D;SACF;;;;QAKD,SAAS,sBAAsB;YAC7B,IAAI,0BAA0B,IAAI,MAAM,EAAE;gBACxC,OAAO,EAAE,CAAC;aACX;YACD,IAAI,GAAG,GAAG,IAAI,IAAI,EAAE,EAClB,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,EACxC,EAAE,GAAG,sBAAsB,CAAC,IAAI,CAAC,EACjC,YAAY,CAAC;YAEf,IAAI,EAAE,EAAE;gBACN,YAAY,GAAG,EAAE,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;;gBAE7B,YAAY,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;aAC3B;iBAAM;gBACL,YAAY,GAAG;;oBAEb,GAAG;;oBAEH,YAAY;;oBAEZ,KAAK;;oBAEL,CAAC;;oBAED,KAAK;;oBAEL,EAAE;iBACH,CAAC;aACH;YAED,IAAI,CAAC,YAAY,CAAC,CAAC,CAAC,IAAI,YAAY,CAAC,CAAC,CAAC,KAAK,WAAW,EAAE;;gBAEvD,YAAY,CAAC,CAAC,CAAC,GAAGA,EAAI,EAAE,CAAC;aAC1B;YAED,OAAO,YAAY,CAAC;SACrB;;;;;QAMD,SAAS,cAAc,CAAC,cAA8B;YACpD,IAAM,WAAW,GAAG,UAAC,KAA8B,IAAK,QAAC,uBAAuB,GAAG,IAAI,GAAG,KAAK,IAAC,CAAC;YACjG,IAAM,kBAAkB,GAAG,UAAC,KAA8B;gBACxD,OAAA,8BAA8B,GAAG,KAAK,GAAG,WAAW,CAAC,KAAK,CAAC;aAAA,CAAC;YAE9D,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,EACjD,GAAG,GAAG,sBAAsB,CAAC,KAAK,CAAC,EACnC,EAAE,GAAG,sBAAsB,EAAE,EAC7B,eAAe,GAAG,EAAE,CAAC,CAAC,CAAC,EACvB,aAAa,GAAG,EAAE,CAAC,CAAC,CAAW;YAC/B,QAAQ,GAAG,EAAE,CAAC,CAAC,CAAW,EAC1B,UAAU,GAAG,EAAE,CAAC,CAAC,CAAW,EAC5B,cAAc,GAAG,EAAE,CAAC,CAAC,CAAW,EAChC,WAAW,GAAG,EAAE,CAAC,CAAC,CAAW,EAC7B,mBAAmB,GAAG,EAAE,CAAC,CAAC,CAAW,CAAC;YAExC,IAAI,gBAAgB,CAAC;YACrB,IAAI,kBAAkB,EAAE;gBACtB,gBAAgB,GAAG,CAAC,CAAC,MAAM,CAAC,kBAAkB,CAAC,CAAC;aACjD;iBAAM;gBACL,gBAAgB,GAAG,KAAK,CAAC;aAC1B;YAED,IAAI,gBAAgB,IAAI,gBAAgB,EAAE;gBACxC,uBAAuB,EAAE,CAAC;gBAC1B,OAAO;aACR;;YAGD,IAAI,eAAe,KAAK,GAAG,EAAE;gBAC3B,kBAAkB,GAAG,mBAA6B,CAAC;;gBAGnD,IAAI,CAAC,GAAG,IAAI,0BAA0B,IAAI,MAAM,EAAE;;oBAE/C,UAAqB,EAAE,CAAC;;oBAEzB,WAAW,GAAG,cAAc,CAAC;;oBAE7B,kBAAkB,GAAGA,EAAI,EAAE,CAAC;iBAC7B;gBAED,mBAAmB,GAAG,UAAoB,CAAC;aAC5C;iBAAM,IAAI,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,aAAa,GAAG,0BAA0B,GAAG,IAAI,EAAE;gBACnF,kBAAkB,GAAGA,EAAI,EAAE,CAAC;gBAC5B,mBAAmB,EAAE,CAAC;aACvB;YAED,cAAc,CAAC,GAAG,CAAC,IAAI,EAAE,cAAc,EAAE,CAAC,CAAC;YAC3C,cAAc,CAAC,GAAG,CAAC,IAAI,EAAE,kBAAkB,EAAE,CAAC,CAAC;YAC/C,cAAc,CAAC,GAAG,CAAC,KAAK,EAAE,kBAAkB,CAAC,mBAAmB,CAAC,CAAC,CAAC;YACnE,cAAc,CAAC,GAAG,CAAC,KAAK,EAAE,kBAAkB,CAAC,kBAAkB,CAAC,CAAC,CAAC;YAClE,cAAc,CAAC,GAAG,CAAC,MAAM,EAAE,WAAW,CAAC,aAAa,CAAC,CAAC,CAAC;YACvD,cAAc,CAAC,GAAG,CAAC,KAAK,EAAE,WAAW,CAAC,cAAc,CAAC,CAAC,CAAC;YAEvD,UAAU,EAAE,CAAC;YAEb,cAAc,CAAC,GAAG,CAAC,MAAM,EAAE,MAAM,CAAC,cAAc,IAAI,iBAAiB,CAAC,CAAC,CAAC;;YAGxE,cAAc,CAAC,GAAG,CAAC,KAAK,EAAE,MAAM,CAAC,eAAe,IAAI,iBAAiB,CAAC,CAAC,CAAC;;YAGxE,IAAI,0BAA0B,IAAI,MAAM,EAAE;gBACxC,qBAAqB,CAAC,aAAa,EAAE,QAAQ,EAAE,mBAAmB,EAAE,KAAK,EAAE,WAAW,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,gBAAgB,EAAE,CAAC;aACpB;YAED,aAAa,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;SACtC;;;;;;;QAQD,SAAS,cAAc,CAAC,YAAoB;YAC1C,IAAI,YAAY,CAAC,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE;gBACtC,OAAO,YAAY,CAAC;aACrB;YAED,OAAO,CAAC,QAAQ,KAAK,QAAQ,CAAC,QAAQ,CAAC,QAAQ,GAAG,OAAO,GAAG,MAAM,IAAI,KAAK,GAAG,YAAY,CAAC;SAC5F;;;;;QAMD,SAAS,aAAa;YACpB,IAAI,CAAC,kBAAkB,IAAI,KAAK,CAAC,UAAU,IAAI,IAAI,EAAE;gBACnD,KAAK,CAAC,UAAU,GAAGA,EAAI,EAAE,CAAC;aAC3B;SACF;;;;;QAMD,SAAS,aAAa;YACpB,IAAI,KAAK,CAAC,UAAU,IAAI,IAAI,EAAE;gBAC5B,KAAK,CAAC,UAAU,GAAGA,EAAI,EAAE,CAAC;aAC3B;YACD,OAAO,KAAK,CAAC,UAAU,CAAC;SACzB;;;;;;QAOD,SAAS,gBAAgB;YACvB,OAAO;gBACL,QAAQ,EAAE;oBACR,OAAO;wBACL;4BACE,MAAM,EAAE,+DAA+D;4BACvE,IAAI,EAAE;gCACJ,EAAE,EAAE,aAAa,EAAE;6BACpB;yBACF;qBACF,CAAC;iBACH;aACF,CAAC;SACH;;;;QAKD,SAAS,UAAU;;YAEjB,IAAI,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,GAAG,IAAI,CAAC,EACjD,EAAE,GAAG,sBAAsB,EAAE,EAC7B,eAAe,GAAG,EAAE,CAAC,CAAC,CAAC,EACvB,aAAa,GAAG,EAAE,CAAC,CAAC,CAAW;YAC/B,QAAQ,GAAG,EAAE,CAAC,CAAC,CAAW,EAC1B,UAAU,GAAG,EAAE,CAAC,CAAC,CAAW,EAC5B,cAAc,GAAG,EAAE,CAAC,CAAC,CAAW,EAChC,WAAW,GAAG,EAAE,CAAC,CAAC,CAAW,EAC7B,mBAAmB,GAAG,EAAE,CAAC,CAAC,CAAW,CAAC;;YAGxC,IAAI,eAAe,KAAK,GAAG,EAAE;gBAC3B,kBAAkB,GAAG,mBAAmB,CAAC;;gBAGzC,IAAI,0BAA0B,IAAI,MAAM,EAAE;;oBAExC,UAAU,EAAE,CAAC;;oBAEb,WAAW,GAAG,cAAc,CAAC;;oBAE7B,kBAAkB,GAAGA,EAAI,EAAE,CAAC;iBAC7B;gBAED,mBAAmB,GAAG,UAAU,CAAC;;gBAGjC,gBAAgB,EAAE,CAAC;aACpB;iBAAM;gBACL,kBAAkB,GAAGA,EAAI,EAAE,CAAC;gBAC5B,mBAAmB,EAAE,CAAC;aACvB;;YAGD,IAAI,0BAA0B,IAAI,MAAM,EAAE;gBACxC,qBAAqB,CAAC,aAAa,EAAE,QAAQ,EAAE,mBAAmB,EAAE,KAAK,EAAE,WAAW,EAAE,kBAAkB,CAAC,CAAC;gBAC5G,gBAAgB,EAAE,CAAC;aACpB;YAED,aAAa,GAAG,IAAI,IAAI,EAAE,CAAC,OAAO,EAAE,CAAC;SACtC;;;;;;;QAQD,SAAS,gBAAgB,CACvB,cAAiD,EACjD,eAA0D;YAE1D,OAAO,CAAC,cAAc,IAAI,EAAE,EAAE,MAAM,CAAC,eAAe,GAAG,eAAe,EAAE,GAAG,EAAE,CAAC,CAAC;SAChF;QAED,SAAS,WAAW,CAAC,EAAqF;gBAAnF,KAAK,WAAA,EAAE,OAAO,aAAA,EAAE,SAAS,eAAA,EAAE,eAAe,qBAAA;YAC/D,UAAU,EAAE,CAAC;YACb,IAAI,YAAY,EAAE;;gBAEhB,aAAa,EAAE,CAAC;aACjB;YACD,YAAY,GAAG,IAAI,CAAC;;YAGpB,iBAAiB,GAAG,QAAQ,CAAC,KAAK,CAAC;YACnC,eAAe,GAAG,KAAK,CAAC;;YAGxB,IAAI,SAAS,GAAG,UAAU,CAAC,eAAe,IAAI,iBAAiB,CAAC,CAAC;;YAGjE,IAAI,CAAC,KAAK,CACR,aAAa,CAAC;gBACZ,OAAO,EAAE,MAAM,CAAC,eAAe,IAAI,iBAAiB,CAAC;gBACrD,SAAS,WAAA;gBACT,QAAQ,EAAE,MAAM,CAAC,cAAc,IAAI,iBAAiB,CAAC;aACtD,CAAC,EACF,gBAAgB,CAAC,OAAO,EAAE,eAAe,CAAC,EAC1C,SAAS,CACV,CAAC;;YAGF,IAAI,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;YACrB,IAAI,0BAA0B,GAAG,KAAK,CAAC;YAEvC,IAAI,sBAAsB,CAAC,OAAO,IAAI,CAAC,sBAAsB,CAAC,SAAS,EAAE;gBACvE,sBAAsB,CAAC,SAAS,GAAG,IAAI,CAAC;gBACxC,0BAA0B,GAAG,IAAI,CAAC;;gBAGlC,IAAI,mBAAmB,GAAiD;oBACtE,MAAM,EAAE,SAAS,MAAM;wBACrB,IAAI,OAAO,MAAM,KAAK,WAAW,IAAI,OAAO,MAAM,CAAC,gBAAgB,KAAK,UAAU,EAAE;4BAClF,IAAI,OAAO,GAAG,KAAK,CAAC;4BACpB,IAAI,OAAO,GAAG,MAAM,CAAC,cAAc,CAAC,EAAE,EAAE,SAAS,EAAE;gCACjD,GAAG,EAAE,SAAS,GAAG;oCACf,OAAO,GAAG,IAAI,CAAC;iCAChB;gCACD,GAAG,EAAE,SAAS,GAAG,MAAK;6BACvB,CAAC,CAAC;;;;;4BAKH,IAAI,IAAI,GAAG,SAAS,IAAI,MAAK,CAAC;4BAC9B,MAAM,CAAC,gBAAgB,CAAC,yBAAyB,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;4BAClE,MAAM,CAAC,mBAAmB,CAAC,yBAAyB,EAAE,IAAI,EAAE,OAAO,CAAC,CAAC;4BACrE,mBAAmB,CAAC,UAAU,GAAG,OAAO,CAAC;yBAC1C;qBACF;iBACF,CAAC;gBACF,mBAAmB,CAAC,MAAM,EAAE,CAAC;;gBAG7B,IAAI,UAAU,GACZ,SAAS,IAAI,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC;sBACtC,OAAO;sBACN,QAAgB,CAAC,YAAY,KAAK,SAAS;0BAC5C,YAAY;0BACZ,gBAAgB,CAAC;gBAEvB,IAAI,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,mBAAmB,EAAE,YAAY,CAAC,EAAE;oBAC3E,gBAAgB,CAAC,QAAQ,EAAE,UAAU,EAAE,eAAe,EAAE,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;iBAC5E;qBAAM;oBACL,gBAAgB,CAAC,QAAQ,EAAE,UAAU,EAAE,eAAe,CAAC,CAAC;iBACzD;;gBAGD,eAAe,EAAE,CAAC;;;gBAIlB,IAAM,gBAAgB,GAAG,CAAC,OAAO,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW,EAAE,UAAU,EAAE,SAAS,EAAE,OAAO,CAAC,CAAC;gBACxG,IAAM,cAAc,GAAG,CAAC,QAAQ,EAAE,OAAO,EAAE,MAAM,CAAC,CAAC;gBACnD,IAAM,QAAQ,GACZ,UAAC,CAAoB,EAAE,OAAyB;oBAAzB,wBAAA,EAAA,yBAAyB;oBAChD,OAAA,UAAC,EAAU;wBACT,OAAA,gBAAgB,CAAC,QAAQ,EAAE,EAAE,EAAE,OAAO,CAAC;qBAAA;iBAAA,CAAC;gBAE5C,gBAAgB,CAAC,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC,CAAC;gBAC7C,cAAc,CAAC,OAAO,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC,CAAC;gBACzC,QAAQ,CAAC,MAAM,EAAE,aAAa,CAAC,CAAC,QAAQ,CAAC,CAAC;aAC3C;YAED,IAAI,sBAAsB,CAAC,OAAO,KAAK,+BAA+B,IAAI,0BAA0B,CAAC,EAAE;;gBAErG,gBAAgB,GAAG,GAAG,CAAC,OAAO,EAAE,CAAC;gBAEjC,IAAI,GAAG,SAA8B,CAAC;gBACtC,KAAK,GAAG,IAAI,sBAAsB,CAAC,cAAc,EAAE;oBACjD,IAAM,MAAM,GAAG,sBAAsB,CAAC,cAAc,CAAC,GAAG,CAAC,CAAC;oBAC1D,IAAI,MAAM,EAAE;;wBAEV,MAAM,CAAC,aAAa,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC;wBAE9C,gBAAgB,CAAC,MAAM,EAAE,OAAO,EAAE,eAAe,CAAC,CAAC;qBACpD;iBACF;aACF;SACF;QAED,SAAS,gBAAgB,CACvB,MAAsB,EACtB,OAA0C,EAC1C,eAA0D;YAE1D,IAAM,eAAe,GAAG,UAAC,EAAoB,EAAE,CAA4B;gBACzE,UAAU,EAAE,CAAC;gBACb,EAAE,CAAC,EAAE,OAAO,EAAE,CAAC,EAAE,UAAU,EAAE,aAAa,EAAE,EAAE,UAAU,YAAA,EAAE,UAAU,YAAA,EAAE,UAAU,YAAA,EAAE,UAAU,YAAA,EAAE,CAAC,CAAC;gBAChG,eAAe,EAAE,CAAC;aACnB,CAAC;YAEF,IAAM,OAAO,GAAG;gBACd,IAAI,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;;;gBAIrB,IAAI,gBAAgB,GAAG,MAAM,CAAC,wBAAwB,GAAG,GAAG,CAAC,OAAO,EAAE,EAAE;oBACtE,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,gBAAgB,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC,CAAC;iBAC9E;gBAED,MAAM,CAAC,gBAAgB,GAAG,MAAM,CAAC,WAAW,CAAC,SAAS,EAAE,MAAM,CAAC,oBAAoB,CAAC,CAAC;aACtF,CAAC;YAEF,IAAM,SAAS,GAAG;gBAChB,IAAI,GAAG,GAAG,IAAI,IAAI,EAAE,CAAC;;;gBAIrB,IAAI,gBAAgB,GAAG,MAAM,CAAC,oBAAoB,GAAG,GAAG,CAAC,OAAO,EAAE,EAAE;oBAClE,eAAe,CAAC,MAAM,CAAC,QAAQ,EAAE,gBAAgB,CAAC,OAAO,EAAE,eAAe,CAAC,CAAC,CAAC;iBAC9E;aACF,CAAC;YAEF,IAAI,MAAM,CAAC,wBAAwB,IAAI,CAAC,EAAE;gBACxC,MAAM,CAAC,gBAAgB,GAAG,MAAM,CAAC,UAAU,CAAC,OAAO,EAAE,MAAM,CAAC,wBAAwB,CAAC,CAAC;aACvF;iBAAM;gBACL,MAAM,CAAC,gBAAgB,GAAG,MAAM,CAAC,WAAW,CAAC,SAAS,EAAE,MAAM,CAAC,oBAAoB,CAAC,CAAC;aACtF;SACF;;;;QAKD,SAAS,yBAAyB,CAChC,aAAoF;YAE5E,IAAA,kBAAkB,GAA+B,aAAa,mBAA5C,EAAE,cAAc,GAAe,aAAa,eAA5B,EAAE,QAAQ,GAAK,aAAa,SAAlB,CAAmB;YACvE,IAAI,SAAS,CAAC,kBAAkB,CAAC,IAAI,SAAS,CAAC,cAAc,CAAC,EAAE;gBAC9D,OAAO;oBACL,wBAAwB,EAAE,kBAAkB,GAAG,IAAI;oBACnD,oBAAoB,EAAE,cAAc,GAAG,IAAI;oBAC3C,QAAQ,UAAA;iBACT,CAAC;aACH;YAED,GAAG,CAAC,KAAK,CAAC,wEAAwE,CAAC,CAAC;YACpF,OAAO,SAAS,CAAC;SAClB;;;;;QAMD,SAAS,WAAW,CAAC,EAAiF;gBAA/E,OAAO,aAAA,EAAE,UAAU,gBAAA,EAAE,UAAU,gBAAA,EAAE,UAAU,gBAAA,EAAE,UAAU,gBAAA;YAC5E,IAAI,gBAAgB,GAAG,QAAQ,CAAC,KAAK,CAAC;YACtC,IAAI,gBAAgB,KAAK,iBAAiB,EAAE;gBAC1C,iBAAiB,GAAG,gBAAgB,CAAC;gBACrC,eAAe,GAAG,SAAS,CAAC;aAC7B;YACD,IAAI,CAAC,KAAK,CACR,aAAa,CAAC;gBACZ,OAAO,EAAE,MAAM,CAAC,eAAe,IAAI,iBAAiB,CAAC;gBACrD,SAAS,EAAE,UAAU,CAAC,eAAe,IAAI,iBAAiB,CAAC;gBAC3D,QAAQ,EAAE,MAAM,CAAC,cAAc,IAAI,iBAAiB,CAAC;gBACrD,UAAU,EAAE,WAAW,CAAC,UAAU,CAAC;gBACnC,UAAU,EAAE,WAAW,CAAC,UAAU,CAAC;gBACnC,UAAU,EAAE,WAAW,CAAC,UAAU,CAAC;gBACnC,UAAU,EAAE,WAAW,CAAC,UAAU,CAAC;aACpC,CAAC,EACF,OAAO,CACR,CAAC;SACH;QAED,IAAM,UAAU,GAAG;YACjB,qBAAqB,EAAE;gBACrB,OAAO,mBAAmB,CAAC;aAC5B;YAED,aAAa,EAAE;gBACb,OAAO,aAAa,EAAE,CAAC;aACxB;YAED,UAAU,EAAE,UAAU;YAEtB,aAAa,EAAE,UAAU,QAAgB;gBACvC,OAAO,qBAAqB,CAAC,QAAQ,CAAC,CAAC;aACxC;YAED,SAAS,EAAE;gBACT,OAAO,cAAc,CAAC;aACvB;YAED,eAAe,EAAE;gBACf,OAAO,sBAAsB,EAAE,CAAC,CAAC,CAAC,CAAC;aACpC;YAED,iBAAiB,EAAE;gBACjB,OAAO,sBAAsB,EAAE,CAAC;aACjC;YAED,cAAc,EAAE,UAAU,GAAW;gBACnC,cAAc,GAAG,GAAG,CAAC;aACtB;YAED,YAAY,EAAE,UAAU,GAAW;gBACjC,UAAU,EAAE,CAAC;gBACb,eAAe,GAAG,wBAAwB,CAAC,iBAAiB,EAAE,GAAG,CAAC,CAAC;aACpE;YAED,gBAAgB,EAAE,UAAU,KAAa;;gBAEvC,iBAAiB,GAAG,QAAQ,CAAC,KAAK,CAAC;gBACnC,eAAe,GAAG,KAAK,CAAC;aACzB;YAED,cAAc,EAAE,UAAU,YAAqB;gBAC7C,oBAAoB,GAAG,YAAY,CAAC;aACrC;YAED,YAAY,EAAE,UAAU,YAAqB;gBAC3C,kBAAkB,GAAG,YAAY,CAAC;aACnC;YAED,aAAa,EAAE,UAAU,IAAY;gBACnC,gBAAgB,GAAG,IAAI,CAAC;gBACxB,gBAAgB,EAAE,CAAC;aACpB;YAED,uBAAuB,EAAE,UAAU,OAAe;gBAChD,0BAA0B,GAAG,OAAO,CAAC;aACtC;YAED,iBAAiB,EAAE,UAAU,0BAAiF;gBAC5G,aAAa,CAAC,0BAA0B,CAAC,CAAC;aAC3C;YAED,sBAAsB,EAAE,UAAU,aAA4C;gBAC5E,IAAI,CAAC,sBAAsB,CAAC,cAAc,CAAC,QAAQ,EAAE;oBACnD,sBAAsB,CAAC,OAAO,GAAG,IAAI,CAAC;oBACtC,sBAAsB,CAAC,cAAc,CAAC,QAAQ,GAAG,yBAAyB,uBACrE,aAAa,KAChB,QAAQ,EAAE,WAAW,IACrB,CAAC;iBACJ;aACF;YAED,8BAA8B,EAAE,UAC9B,aAAoF;gBAEpF,IAAI,CAAC,sBAAsB,CAAC,cAAc,CAAC,QAAQ,EAAE;oBACnD,sBAAsB,CAAC,OAAO,GAAG,IAAI,CAAC;oBACtC,sBAAsB,CAAC,cAAc,CAAC,QAAQ,GAAG,yBAAyB,CAAC,aAAa,CAAC,CAAC;iBAC3F;aACF;YAED,kBAAkB,EAAE;gBAClB,eAAe,EAAE,CAAC;aACnB;YAED,eAAe,EAAE,UAAU,IAAoB;gBAC7C,kBAAkB,GAAG,IAAI,CAAC;aAC3B;YAED,SAAS,EAAE,UAAU,MAAsB;gBACzC,cAAc,GAAG,MAAM,CAAC;aACzB;YAED,qBAAqB,EAAE,UAAU,gBAAwB;gBACvD,UAAU,EAAE,CAAC;gBACb,cAAc,GAAG,eAAe,CAAC,gBAAgB,EAAE,iBAAiB,CAAC,CAAC;aACvE;YAED,qBAAqB,EAAE,UAAU,gBAAwB;gBACvD,UAAU,EAAE,CAAC;gBACb,cAAc,GAAG,eAAe,CAAC,gBAAgB,EAAE,iBAAiB,CAAC,CAAC;aACvE;YAED,mBAAmB,EAAE,UAAU,UAAkB;gBAC/C,cAAc,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC;aACrC;YAED,eAAe,EAAE,UAAU,YAAoB;gBAC7C,kBAAkB,GAAG,cAAc,CAAC,YAAY,CAAC,CAAC;gBAClD,QAAQ,CAAC,eAAe,CAAC,kBAAkB,CAAC,CAAC;aAC9C;YAED,aAAa,EAAE,UAAU,aAAqB;gBAC5C,QAAQ,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;aACvC;YAED,WAAW,EAAE,UAAU,aAA4C;gBAA5C,8BAAA,EAAA,kBAA4C;gBACjE,QAAQ,CAAC,YAAY,EAAE,CAAC;gBACxB,IAAI,aAAa,CAAC,aAAa,EAAE;oBAC/B,QAAQ,CAAC,aAAa,CAAC,aAAa,CAAC,aAAa,CAAC,CAAC;iBACrD;aACF;YAED,aAAa,EAAE,UAAU,KAAiD;gBAAjD,sBAAA,EAAA,UAAiD;gBACxE,WAAW,CAAC,KAAK,CAAC,CAAC;aACpB;YAED,kBAAkB,EAAE;gBAClB,kBAAkB,GAAG,IAAI,CAAC;aAC3B;YAED,wBAAwB,EAAE,UAAU,aAAqD;gBACvF,oBAAoB,CAAC,iBAAiB,GAAG,KAAK,CAAC;gBAE/C,uBAAuB,CAAC,aAAa,CAAC,CAAC;gBAEvC,uBAAuB,EAAE,CAAC;gBAE1B,QAAQ,CAAC,YAAY,EAAE,CAAC;aACzB;YAED,uBAAuB,EAAE,UAAU,aAAoD;;gBACrF,oBAAoB,CAAC,iBAAiB,GAAG,OAAC,aAAa,KAAI,aAAa,aAAb,aAAa,uBAAb,aAAa,CAAE,OAAO,CAAA,CAAC,mCAAI,IAAI,CAAC;gBAE3F,uBAAuB,CAAC,aAAa,CAAC,CAAC;;gBAGvC,IAAI,CAAC,8BAA8B,EAAE;oBACnC,aAAa,EAAE,CAAC;iBACjB;aACF;YAED,aAAa,EAAE,uBAAuB;SACvC,CAAC;QAEF,6BACK,UAAU,KACb,EAAE,EAAE,SAAS,EACb,SAAS,WAAA,EACT,IAAI,EAAE,IAAI,EACV,WAAW,EAAE,KAAK,IAClB;KACH,CAAC;;IAGF,IAAM,cAAc,GAAG,UAAU,CAAC,SAAS,EAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,oBAAoB,CAAC,EAC3G,OAAO,yBACF,cAAc,KACjB,SAAS,EAAE,UAAC,aAAyC;;YACnD,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;YACtC,MAAA,MAAA,aAAa,CAAC,MAAM,EAAC,qBAAqB,mDAAG,OAAO,CAAC,CAAC;SACvD,GACF,CAAC;;IAGJ,MAAA,oBAAoB,CAAC,OAAO,0CAAE,OAAO,CAAC,UAAC,CAAC;;QACtC,MAAA,CAAC,CAAC,qBAAqB,+CAAvB,CAAC,EAAyB,OAAO,CAAC,CAAC;KACpC,CAAC,CAAC;IAEH,OAAO,OAAO,CAAC;AACjB;;AC5uCA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA,IAAM,aAAa,GAAmC,EAAE,CAAC;AAEzD;;;;;;SAMgB,kBAAkB,CAAC,QAAmC,EAAE,EAA+B;IACrG,IAAI;QACF,WAAW,CAAC,QAAQ,aAAR,QAAQ,cAAR,QAAQ,GAAI,eAAe,EAAE,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;KACxD;IAAC,OAAO,EAAE,EAAE;QACX,GAAG,CAAC,KAAK,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAC;KAClC;AACH,CAAC;AAED;;;;;;;SAOgB,8BAA8B,CAC5C,QAAmC,EACnC,iBAAiD,EACjD,EAA+B;IAE/B,IAAI;QACF,yBAAyB,CAAC,QAAQ,aAAR,QAAQ,cAAR,QAAQ,GAAI,MAAM,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAE,iBAAiB,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;KACtG;IAAC,OAAO,EAAE,EAAE;QACX,GAAG,CAAC,KAAK,CAAC,iBAAiB,EAAE,EAAE,CAAC,CAAC;KAClC;AACH,CAAC;AAED;;;;SAIgB,aAAa,CAAC,SAAiB;IAC7C,OAAO,aAAa,CAAC,cAAc,CAAC,SAAS,CAAC,CAAC;AACjD,CAAC;AAED;;;;;;;;;SASgB,UAAU,CACxB,SAAiB,EACjB,SAAiB,EACjB,OAAe,EACf,QAAgB,EAChB,WAAwB,EACxB,aAAoC;IAEpC,IAAI,CAAC,aAAa,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;QAC5C,aAAa,CAAC,SAAS,CAAC,GAAG,OAAO,CAAC,SAAS,EAAE,SAAS,EAAE,OAAO,EAAE,QAAQ,EAAE,WAAW,EAAE,aAAa,CAAC,CAAC;QACxG,OAAO,aAAa,CAAC,SAAS,CAAC,CAAC;KACjC;IACD,OAAO,IAAI,CAAC;AACd,CAAC;AAED;;;;;SAKgB,UAAU,CAAC,SAAiB;IAC1C,IAAI,aAAa,CAAC,cAAc,CAAC,SAAS,CAAC,EAAE;QAC3C,OAAO,aAAa,CAAC,SAAS,CAAC,CAAC;KACjC;IAED,GAAG,CAAC,IAAI,CAAC,SAAS,GAAG,iBAAiB,CAAC,CAAC;IACxC,OAAO,IAAI,CAAC;AACd,CAAC;AAED;;;;;SAKgB,WAAW,CAAC,UAAyB;IACnD,OAAO,yBAAyB,CAAC,UAAU,EAAE,aAAa,CAAC,CAAC;AAC9D,CAAC;AAED;;;SAGgB,WAAW;IACzB,OAAO,aAAa,CAAC;AACvB,CAAC;AAED;;;SAGgB,eAAe;IAC7B,OAAO,MAAM,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;AACpC,CAAC;AAED,SAAS,yBAAyB,CAChC,UAAyB,EACzB,iBAAiD;IAEjD,IAAM,QAAQ,GAA0B,EAAE,CAAC;IAC3C,KAAiB,UAAU,EAAV,yBAAU,EAAV,wBAAU,EAAV,IAAU,EAAE;QAAxB,IAAM,EAAE,mBAAA;QACX,IAAI,iBAAiB,CAAC,cAAc,CAAC,EAAE,CAAC,EAAE;YACxC,QAAQ,CAAC,IAAI,CAAC,iBAAiB,CAAC,EAAE,CAAC,CAAC,CAAC;SACtC;aAAM;YACL,GAAG,CAAC,IAAI,CAAC,EAAE,GAAG,iBAAiB,CAAC,CAAC;SAClC;KACF;IACD,OAAO,QAAQ,CAAC;AAClB;;ACxJA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAuCA;;;;IAGA;;QAEE,cAAS,GAAmB,EAAE,CAAC;QAC/B,mBAAc,GAAmC,EAAE,CAAC;;QAGpD,cAAS,GAAY,KAAK,CAAC;QAC3B,6BAAwB,GAAsB,EAAE,CAAC;KAKlD;IAAD,kBAAC;AAAD,CAAC,IAAA;SAEe,iBAAiB;IAC/B,IAAM,WAAW,GAAG,IAAI,WAAW,EAAE,EACnC,aAAa,GAAG,QAAQ,EACxB,WAAW,GAAG,MAAM,CAAC;;;;;IAMvB,SAAS,uBAAuB;QAC9B,IAAI,aAAa,CAAC,eAAe,IAAI,QAAQ,EAAE;;YAE7C,WAAW,CAAC,cAAc,CAAC,OAAO,CAAC,UAAU,OAAO;gBAClD,OAAO,CAAC,KAAK,CAAC,CAAC;aAChB,CAAC,CAAC;SACJ;KACF;IAED,SAAS,YAAY;;QAEnB,WAAW,CAAC,cAAc,CAAC,OAAO,CAAC,UAAU,OAAO;YAClD,OAAO,CAAC,KAAK,CAAC,CAAC;SAChB,CAAC,CAAC;KACJ;;;;IAKD,SAAS,WAAW;QAClB,IAAI,CAAC,CAAC;QAEN,IAAI,CAAC,WAAW,CAAC,SAAS,EAAE;YAC1B,WAAW,CAAC,SAAS,GAAG,IAAI,CAAC;YAC7B,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,WAAW,CAAC,wBAAwB,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;gBAChE,WAAW,CAAC,wBAAwB,CAAC,CAAC,CAAC,EAAE,CAAC;aAC3C;SACF;QACD,OAAO,IAAI,CAAC;KACb;;;;IAKD,SAAS,gBAAgB;QACvB,IAAI,aAAa,CAAC,gBAAgB,EAAE;YAClC,aAAa,CAAC,gBAAgB,CAAC,kBAAkB,EAAE,SAAS,KAAK;gBAC/D,aAAa,CAAC,mBAAmB,CAAC,kBAAkB,EAAE,KAAK,EAAE,KAAK,CAAC,CAAC;gBACpE,WAAW,EAAE,CAAC;aACf,CAAC,CAAC;SACJ;aAAM,IAAI,aAAa,CAAC,WAAW,EAAE;YACpC,aAAa,CAAC,WAAW,CAAC,oBAAoB,EAAE,SAAS,KAAK;gBAC5D,IAAI,aAAa,CAAC,UAAU,KAAK,UAAU,EAAE;oBAC3C,aAAa,CAAC,WAAW,CAAC,oBAAoB,EAAE,KAAK,CAAC,CAAC;oBACvD,WAAW,EAAE,CAAC;iBACf;aACF,CAAC,CAAC;SACJ;;QAGD,gBAAgB,CAAC,WAAW,EAAE,MAAM,EAAE,WAAW,EAAE,KAAK,CAAC,CAAC;KAC3D;;;;;IAOD,IAAI,aAAa,CAAC,eAAe,EAAE;;QAEjC,gBAAgB,CAAC,aAAa,EAAE,kBAAkB,EAAE,uBAAuB,EAAE,KAAK,CAAC,CAAC;KACrF;;IAED,gBAAgB,CAAC,WAAW,EAAE,cAAc,EAAE,YAAY,EAAE,KAAK,CAAC,CAAC;IAEnE,IAAI,QAAQ,CAAC,UAAU,KAAK,SAAS,EAAE;QACrC,gBAAgB,EAAE,CAAC;KACpB;SAAM;QACL,WAAW,EAAE,CAAC;KACf;IAED,OAAO,WAAW,CAAC;AACrB;;"}